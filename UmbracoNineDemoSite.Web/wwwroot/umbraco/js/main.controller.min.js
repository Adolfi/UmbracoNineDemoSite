function MainController($scope,$location,appState,treeService,notificationsService,userService,historyService,updateChecker,navigationService,eventsService,tmhDynamicLocale,localStorageService,editorService,overlayService,assetsService,tinyMceAssets){function handleFirstTab(evt){9===evt.keyCode&&function enableTabbingActive(){$scope.tabbingActive=!0,$scope.$digest(),window.addEventListener("mousedown",disableTabbingActive),window.removeEventListener("keydown",handleFirstTab)}()}function disableTabbingActive(evt){$scope.tabbingActive=!1,$scope.$digest(),window.removeEventListener("mousedown",disableTabbingActive),window.addEventListener("keydown",handleFirstTab)}$scope.authenticated=null,$scope.touchDevice=appState.getGlobalState("touchDevice"),$scope.infiniteMode=!1,$scope.overlay={},$scope.drawer={},$scope.search={},$scope.login={},$scope.tabbingActive=!1,tinyMceAssets.forEach(function(tinyJsAsset){assetsService.loadJs(tinyJsAsset,$scope)}),window.addEventListener("keydown",handleFirstTab),$scope.$on("showFocusOutline",function(){$scope.tabbingActive=!0,window.addEventListener("mousedown",disableTabbingActive),window.removeEventListener("keydown",handleFirstTab)}),$scope.removeNotification=function(index){notificationsService.remove(index)},$scope.closeSearch=function(){appState.setSearchState("show",!1)},$scope.showLoginScreen=function(isTimedOut){$scope.login.pageTitle=$scope.$root.locationTitle,$scope.login.isTimedOut=isTimedOut,$scope.login.show=!0},$scope.hideLoginScreen=function(){$scope.$root.locationTitle=$scope.login.pageTitle,$scope.login.show=!1};var evts=[];evts.push(eventsService.on("app.notAuthenticated",function(evt,data){$scope.authenticated=null,$scope.user=null;const isTimedOut=!(!data||!data.isTimedOut);$scope.showLoginScreen(isTimedOut),localStorageService.remove("emailMarketingTourShown"),localStorageService.remove("introTourShown")})),evts.push(eventsService.on("app.userRefresh",function(evt){userService.refreshCurrentUser().then(function(data){$scope.user=data,$scope.user.locale&&tmhDynamicLocale.set($scope.user.locale)})})),evts.push(eventsService.on("app.ready",function(evt,data){if($scope.authenticated=data.authenticated,$scope.user=data.user,updateChecker.check().then(function(update){if(update&&"null"!==update&&"None"!==update.type){var notification={headline:"Update available",message:"Click to download",sticky:!0,type:"info",url:update.url,target:"_blank"};notificationsService.add(notification)}}),void 0!==data.lastUserId&&null!==data.lastUserId&&data.lastUserId!==data.user.id){var section=appState.getSectionState("currentSection");section&&navigationService.reloadSection(section),$location.path("/").search(""),historyService.removeAll(),treeService.clearCache(),editorService.closeAll(),overlayService.close(),localStorageService.clearAll()}"credentials"===data.loginType&&localStorageService.clearAll(),$scope.user.locale&&tmhDynamicLocale.set($scope.user.locale)})),evts.push(eventsService.on("appState.searchState.changed",function(e,args){"show"===args.key&&($scope.search.show=args.value)})),evts.push(eventsService.on("appState.drawerState.changed",function(e,args){"view"===args.key&&($scope.drawer.view=args.value),"model"===args.key&&($scope.drawer.model=args.value),"showDrawer"===args.key&&($scope.drawer.show=args.value)})),evts.push(eventsService.on("appState.overlay",function(name,args){$scope.overlay=args})),evts.push(eventsService.on("appState.tour.start",function(name,args){$scope.tour=args,$scope.tour.show=!0})),evts.push(eventsService.on("appState.tour.end",function(){$scope.tour=null})),evts.push(eventsService.on("appState.tour.complete",function(){$scope.tour=null})),evts.push(eventsService.on("appState.backdrop",function(name,args){$scope.backdrop=args})),evts.push(eventsService.on("appState.editors.open",function(name,args){$scope.infiniteMode=!!(args&&args.editors.length>0)})),evts.push(eventsService.on("appState.editors.close",function(name,args){$scope.infiniteMode=!!(args&&args.editors.length>0)})),$scope.$on("$destroy",function(){for(var e in evts)eventsService.unsubscribe(evts[e])})}angular.module("umbraco").controller("Umbraco.MainController",MainController).config(function(tmhDynamicLocaleProvider){tmhDynamicLocaleProvider.localeLocationPattern("lib/angular-i18n/angular-locale_{{locale | lowercase}}.js")});