!function(){"use strict";function angularHelper($q){var requiredFormProps=["$error","$name","$dirty","$pristine","$valid","$submitted","$pending"];function isForm(obj){var props=_.keys(obj);return!(props.length<requiredFormProps.length)&&function allPropertiesExist(objectPropNames){return _.every(requiredFormProps,function(item){return _.contains(objectPropNames,item)})}(props)}return{countAllFormErrors:function countAllFormErrors(formCtrl){var allErrors=[];return function collectAllFormErrorsRecursively(formCtrl,allErrors){if(-1===allErrors.indexOf(formCtrl)){var keys=Object.keys(formCtrl.$error);0!==keys.length&&keys.forEach(function(validationKey){formCtrl.$error[validationKey].forEach(function(ctrl){if(ctrl)if(isForm(ctrl)){if(ctrl===formCtrl)return void allErrors.push(ctrl);collectAllFormErrorsRecursively(ctrl,allErrors)}else allErrors.push(ctrl);else allErrors.push(formCtrl)})})}}(formCtrl,allErrors),allErrors.length},traverseScopeChain:function traverseScopeChain(scope,predicate){for(var s=scope.$parent;s;){if(!0===predicate(s))return s;s=s.$parent}return null},revalidateNgModel:function revalidateNgModel(scope,ngModel){this.safeApply(scope,function(){ngModel.$parsers.forEach(function(parser){parser(ngModel.$viewValue)})})},executeSequentialPromises:function executeSequentialPromises(promises){if(!Utilities.isArray(promises))throw"promises must be an array";var j=0;return promises.length>0?function pExec(promise){return j++,promise.then(function(data){return j===promises.length?$q.when(data):pExec(promises[j])})}(promises[0]):$q.when(!0)},safeApply:function safeApply(scope,fn){scope.$$phase||scope.$root&&scope.$root.$$phase?Utilities.isFunction(fn)&&fn():Utilities.isFunction(fn)?scope.$apply(fn):scope.$apply()},isForm:isForm,getCurrentForm:function getCurrentForm(scope){var form=null;for(var p in scope)if(_.isObject(scope[p])&&"this"!==p&&"$"!==p.substr(0,1)&&this.isForm(scope[p])){form=scope[p];break}return form},getRequiredCurrentForm:function getRequiredCurrentForm(scope){var currentForm=this.getCurrentForm(scope);if(!currentForm||!currentForm.$name)throw"The current scope requires a current form object (or ng-form) with a name assigned to it";return currentForm},getNullForm:function getNullForm(formName){return{$error:{},$dirty:!1,$pristine:!0,$valid:!0,$submitted:!1,$pending:void 0,$addControl:Utilities.noop,$removeControl:Utilities.noop,$setValidity:Utilities.noop,$setDirty:Utilities.noop,$setPristine:Utilities.noop,$name:formName}}}}function appState(eventsService){var globalState={showNavigation:null,touchDevice:null,showTray:null,stickyNavigation:null,navMode:null,isReady:null,isTablet:null},sectionState={currentSection:null,showSearchResults:null},treeState={selectedNode:null,currentRootNode:null},menuState={menuActions:null,dialogTitle:null,currentNode:null,showMenuDialog:null,allowHideMenuDialog:!0,dialogTemplateUrl:null,showMenu:null},searchState={show:null},drawerState={view:null,model:null,showDrawer:null};function setState(stateObj,key,value,stateObjName){if(!_.has(stateObj,key))throw"The variable "+key+" does not exist in "+stateObjName;var changed=stateObj[key]!==value;stateObj[key]=value,changed&&eventsService.emit("appState."+stateObjName+".changed",{key:key,value:value})}function getState(stateObj,key,stateObjName){if(!_.has(stateObj,key))throw"The variable "+key+" does not exist in "+stateObjName;return stateObj[key]}return{getGlobalState:function getGlobalState(key){return getState(globalState,key,"globalState")},setGlobalState:function setGlobalState(key,value){setState(globalState,key,value,"globalState")},getSectionState:function getSectionState(key){return getState(sectionState,key,"sectionState")},setSectionState:function setSectionState(key,value){setState(sectionState,key,value,"sectionState")},getTreeState:function getTreeState(key){return getState(treeState,key,"treeState")},setTreeState:function setTreeState(key,value){setState(treeState,key,value,"treeState")},getMenuState:function getMenuState(key){return getState(menuState,key,"menuState")},setMenuState:function setMenuState(key,value){setState(menuState,key,value,"menuState")},getSearchState:function getSearchState(key){return getState(searchState,key,"searchState")},setSearchState:function setSearchState(key,value){setState(searchState,key,value,"searchState")},getDrawerState:function getDrawerState(key){return getState(drawerState,key,"drawerState")},setDrawerState:function setDrawerState(key,value){setState(drawerState,key,value,"drawerState")}}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function clipboardService($window,notificationsService,eventsService,localStorageService,iconHelper){var TYPES={ELEMENT_TYPE:"elementType",BLOCK:"block",RAW:"raw",MEDIA:"media"},clearPropertyResolvers={},pastePropertyResolvers={},clipboardTypeResolvers={};clipboardTypeResolvers[TYPES.ELEMENT_TYPE]=function(element,propMethod){for(var t=0;t<element.variants[0].tabs.length;t++)for(var tab=element.variants[0].tabs[t],p=0;p<tab.properties.length;p++){propMethod(tab.properties[p],TYPES.ELEMENT_TYPE)}},clipboardTypeResolvers[TYPES.BLOCK]=function(block,propMethod){propMethod(block,TYPES.BLOCK),block.data&&Object.keys(block.data).forEach(function(key){"udi"!==key&&"contentTypeKey"!==key&&propMethod(block.data[key],TYPES.RAW)}),block.settingsData&&Object.keys(block.settingsData).forEach(function(key){"udi"!==key&&"contentTypeKey"!==key&&propMethod(block.settingsData[key],TYPES.RAW)})},clipboardTypeResolvers[TYPES.RAW]=function(data,propMethod){for(var p=0;p<data.length;p++)propMethod(data[p],TYPES.RAW)},clipboardTypeResolvers[TYPES.MEDIA]=function(data,propMethod){};var retriveStorage=function retriveStorage(){if(!1===localStorageService.isSupported)return null;var dataJSON,dataString=localStorageService.get("umbClipboardService");return null!=dataString&&(dataJSON=JSON.parse(dataString)),null==dataJSON&&(dataJSON=new Object),void 0===dataJSON.entries&&(dataJSON.entries=[]),dataJSON},saveStorage=function saveStorage(storage){var storageString=JSON.stringify(storage);try{JSON.parse(storageString);return localStorageService.set("umbClipboardService",storageString),eventsService.emit("clipboardService.storageUpdate"),!0}catch(e){return!1}return!1};function resolvePropertyForStorage(prop,type){var resolvers=clearPropertyResolvers[type=type||"raw"];if(resolvers)for(var i=0;i<resolvers.length;i++)resolvers[i](prop,resolvePropertyForStorage)}var prepareEntryForStorage=function prepareEntryForStorage(type,entryData,firstLevelClearupMethod){var cloneData=Utilities.copy(entryData);null!=firstLevelClearupMethod&&firstLevelClearupMethod(cloneData);var typeResolver=clipboardTypeResolvers[type];return typeResolver?typeResolver(cloneData,resolvePropertyForStorage):console.warn("Umbraco.service.clipboardService has no type resolver for '"+type+"'."),cloneData},isEntryCompatible=function isEntryCompatible(entry,type,allowedAliases){return entry.type===type&&(null===allowedAliases||entry.alias&&allowedAliases.filter(function(allowedAlias){return allowedAlias===entry.alias}).length>0||entry.aliases&&entry.aliases.filter(function(entryAlias){return allowedAliases.filter(function(allowedAlias){return allowedAlias===entryAlias}).length>0}).length===entry.aliases.length)};function resolvePropertyForPaste(prop,type){var resolvers=pastePropertyResolvers[type=type||"raw"];if(resolvers)for(var i=0;i<resolvers.length;i++)resolvers[i](prop,resolvePropertyForPaste)}var service={};service.TYPES=TYPES,service.parseContentForPaste=function(pasteEntryData,type){var cloneData=Utilities.copy(pasteEntryData),typeResolver=clipboardTypeResolvers[type];return typeResolver?typeResolver(cloneData,resolvePropertyForPaste):console.warn("Umbraco.service.clipboardService has no type resolver for '"+type+"'."),cloneData},service.registrerClearPropertyResolver=function(resolver,type){this.registerClearPropertyResolver(resolver,type)},service.registerClearPropertyResolver=function(resolver,type){clearPropertyResolvers[type=type||"raw"]||(clearPropertyResolvers[type]=[]),clearPropertyResolvers[type].push(resolver)},service.registerPastePropertyResolver=function(resolver,type){pastePropertyResolvers[type=type||"raw"]||(pastePropertyResolvers[type]=[]),pastePropertyResolvers[type].push(resolver)},service.registrerTypeResolvers=function(resolver,type){clipboardTypeResolvers[type]||(clipboardTypeResolvers[type]=[]),clipboardTypeResolvers[type].push(resolver)},service.copy=function(type,alias,data,displayLabel,displayIcon,uniqueKey,firstLevelClearupMethod){var storage=retriveStorage();displayLabel=displayLabel||data.name,displayIcon=displayIcon||iconHelper.convertFromLegacyIcon(data.icon),uniqueKey=uniqueKey||data.key||console.error("missing unique key for this content"),storage.entries=storage.entries.filter(function(entry){return entry.unique!==uniqueKey});var entry={unique:uniqueKey,type:type,alias:alias,data:prepareEntryForStorage(type,data,firstLevelClearupMethod),label:displayLabel,icon:displayIcon,date:Date.now()};storage.entries.push(entry),!0===saveStorage(storage)?notificationsService.success("Clipboard","Copied to clipboard."):notificationsService.error("Clipboard","Couldnt copy this data to clipboard.")},service.copyArray=function(type,aliases,datas,displayLabel,displayIcon,uniqueKey,firstLevelClearupMethod){"elementTypeArray"===type&&(type="elementType");var storage=retriveStorage(),copiedDatas=datas.map(function(data){return prepareEntryForStorage(type,data,firstLevelClearupMethod)});storage.entries=storage.entries.filter(function(entry){return entry.unique!==uniqueKey});var entry={unique:uniqueKey,type:type,aliases:aliases,data:copiedDatas,label:displayLabel,icon:displayIcon,date:Date.now()};storage.entries.push(entry),!0===saveStorage(storage)?notificationsService.success("Clipboard","Copied to clipboard."):notificationsService.error("Clipboard","Couldnt copy this data to clipboard.")},service.isSupported=function(){return localStorageService.isSupported},service.hasEntriesOfType=function(type,aliases){return service.retriveEntriesOfType(type,aliases).length>0},service.retriveEntriesOfType=function(type,allowedAliases){return retriveStorage().entries.filter(function(entry){return isEntryCompatible(entry,type,allowedAliases)})},service.retriveDataOfType=function(type,aliases){return service.retriveEntriesOfType(type,aliases).map(function(x){return x.data})},service.clearEntriesOfType=function(type,allowedAliases){var storage=retriveStorage(),filteretEntries=storage.entries.filter(function(entry){return!isEntryCompatible(entry,type,allowedAliases)});storage.entries=filteretEntries,saveStorage(storage)};var emitClipboardStorageUpdate=_.debounce(function(e){eventsService.emit("clipboardService.storageUpdate")},1e3);return $window.addEventListener("storage",emitClipboardStorageUpdate),service}function contentAppHelper(){var service={CONTENT_BASED_APPS:["umbContent","umbInfo","umbListView"],isContentBasedApp:function(app){return-1!==service.CONTENT_BASED_APPS.indexOf(app.alias)}};return service}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){if(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function contentEditingHelper(fileManager,$q,$location,$routeParams,editorState,notificationsService,navigationService,localizationService,serverValidationManager,formHelper,contentTypeHelper){return{contentEditorPerformSave:function contentEditorPerformSave(args){if(!Utilities.isObject(args))throw"args must be an object";if(!args.scope)throw"args.scope is not defined";if(!args.content)throw"args.content is not defined";if(!args.saveMethod)throw"args.saveMethod is not defined";void 0===args.showNotifications&&(args.showNotifications=!0),void 0===args.create&&$routeParams.create&&(args.create=!0),void 0===args.softRedirect&&(args.softRedirect=!1);var self=this,_rebindCallback=void 0===args.rebindCallback?self.reBindChangedProperties:args.rebindCallback,formSubmitOptions={scope:args.scope,action:args.action};return!0===args.skipValidation&&(formSubmitOptions.skipValidation=!0,formSubmitOptions.keepServerValidation=!0),formHelper.submitForm(formSubmitOptions)?args.saveMethod(args.content,args.create,fileManager.getFiles(),args.showNotifications).then(function(data){return formHelper.resetForm({scope:args.scope}),args.infiniteMode||(self.handleSuccessfulSave({scope:args.scope,savedContent:data,softRedirect:args.softRedirect,rebindCallback:function rebindCallback(){_rebindCallback.apply(self,[args.content,data])}}),editorState.set(args.content)),$q.resolve(data)},function(err){return formHelper.resetForm({scope:args.scope,hasErrors:!0}),self.handleSaveError({showNotifications:args.showNotifications,softRedirect:args.softRedirect,err:err,action:args.action,rebindCallback:function rebindCallback(){err.data&&_rebindCallback.apply(self,[args.content,err.data])}}),editorState.set(args.content),$q.reject(err)}):$q.reject()},addInfoTab:function addInfoTab(tabs){var infoTab={alias:"_umb_infoTab",id:-1,label:"Info",properties:[]},foundInfoTab=!1;tabs.forEach(function(tab){tab.id===infoTab.id&&tab.alias===infoTab.alias&&(foundInfoTab=!0)}),foundInfoTab||localizationService.localize("general_info").then(function(value){infoTab.label=value,tabs.push(infoTab)})},registerGenericTab:function registerGenericTab(groups){if(groups&&!groups.find(function(group){return group.isGenericTab})){if(groups.filter(function(group){return function isRootGroup(group){return group.type===contentTypeHelper.TYPE_GROUP&&null===group.parentAlias}(group)}).length>0){var genericTab={isGenericTab:!0,type:contentTypeHelper.TYPE_TAB,label:"Generic",key:String.CreateGuid(),alias:null,parentAlias:null,properties:[]};localizationService.localize("general_generic").then(function(value){genericTab.label=value,groups.unshift(genericTab)})}}},configureContentEditorButtons:function configureContentEditorButtons(args){if(!Utilities.isObject(args))throw"args must be an object";if(!args.content)throw"args.content is not defined";if(!args.methods)throw"args.methods is not defined";if(!(args.methods.saveAndPublish&&args.methods.sendToPublish&&args.methods.unpublish&&args.methods.schedulePublish&&args.methods.publishDescendants))throw"args.methods does not contain all required defined methods";var buttons={defaultButton:null,subButtons:[]};function createButtonDefinition(ch){switch(ch){case"U":return{letter:ch,labelKey:"buttons_saveAndPublish",handler:args.methods.saveAndPublish,hotKey:"ctrl+p",hotKeyWhenHidden:!0,alias:"saveAndPublish",addEllipsis:args.content.variants&&args.content.variants.length>1?"true":"false"};case"H":return{letter:ch,labelKey:"buttons_saveToPublish",handler:args.methods.sendToPublish,hotKey:"ctrl+p",hotKeyWhenHidden:!0,alias:"sendToPublish",addEllipsis:args.content.variants&&args.content.variants.length>1?"true":"false"};case"Z":return{letter:ch,labelKey:"content_unpublish",handler:args.methods.unpublish,hotKey:"ctrl+u",hotKeyWhenHidden:!0,alias:"unpublish",addEllipsis:"true"};case"SCHEDULE":return{letter:ch,labelKey:"buttons_schedulePublish",handler:args.methods.schedulePublish,hotKey:"alt+shift+s",hotKeyWhenHidden:!0,alias:"schedulePublish",addEllipsis:"true"};case"PUBLISH_DESCENDANTS":return{letter:ch,labelKey:"buttons_publishDescendants",handler:args.methods.publishDescendants,hotKey:"alt+shift+p",hotKeyWhenHidden:!0,alias:"publishDescendant",addEllipsis:"true"};default:return null}}buttons.subButtons=[];var buttonOrder=["U","H","SCHEDULE","PUBLISH_DESCENDANTS"];if(!args.create||_.contains(args.content.allowedActions,"C")){for(var b in buttonOrder)if(_.contains(args.content.allowedActions,buttonOrder[b])){buttons.defaultButton=createButtonDefinition(buttonOrder[b]);break}!buttons.defaultButton&&args.create&&_.contains(args.content.allowedActions,"C")&&(buttons.defaultButton=createButtonDefinition("A"))}if(buttons.defaultButton){for(var i=_.indexOf(buttonOrder,buttons.defaultButton.letter)+1;i<buttonOrder.length;i++)_.contains(args.content.allowedActions,buttonOrder[i])&&buttons.subButtons.push(createButtonDefinition(buttonOrder[i]));if(_.contains(args.content.allowedActions,"U")&&(buttons.subButtons.push(createButtonDefinition("SCHEDULE")),buttons.subButtons.push(createButtonDefinition("PUBLISH_DESCENDANTS"))),!args.create)args.content.variants.filter(function(variant){return"Published"===variant.state||"PublishedPendingChanges"===variant.state}).length>0&&_.contains(args.content.allowedActions,"U")&&_.contains(args.content.allowedActions,"Z")&&buttons.subButtons.push(createButtonDefinition("Z"))}return buttons},getAllProps:function getAllProps(content){for(var allProps=[],i=0;i<content.tabs.length;i++)for(var p=0;p<content.tabs[i].properties.length;p++)allProps.push(content.tabs[i].properties[p]);return allProps},buildCompositeVariantId:function buildCompositeVariantId(variant){return(variant.language?variant.language.culture:"invariant")+"_"+(variant.segment?variant.segment:"null")},getAllowedActions:function getAllowedActions(content,creating){var actionOrder=["U","H","A"],defaultAction=null,actions=[];if(!creating||_.contains(content.allowedActions,"C"))for(var b in actionOrder)if(_.contains(content.allowedActions,actionOrder[b])){defaultAction=actionOrder[b];break}if(actions.push(defaultAction),defaultAction){for(var i=_.indexOf(actionOrder,defaultAction)+1;i<actionOrder.length;i++)_.contains(content.allowedActions,actionOrder[i])&&actions.push(actionOrder[i]);creating||content.publishDate&&_.contains(content.allowedActions,"U")&&actions.push("Z")}return actions},getButtonFromAction:function getButtonFromAction(ch){switch(ch){case"U":return{letter:ch,labelKey:"buttons_saveAndPublish",handler:"saveAndPublish",hotKey:"ctrl+p"};case"H":return{letter:ch,labelKey:"buttons_saveToPublish",handler:"sendToPublish",hotKey:"ctrl+p"};case"A":return{letter:ch,labelKey:"buttons_save",handler:"save",hotKey:"ctrl+s"};case"Z":return{letter:ch,labelKey:"content_unpublish",handler:"unpublish"};default:return null}},reBindChangedProperties:function reBindChangedProperties(origContent,savedContent){var shouldIgnore=function shouldIgnore(propName){return _.some(["variants","tabs","properties","apps","createDateFormatted","releaseDateFormatted","expireDateFormatted","releaseDate","expireDate"],function(i){return i===propName})};for(var o in savedContent)shouldIgnore(o)||_.isEqual(origContent[o],savedContent[o])||(origContent[o]=savedContent[o]);var isContent=!1,origVariants=[],savedVariants=[];origContent.variants?(isContent=!0,origVariants=origContent.variants,savedVariants=savedContent.variants):(origVariants.push(origContent),savedVariants.push(savedContent));var changed=[];function getNewProp(alias,allNewProps){return _.find(allNewProps,function(item){return item.alias===alias})}for(var j=0;j<origVariants.length;j++){var origVariant=origVariants[j],savedVariant=savedVariants[j];if(!isContent||origVariant.save){if(origContent.variants){var variantPropertiesSync=["state"];for(var b in savedVariant){!_.some(variantPropertiesSync,function(e){return e===b})&&shouldIgnore(b)||_.isEqual(origVariant[b],savedVariant[b])||(origVariant[b]=savedVariant[b])}}for(var allOrigProps=this.getAllProps(origVariant),allNewProps=this.getAllProps(savedVariant),k=0;k<allOrigProps.length;k++){var origProp=allOrigProps[k],newProp=getNewProp(origProp.alias,allNewProps);if(newProp&&!_.isEqual(origProp.value,newProp.value)){var origVal=origProp.value;origProp.value=newProp.value,Utilities.isFunction(origProp.onValueChanged)&&origProp.onValueChanged(origProp.value,origVal),changed.push(origProp)}}}}return changed},handleSaveError:function handleSaveError(args){if(!args.err)throw"args.err cannot be null";if(400===args.err.status&&args.err.data&&args.err.data.ModelState){formHelper.handleServerValidation(args.err.data.ModelState);var messageType=2;return"save"===args.action&&(messageType=4),args.showNotifications&&function showNotificationsForModelsState(ms,messageType){messageType=messageType||2;for(var _i=0,_Object$entries=Object.entries(ms);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),value=(_Object$entries$_i[0],_Object$entries$_i[1]),errorMsg=value[0];Utilities.isString(errorMsg)&&errorMsg.startsWith("[")||Utilities.isArray(errorMsg)?serverValidationManager.parseComplexEditorError(errorMsg,"").forEach(function(x){x.modelState&&showNotificationsForModelsState(x.modelState,messageType)}):value[0]&&notificationsService.showNotification({type:messageType,header:"Validation",message:value[0]})}}(args.err.data.ModelState,messageType),this.redirectToCreatedContent(args.err.data.id,args.softRedirect)&&!args.softRedirect||(args.rebindCallback&&Utilities.isFunction(args.rebindCallback)&&args.rebindCallback(),serverValidationManager.notify()),!0}return!1},handleSuccessfulSave:function handleSuccessfulSave(args){if(!args)throw"args cannot be null";if(!args.savedContent)throw"args.savedContent cannot be null";this.redirectToCreatedContent(args.redirectId?args.redirectId:args.savedContent.id,args.softRedirect)&&!args.softRedirect||args.rebindCallback&&Utilities.isFunction(args.rebindCallback)&&args.rebindCallback()},redirectToCreatedContent:function redirectToCreatedContent(id,softRedirect){return!(!$routeParams.create||!function isValidIdentifier(id){if(Utilities.isNumber(id)){if(0===id)return!1;if(id>0)return!0}return"00000000-0000-0000-0000-000000000000"!==id&&""!==id}(id))&&(navigationService.clearSearch(["cculture","csegment"]),softRedirect&&navigationService.setSoftRedirect(),$location.path("/"+$routeParams.section+"/"+$routeParams.tree+"/"+$routeParams.method+"/"+id),$location.replace(),!0)},redirectToRenamedContent:function redirectToRenamedContent(id){return navigationService.clearSearch(),$location.path("/"+$routeParams.section+"/"+$routeParams.tree+"/"+$routeParams.method+"/"+id),$location.replace(),!0},sortVariants:function sortVariants(a,b){var statesOrder={PublishedPendingChanges:1,Published:1,Draft:2,NotCreated:3};return function compareDefault(a,b){return(a.language&&a.language.isDefault?-1:1)-(b.language&&b.language.isDefault?-1:1)}(a,b)||function compareMandatory(a,b){return"PublishedPendingChanges"===a.state||"Published"===a.state?0:(a.language&&a.language.isMandatory?-1:1)-(b.language&&b.language.isMandatory?-1:1)}(a,b)||function compareState(a,b){return(statesOrder[a.state]||99)-(statesOrder[b.state]||99)}(a,b)||function compareName(a,b){return a.displayName.localeCompare(b.displayName)}(a,b)},getSortedVariantsAndSegments:function getSortedVariantsAndSegments(variantsAndSegments){var _this=this,sortedVariants=variantsAndSegments.filter(function(variant){return!variant.segment}).sort(this.sortVariants),variantsWithSegments=variantsAndSegments.filter(function(variant){return variant.segment}),sortedAvailableVariants=[];return sortedVariants.forEach(function(variant){var sortedMatchedSegments=variantsWithSegments.filter(function(segment){return segment.language&&variant.language&&segment.language.culture===variant.language.culture}).sort(_this.sortVariants);variantsWithSegments=variantsWithSegments.filter(function(segment){return!segment.language||segment.language&&variant.language&&segment.language.culture!==variant.language.culture}),sortedAvailableVariants=[].concat(_toConsumableArray(sortedAvailableVariants),[variant],_toConsumableArray(sortedMatchedSegments))}),sortedAvailableVariants=[].concat(_toConsumableArray(sortedAvailableVariants),_toConsumableArray(variantsWithSegments.sort(this.sortVariants)))}}}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}function contentTypeHelper(contentTypeResource,dataTypeResource,$filter,$injector,$q){var contentTypeHelperService={TYPE_GROUP:"Group",TYPE_TAB:"Tab",isAliasUnique:function isAliasUnique(groups,alias){return!groups.find(function(group){return group.alias===alias})},createUniqueAlias:function createUniqueAlias(groups,alias){for(var i=1;!1===this.isAliasUnique(groups,alias+i.toString());)i++;return alias+i.toString()},generateLocalAlias:function generateLocalAlias(name){return name?name.toUmbracoAlias():String.CreateGuid()},getLocalAlias:function getLocalAlias(alias){var lastIndex=alias.lastIndexOf("/");return-1===lastIndex?alias:alias.substring(lastIndex+1)},updateLocalAlias:function updateLocalAlias(alias,localAlias){var parentAlias=this.getParentAlias(alias);return null==parentAlias||""===parentAlias?localAlias:parentAlias+"/"+localAlias},getParentAlias:function getParentAlias(alias){if(alias){var lastIndex=alias.lastIndexOf("/");return-1===lastIndex?null:alias.substring(0,lastIndex)}return null},updateParentAlias:function updateParentAlias(alias,parentAlias){var localAlias=this.getLocalAlias(alias);return null==parentAlias||""===parentAlias?localAlias:parentAlias+"/"+localAlias},updateDescendingAliases:function updateDescendingAliases(groups,oldParentAlias,newParentAlias){var _this=this;groups.forEach(function(group){if(_this.getParentAlias(group.alias)===oldParentAlias){var oldAlias=group.alias,newAlias=_this.updateParentAlias(oldAlias,newParentAlias);group.alias=newAlias,group.parentAlias=newParentAlias,_this.updateDescendingAliases(groups,oldAlias,newAlias)}})},defineParentAliasOnGroups:function defineParentAliasOnGroups(groups){var _this2=this;groups.forEach(function(group){group.parentAlias=_this2.getParentAlias(group.alias)})},relocateDisorientedGroups:function relocateDisorientedGroups(groups){var _this3=this,existingAliases=groups.map(function(group){return group.alias});existingAliases.push(null),groups.filter(function(group){return-1===existingAliases.indexOf(group.parentAlias)}).forEach(function(group){var oldAlias=group.alias,newAlias=_this3.updateParentAlias(oldAlias,null);group.alias=newAlias,group.parentAlias=null,_this3.updateDescendingAliases(groups,oldAlias,newAlias)})},convertGroupToTab:function convertGroupToTab(groups,group){var _this4=this,tabs=groups.filter(function(group){return group.type===_this4.TYPE_TAB}).sort(function(a,b){return a.sortOrder-b.sortOrder}),nextSortOrder=tabs&&tabs.length>0?tabs[tabs.length-1].sortOrder+1:0;group.convertingToTab=!0,group.type=this.TYPE_TAB;var newAlias=this.generateLocalAlias(group.name),otherGroups=_toConsumableArray(groups).filter(function(groupCopy){return!groupCopy.convertingToTab});group.alias=this.isAliasUnique(otherGroups,newAlias)?newAlias:this.createUniqueAlias(otherGroups,newAlias),group.parentAlias=null,group.sortOrder=nextSortOrder,group.convertingToTab=!1},createIdArray:function createIdArray(array){var newArray=[];return array.forEach(function(arrayItem){Utilities.isObject(arrayItem)?newArray.push(arrayItem.id):newArray.push(arrayItem)}),newArray},generateModels:function generateModels(){var deferred=$q.defer(),modelsResource=$injector.has("modelsBuilderManagementResource")?$injector.get("modelsBuilderManagementResource"):null;return"Nothing"!==Umbraco.Sys.ServerVariables.umbracoPlugins.modelsBuilder.mode&&modelsResource?modelsResource.buildModels().then(function(result){deferred.resolve(result),modelsResource.getModelsOutOfDateStatus()},function(e){deferred.reject(e)}):deferred.resolve(!1),deferred.promise},checkModelsBuilderStatus:function checkModelsBuilderStatus(){var deferred=$q.defer(),modelsResource=$injector.has("modelsBuilderManagementResource")?$injector.get("modelsBuilderManagementResource"):null;return Umbraco&&Umbraco.Sys&&Umbraco.Sys.ServerVariables&&Umbraco.Sys.ServerVariables.umbracoPlugins&&Umbraco.Sys.ServerVariables.umbracoPlugins.modelsBuilder&&"Nothing"!==Umbraco.Sys.ServerVariables.umbracoPlugins.modelsBuilder.mode&&modelsResource?modelsResource.getModelsOutOfDateStatus().then(function(result){deferred.resolve(0===result.status)}):deferred.resolve(!1),deferred.promise},makeObjectArrayFromId:function makeObjectArrayFromId(idArray,objectArray){for(var newArray=[],idIndex=0;idArray.length>idIndex;idIndex++)for(var id=idArray[idIndex],objectIndex=0;objectArray.length>objectIndex;objectIndex++){var object=objectArray[objectIndex];id===object.id&&newArray.push(object)}return newArray},validateAddingComposition:function validateAddingComposition(contentType,compositeContentType){var propertiesAdding=_.flatten(_.map(compositeContentType.groups,function(g){return _.map(g.properties,function(p){return p.alias})})),propAliasesExisting=_.filter(_.flatten(_.map(contentType.groups,function(g){return _.map(g.properties,function(p){return p.alias})})),function(f){return null!=f}),intersec=_.intersection(propertiesAdding,propAliasesExisting);return intersec.length>0?intersec:[]},mergeCompositeContentType:function mergeCompositeContentType(contentType,compositeContentType){var overlappingAliases=this.validateAddingComposition(contentType,compositeContentType);if(overlappingAliases.length>0)throw new Error("Cannot add this composition, these properties already exist on the content type: "+overlappingAliases.join());return compositeContentType.groups.forEach(function(compositionGroup){compositionGroup.properties=$filter("orderBy")(compositionGroup.properties,"sortOrder"),compositionGroup.properties.forEach(function(property){dataTypeResource.getById(property.dataTypeId).then(function(dataType){property.dataTypeIcon=dataType.icon,property.dataTypeName=dataType.name})}),compositionGroup.inherited=!0,compositionGroup.properties.forEach(function(compositionProperty){compositionProperty.inherited=!0}),compositionGroup.tabState="inActive",contentType.groups.forEach(function(contentTypeGroup){if(contentTypeGroup.name===compositionGroup.name&&contentTypeGroup.type===compositionGroup.type){compositionGroup.groupIsMerged=!0,contentTypeGroup.inherited=!0,contentTypeGroup.properties=compositionGroup.properties.concat(contentTypeGroup.properties),contentTypeGroup.properties=contentTypeHelperService.updatePropertiesSortOrder(contentTypeGroup.properties),null!==contentTypeGroup.parentTabContentTypeNames&&void 0!==contentTypeGroup.parentTabContentTypeNames||(contentTypeGroup.parentTabContentTypeNames=[]),contentTypeGroup.parentTabContentTypeNames.push(compositeContentType.name),null!==contentTypeGroup.parentTabContentTypes&&void 0!==contentTypeGroup.parentTabContentTypes||(contentTypeGroup.parentTabContentTypes=[]),contentTypeGroup.parentTabContentTypes.push(compositeContentType.id),contentTypeGroup.sortOrder=compositionGroup.sortOrder;var contentTypeGroupCopy=Utilities.copy(contentTypeGroup),index=contentType.groups.indexOf(contentTypeGroup);contentType.groups.splice(index,1),contentType.groups.unshift(contentTypeGroupCopy)}}),!1!==compositionGroup.groupIsMerged&&void 0!==compositionGroup.groupIsMerged||(null!==compositionGroup.parentTabContentTypeNames&&void 0!==compositionGroup.parentTabContentTypeNames||(compositionGroup.parentTabContentTypeNames=[]),compositionGroup.parentTabContentTypeNames.push(compositeContentType.name),null!==compositionGroup.parentTabContentTypes&&void 0!==compositionGroup.parentTabContentTypes||(compositionGroup.parentTabContentTypes=[]),compositionGroup.parentTabContentTypes.push(compositeContentType.id),contentType.groups.unshift(compositionGroup))}),contentType.groups=$filter("orderBy")(contentType.groups,"sortOrder"),contentType},splitCompositeContentType:function splitCompositeContentType(contentType,compositeContentType){var groups=[];contentType.groups.forEach(function(contentTypeGroup){if("init"!==contentTypeGroup.tabState){var idIndex=contentTypeGroup.parentTabContentTypes.indexOf(compositeContentType.id),nameIndex=contentTypeGroup.parentTabContentTypeNames.indexOf(compositeContentType.name);contentType.groups.indexOf(contentTypeGroup);if(-1!==idIndex){var properties=[];contentTypeGroup.properties.forEach(function(property){property.contentTypeId!==compositeContentType.id&&properties.push(property)}),contentTypeGroup.properties=properties,contentTypeGroup.parentTabContentTypes.splice(idIndex,1),contentTypeGroup.parentTabContentTypeNames.splice(nameIndex,1),0===contentTypeGroup.parentTabContentTypes.length&&(contentTypeGroup.inherited=!1),contentTypeGroup.properties.length>0&&groups.push(contentTypeGroup)}else groups.push(contentTypeGroup)}else groups.push(contentTypeGroup);contentTypeGroup.properties=contentTypeHelperService.updatePropertiesSortOrder(contentTypeGroup.properties)}),contentType.groups=groups},updatePropertiesSortOrder:function updatePropertiesSortOrder(properties){var sortOrder=0;return properties.forEach(function(property){property.inherited||"init"===property.propertyState||(property.sortOrder=sortOrder),sortOrder++}),properties},getTemplatePlaceholder:function getTemplatePlaceholder(){return{name:"",icon:"icon-layout",alias:"templatePlaceholder",placeholder:!0}},insertDefaultTemplatePlaceholder:function insertDefaultTemplatePlaceholder(defaultTemplate){return contentTypeHelperService.getTemplatePlaceholder()},insertTemplatePlaceholder:function insertTemplatePlaceholder(array){var templatePlaceholder=contentTypeHelperService.getTemplatePlaceholder();return array.push(templatePlaceholder),array},insertChildNodePlaceholder:function insertChildNodePlaceholder(array,name,icon,id){var placeholder={name:name,icon:icon,id:id};array.push(placeholder)}};return contentTypeHelperService}function cropperHelper(umbRequestHelper,$http){var service={configuration:function configuration(mediaTypeAlias){return umbRequestHelper.resourcePromise($http.get(umbRequestHelper.getApiUrl("imageCropperApiBaseUrl","GetConfiguration",[{mediaTypeAlias:mediaTypeAlias}])),"Failed to retrieve tinymce configuration")},calculateAspectRatioFit:function calculateAspectRatioFit(srcWidth,srcHeight,maxWidth,maxHeight,maximize){var ratio=[maxWidth/srcWidth,maxHeight/srcHeight];return{width:srcWidth*(ratio=maximize?Math.max(ratio[0],ratio[1]):Math.min(ratio[0],ratio[1])),height:srcHeight*ratio,ratio:ratio}},calculateSizeToRatio:function calculateSizeToRatio(srcWidth,srcHeight,ratio){return{width:srcWidth*ratio,height:srcHeight*ratio,ratio:ratio}},scaleToMaxSize:function scaleToMaxSize(srcWidth,srcHeight,maxWidth,maxHeight){maxHeight=maxHeight||maxWidth;var ratio=Math.min(maxWidth/srcWidth,maxHeight/srcHeight,1);return{width:srcWidth*ratio,height:srcHeight*ratio}},convertToStyle:function convertToStyle(coordinates,originalSize,viewPort,offset){var coordinates_px=service.coordinatesToPixels(coordinates,originalSize,offset),_offset=offset||0,x=1-(coordinates.x1+Math.abs(coordinates.x2)),left_of_x=originalSize.width*x,ratio=viewPort.width/left_of_x;return{position:"absolute",top:-coordinates_px.y1*ratio+_offset,left:-coordinates_px.x1*ratio+_offset,width:Math.floor(originalSize.width*ratio),height:Math.floor(originalSize.height*ratio),originalWidth:originalSize.width,originalHeight:originalSize.height,ratio:ratio}},coordinatesToPixels:function coordinatesToPixels(coordinates,originalSize,offset){return{x1:Math.floor(coordinates.x1*originalSize.width),y1:Math.floor(coordinates.y1*originalSize.height),x2:Math.floor(coordinates.x2*originalSize.width),y2:Math.floor(coordinates.y2*originalSize.height)}},pixelsToCoordinates:function pixelsToCoordinates(image,width,height,offset){var x1_px=Math.abs(image.left-offset),y1_px=Math.abs(image.top-offset),x2_px=image.width-(x1_px+width),y2_px=image.height-(y1_px+height),crop={};return crop.x1=Math.max(x1_px/image.width,0),crop.y1=Math.max(y1_px/image.height,0),crop.x2=Math.max(x2_px/image.width,0),crop.y2=Math.max(y2_px/image.height,0),crop},alignToCoordinates:function alignToCoordinates(image,center,viewport){var min_left=image.width-viewport.width,min_top=image.height-viewport.height,c_top=-center.top*image.height+viewport.height/2,c_left=-center.left*image.width+viewport.width/2;return c_top<-min_top&&(c_top=-min_top),c_top>0&&(c_top=0),c_left<-min_left&&(c_left=-min_left),c_left>0&&(c_left=0),{left:c_left,top:c_top}},syncElements:function syncElements(source,target){target.height(source.height()),target.width(source.width()),target.css({top:source[0].offsetTop,left:source[0].offsetLeft})}};return service}function dataTypeHelper(){return{createPreValueProps:function createPreValueProps(preVals){for(var preValues=[],i=0;i<preVals.length;i++)preValues.push({hideLabel:preVals[i].hideLabel,alias:null!=preVals[i].key?preVals[i].key:preVals[i].alias,description:preVals[i].description,label:preVals[i].label,view:preVals[i].view,value:preVals[i].value,config:preVals[i].config});return preValues},rebindChangedProperties:function rebindChangedProperties(origContent,savedContent){var shouldIgnore=function shouldIgnore(propName){return _.some(["notifications","ModelState"],function(i){return i===propName})};for(var o in origContent)shouldIgnore(o)||_.isEqual(origContent[o],savedContent[o])||(origContent[o]=savedContent[o])}}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){if(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function eventsService($q,$rootScope){return{emit:function emit(name,args){$rootScope.$$listeners[name]&&$rootScope.$emit(name,args)},on:function on(name,callback){return $rootScope.$on(name,callback)},unsubscribe:function unsubscribe(handle){Utilities.isFunction(handle)&&handle()}}}function externalLoginInfoService(externalLoginInfo,umbRequestHelper){function getLoginProviderView(provider){return provider&&provider.properties&&provider.properties.CustomBackOfficeView?umbRequestHelper.convertVirtualToAbsolutePath(provider.properties.CustomBackOfficeView):null}return{hasDenyLocalLogin:function hasDenyLocalLogin(provider){return provider?provider&&provider.properties&&!0===provider.properties.DenyLocalLogin:_.some(externalLoginInfo.providers,function(x){return x.properties&&!0===x.properties.DenyLocalLogin})},getLoginProvider:function getLoginProvider(provider){return provider?_.find(externalLoginInfo.providers,function(x){return x.authType==provider}):null},getLoginProviders:function getLoginProviders(){return externalLoginInfo.providers},getLoginProvidersWithOptions:function getLoginProvidersWithOptions(){return _.filter(externalLoginInfo.providers,function(x){return x.customView=getLoginProviderView(x),!!x.customView||!!x.properties.AutoLinkOptions&&x.properties.AutoLinkOptions.AllowManualLinking})},getLoginProviderView:getLoginProviderView}}function fileManager($rootScope){var fileCollection=[],mgr={setFiles:function setFiles(args){if(!Utilities.isString(args.propertyAlias))throw"args.propertyAlias must be a non empty string";if(!Utilities.isObject(args.files))throw"args.files must be an object";args.culture||(args.culture=null),args.segment||(args.segment=null);var metaData=[];Utilities.isArray(args.metaData)&&(metaData=args.metaData),fileCollection=_.reject(fileCollection,function(item){return!(item.alias!==args.propertyAlias||args.culture&&args.culture!==item.culture||args.segment&&args.segment!==item.segment)});for(var i=0;i<args.files.length;i++)fileCollection.push({alias:args.propertyAlias,file:args.files[i],culture:args.culture,segment:args.segment,metaData:metaData})},getFiles:function getFiles(){return fileCollection},clearFiles:function clearFiles(){fileCollection=[]}};return $rootScope.$on("$routeChangeSuccess",function(event,current,previous){mgr.clearFiles()}),mgr}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}function formHelper(angularHelper,serverValidationManager,notificationsService,overlayService){return{submitForm:function submitForm(args){var currentForm;if(!args)throw"args cannot be null";if(!args.scope)throw"args.scope cannot be null";return currentForm=args.formCtrl?args.formCtrl:angularHelper.getRequiredCurrentForm(args.scope),args.scope.$broadcast("formSubmitting",{scope:args.scope,action:args.action}),this.focusOnFirstError(currentForm),args.scope.$broadcast("formSubmittingFinalPhase",{scope:args.scope,action:args.action}),currentForm.$setSubmitted(),!(!args.skipValidation&&currentForm.$invalid)&&(args.keepServerValidation?serverValidationManager.notify():serverValidationManager.reset(),!0)},focusOnFirstError:function focusOnFirstError(form){var firstInvalidNgForm=form.$$element.find(".umb-property ng-form.ng-invalid, .umb-property-editor ng-form.ng-invalid-required").first();if(0!==firstInvalidNgForm.length){var focusableFields=_toConsumableArray(firstInvalidNgForm.find("umb-range-slider .noUi-handle,input,textarea,select,button"));if(0!==focusableFields.length){var firstErrorEl=focusableFields.find(function(el){return"hidden"!==el.type&&!1===el.hasAttribute("readonly")});void 0!==firstErrorEl&&firstErrorEl.focus()}}},resetForm:function resetForm(args){var currentForm;if(!args)throw"args cannot be null";if(!args.scope)throw"args.scope cannot be null";(currentForm=args.formCtrl?args.formCtrl:angularHelper.getRequiredCurrentForm(args.scope)).$setPristine(),currentForm.$setUntouched(),args.scope.$broadcast(args.hasErrors?"formSubmittedValidationFailed":"formSubmitted",{scope:args.scope})},showNotifications:function showNotifications(args){if(!args||!args.notifications)return!1;if(Utilities.isArray(args.notifications)){for(var i=0;i<args.notifications.length;i++)notificationsService.showNotification(args.notifications[i]);return!0}return!1},handleError:function handleError(err){400===err.status?err.data&&err.data.ModelState&&(this.handleServerValidation(err.data.ModelState),serverValidationManager.notifyAndClearAllSubscriptions()):overlayService.ysod(err)},handleServerValidation:function handleServerValidation(modelState){serverValidationManager.addErrorsForModelState(modelState)}}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){if(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function iconHelper($http,$q,$sce,$timeout){var collectedIcons,converter=[{oldIcon:".sprNew",newIcon:"add"},{oldIcon:".sprDelete",newIcon:"remove"},{oldIcon:".sprMove",newIcon:"enter"},{oldIcon:".sprCopy",newIcon:"documents"},{oldIcon:".sprSort",newIcon:"navigation-vertical"},{oldIcon:".sprPublish",newIcon:"globe"},{oldIcon:".sprRollback",newIcon:"undo"},{oldIcon:".sprProtect",newIcon:"lock"},{oldIcon:".sprAudit",newIcon:"time"},{oldIcon:".sprNotify",newIcon:"envelope"},{oldIcon:".sprDomain",newIcon:"home"},{oldIcon:".sprPermission",newIcon:"lock"},{oldIcon:".sprRefresh",newIcon:"refresh"},{oldIcon:".sprBinEmpty",newIcon:"trash"},{oldIcon:".sprExportDocumentType",newIcon:"download-alt"},{oldIcon:".sprImportDocumentType",newIcon:"page-up"},{oldIcon:".sprLiveEdit",newIcon:"edit"},{oldIcon:".sprCreateFolder",newIcon:"add"},{oldIcon:".sprPackage2",newIcon:"box"},{oldIcon:".sprLogout",newIcon:"logout"},{oldIcon:".sprSave",newIcon:"save"},{oldIcon:".sprSendToTranslate",newIcon:"envelope-alt"},{oldIcon:".sprToPublish",newIcon:"mail-forward"},{oldIcon:".sprTranslate",newIcon:"comments"},{oldIcon:".sprUpdate",newIcon:"save"},{oldIcon:".sprTreeSettingDomain",newIcon:"icon-home"},{oldIcon:".sprTreeDoc",newIcon:"icon-document"},{oldIcon:".sprTreeDoc2",newIcon:"icon-diploma-alt"},{oldIcon:".sprTreeDoc3",newIcon:"icon-notepad"},{oldIcon:".sprTreeDoc4",newIcon:"icon-newspaper-alt"},{oldIcon:".sprTreeDoc5",newIcon:"icon-notepad-alt"},{oldIcon:".sprTreeDocPic",newIcon:"icon-picture"},{oldIcon:".sprTreeFolder",newIcon:"icon-folder"},{oldIcon:".sprTreeFolder_o",newIcon:"icon-folder"},{oldIcon:".sprTreeMediaFile",newIcon:"icon-music"},{oldIcon:".sprTreeMediaMovie",newIcon:"icon-movie"},{oldIcon:".sprTreeMediaPhoto",newIcon:"icon-picture"},{oldIcon:".sprTreeMember",newIcon:"icon-user"},{oldIcon:".sprTreeMemberGroup",newIcon:"icon-users"},{oldIcon:".sprTreeMemberType",newIcon:"icon-users"},{oldIcon:".sprTreeNewsletter",newIcon:"icon-file-text-alt"},{oldIcon:".sprTreePackage",newIcon:"icon-box"},{oldIcon:".sprTreeRepository",newIcon:"icon-server-alt"},{oldIcon:".sprTreeSettingDataType",newIcon:"icon-autofill"},{oldIcon:"folder.png",newIcon:"icon-folder"},{oldIcon:"mediaphoto.gif",newIcon:"icon-picture"},{oldIcon:"mediafile.gif",newIcon:"icon-document"},{oldIcon:".sprTreeDeveloperCacheItem",newIcon:"icon-box"},{oldIcon:".sprTreeDeveloperCacheTypes",newIcon:"icon-box"},{oldIcon:".sprTreeDeveloperMacro",newIcon:"icon-cogs"},{oldIcon:".sprTreeDeveloperRegistry",newIcon:"icon-windows"},{oldIcon:".sprTreeDeveloperPython",newIcon:"icon-linux"}],imageConverter=[{oldImage:"contour.png",newIcon:"icon-umb-contour"}],iconCache=[],promiseQueue=[],resourceLoadStatus="none";function init(){var deferred=$q.defer();return"loaded"===resourceLoadStatus?(deferred.resolve(iconCache),deferred.promise):"loading"===resourceLoadStatus?(promiseQueue.push(deferred),deferred.promise):(resourceLoadStatus="loading",$http({method:"GET",url:Umbraco.Sys.ServerVariables.umbracoUrls.iconApiBaseUrl+"GetIcons"}).then(function(response){resourceLoadStatus="loaded";for(var _i=0,_Object$entries=Object.entries(response.data);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];iconCache.push({name:key,svgString:$sce.trustAsHtml(value)})}for(var p in deferred.resolve(iconCache),promiseQueue)promiseQueue[p].resolve(iconCache)},function(err){for(var p in deferred.reject("Something broke"),promiseQueue)promiseQueue[p].reject("Something broke")}),deferred.promise)}return{formatContentTypeThumbnails:function formatContentTypeThumbnails(contentTypes){for(var i=0;i<contentTypes.length;i++)void 0===contentTypes[i].thumbnailIsClass||contentTypes[i].thumbnailIsClass?contentTypes[i].cssClass=this.convertFromLegacyIcon(contentTypes[i].thumbnail):(contentTypes[i].style="background-image: url('"+contentTypes[i].thumbnailFilePath+"');height:36px; background-position:4px 0px; background-repeat: no-repeat;background-size: 35px 35px;",contentTypes[i].cssClass="custom-file");return contentTypes},formatContentTypeIcons:function formatContentTypeIcons(contentTypes){for(var i=0;i<contentTypes.length;i++)contentTypes[i].icon?contentTypes[i].icon=this.convertFromLegacyIcon(contentTypes[i].icon):contentTypes[i].icon="icon-document",contentTypes[i].icon.indexOf(".")>0&&(contentTypes[i].icon="icon-document-dashed-line");return contentTypes},isFileBasedIcon:function isFileBasedIcon(icon){return!!(icon.startsWith("..")||!icon.startsWith(".")&&icon.indexOf(".")>1)},isLegacyIcon:function isLegacyIcon(icon){return!!icon&&(!icon.startsWith("..")&&!!icon.startsWith("."))},isLegacyTreeNodeIcon:function isLegacyTreeNodeIcon(treeNode){return!!treeNode.iconIsClass&&this.isLegacyIcon(treeNode.icon)},convertFromLegacyIcon:function convertFromLegacyIcon(icon){if(this.isLegacyIcon(icon)){var found=_.find(converter,function(item){return item.oldIcon.toLowerCase()===icon.toLowerCase()});return found?found.newIcon:icon}return icon},convertFromLegacyImage:function convertFromLegacyImage(icon){var found=_.find(imageConverter,function(item){return item.oldImage.toLowerCase()===icon.toLowerCase()});return found?found.newIcon:void 0},convertFromLegacyTreeNodeIcon:function convertFromLegacyTreeNodeIcon(treeNode){return this.isLegacyTreeNodeIcon(treeNode)?this.convertFromLegacyIcon(treeNode.icon):treeNode.icon},getIcon:function getIcon(iconName){return init().then(function(icons){return icons.find(function(i){return i.name===iconName})})},getAllIcons:function getAllIcons(){return init().then(function(icons){return icons})},getIcons:function getIcons(){var deferred=$q.defer();return $timeout(function(){if(collectedIcons)deferred.resolve(collectedIcons);else{collectedIcons=[];for(var i=document.styleSheets.length-1;i>=0;i--){var classes=null;try{classes=document.styleSheets[i].rules||document.styleSheets[i].cssRules}catch(e){console.warn("Can't read the css rules of: "+document.styleSheets[i].href,e);continue}if(null!==classes)for(var x=0;x<classes.length;x++){var cur=classes[x];if(cur.selectorText&&0===cur.selectorText.indexOf(".icon-")){var s=cur.selectorText.substring(1),hasSpace=s.indexOf(" ");hasSpace>0&&(s=s.substring(0,hasSpace));var hasPseudo=s.indexOf(":");hasPseudo>0&&(s=s.substring(0,hasPseudo)),collectedIcons.indexOf(s)<0&&collectedIcons.push(s)}}}deferred.resolve(collectedIcons)}},100),deferred.promise},defineIcon:function defineIcon(name,svg){var icon=iconCache.find(function(x){return x.name===name});return void 0===icon&&(icon={name:name,svgString:$sce.trustAsHtml(svg)},iconCache.push(icon)),icon},_getIconFromCache:function _getIconFromCache(iconName){return iconCache.find(function(icon){return icon.name===iconName})}}}function imageHelper(umbRequestHelper,mediaHelper){return{getImagePropertyValue:function getImagePropertyValue(options){return mediaHelper.getImagePropertyValue(options)},getThumbnail:function getThumbnail(options){return mediaHelper.getThumbnail(options)},scaleToMaxSize:function scaleToMaxSize(maxSize,width,height){return mediaHelper.scaleToMaxSize(maxSize,width,height)},getThumbnailFromPath:function getThumbnailFromPath(imagePath){return mediaHelper.getThumbnailFromPath(imagePath)},detectIfImageByExtension:function detectIfImageByExtension(imagePath){return mediaHelper.detectIfImageByExtension(imagePath)}}}function keyboardService($window,$timeout){var keyboardManagerService={},defaultOpt={type:"keydown",propagate:!1,inputDisabled:!1,target:$window.document,keyCode:!1},shift_nums={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},special_keys={esc:27,escape:27,tab:9,space:32,return:13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,break:19,insert:45,home:36,delete:46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},isMac=navigator.platform.toUpperCase().indexOf("MAC")>=0;function eventHandler(e){var code;(e=e||$window.event).keyCode?code=e.keyCode:e.which&&(code=e.which);var character=String.fromCharCode(code).toLowerCase();188===code&&(character=","),190===code&&(character=".");var propagate=!0;if(_.find(_.keys(keyboardManagerService.keyboardEvent),function(key){for(var shortcutLabel=key,shortcutVal=keyboardManagerService.keyboardEvent[key],kp=0,modifiers={shift:{wanted:!1,pressed:!!e.shiftKey},ctrl:{wanted:!1,pressed:!!e.ctrlKey},alt:{wanted:!1,pressed:!!e.altKey},meta:{wanted:!1,pressed:!!e.metaKey}},keys=shortcutLabel.split("+"),opt=shortcutVal.opt,callback=shortcutVal.callback,l=keys.length,i=0;i<l;i++){var k=keys[i];switch(k){case"ctrl":case"control":kp++,modifiers.ctrl.wanted=!0;break;case"shift":case"alt":case"meta":kp++,modifiers[k].wanted=!0}k.length>1?special_keys[k]===code&&kp++:opt.keyCode?opt.keyCode===code&&kp++:character===k?kp++:shift_nums[character]&&e.shiftKey&&(character=shift_nums[character])===k&&kp++}if(kp===keys.length&&modifiers.ctrl.pressed===modifiers.ctrl.wanted&&modifiers.shift.pressed===modifiers.shift.wanted&&modifiers.alt.pressed===modifiers.alt.wanted&&modifiers.meta.pressed===modifiers.meta.wanted){var elt;if(opt.inputDisabled)if(e.target?elt=e.target:e.srcElement&&(elt=e.srcElement),3===elt.nodeType&&(elt=elt.parentNode),"INPUT"===elt.tagName||"TEXTAREA"===elt.tagName||elt.hasAttribute("disable-hotkeys"))return!0;return $timeout(function(){callback(e)},1),opt.propagate||(propagate=!1),!0}return!1}),!propagate)return e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),!1}return keyboardManagerService.keyboardEvent={},keyboardManagerService.bind=function(label,callback,opt){var elt;isMac&&"ctrl+space"!==label&&(label=label.replace("ctrl","meta")),opt=Utilities.extend({},defaultOpt,opt),label=label.toLowerCase(),elt=opt.target,"string"==typeof opt.target&&(elt=document.getElementById(opt.target));var boundValues=_.values(keyboardManagerService.keyboardEvent),found=_.find(boundValues,function(i){return i.target===elt&&i.event===opt.type});keyboardManagerService.keyboardEvent[label]={callback:callback,target:elt,opt:opt},found||(elt.addEventListener?elt.addEventListener(opt.type,eventHandler,!1):elt.attachEvent?elt.attachEvent("on"+opt.type,eventHandler):elt["on"+opt.type]=eventHandler)},keyboardManagerService.unbind=function(label){label=label.toLowerCase();var binding=keyboardManagerService.keyboardEvent[label];if(delete keyboardManagerService.keyboardEvent[label],binding){var type=binding.event,elt=binding.target,callback=binding.callback;elt.detachEvent?elt.detachEvent("on"+type,callback):elt.removeEventListener?elt.removeEventListener(type,callback,!1):elt["on"+type]=!1}},keyboardManagerService}function macroService(){return{parseMacroSyntax:function parseMacroSyntax(syntax){var match=/(<\?UMBRACO_MACRO (?:.+?)?macroAlias=["']([^\"\'\n\r]+?)["'][\s\S]+?)(\/>|>.*?<\/\?UMBRACO_MACRO>)/i.exec(syntax);if(!match||match.length<3)return null;for(var paramMatch,alias=match[2],paramsChunk=match[1].trim().replace(new RegExp("UMBRACO_MACRO macroAlias=[\"']"+alias+"[\"']"),"").trim(),paramExpression=/(\w+?)=['\"]([\s\S]*?)['\"]/g,returnVal={macroAlias:alias,macroParamsDictionary:{}};paramMatch=paramExpression.exec(paramsChunk);)returnVal.macroParamsDictionary[paramMatch[1]]=paramMatch[2];return returnVal},generateMacroSyntax:function generateMacroSyntax(args){var macroString='<?UMBRACO_MACRO macroAlias="'+args.macroAlias+'" ';return args.macroParamsDictionary&&_.each(args.macroParamsDictionary,function(val,key){var keyVal;if(val=val||"",Utilities.isString(val))keyVal=key+'="'+(val||"")+'" ';else{var json=Utilities.toJson(val);keyVal=key+'="'+encodeURIComponent(json)+'" '}macroString+=keyVal}),macroString+="/>"},generateMvcSyntax:function generateMvcSyntax(args){var paramString,macroString='@await Umbraco.RenderMacroAsync("'+args.macroAlias+'"',hasParams=!1;return args.macroParamsDictionary&&(paramString=", new {",_.each(args.macroParamsDictionary,function(val,key){hasParams=!0,paramString+=key+'="'+(val||"")+'", '}),paramString=paramString.trimEnd(", "),paramString+="}"),hasParams&&(macroString+=paramString),macroString+=")"},collectValueData:function collectValueData(macro,macroParams,renderingEngine){var syntax,paramDictionary={},macroAlias=macro.alias;if(!macroAlias)throw"The macro object does not contain an alias";return _.each(macroParams,function(item){var val=item.value;if(null!==item.value&&void 0!==item.value&&!_.isString(item.value))try{val=Utilities.toJson(val)}catch(e){}paramDictionary[item.alias]=_.escape(val)}),syntax=renderingEngine&&"Mvc"===renderingEngine?this.generateMvcSyntax({macroAlias:macroAlias,macroParamsDictionary:paramDictionary}):this.generateMacroSyntax({macroAlias:macroAlias,macroParamsDictionary:paramDictionary}),{macroParamsDictionary:paramDictionary,macroAlias:macroAlias,syntax:syntax}}}}function mediaHelper(umbRequestHelper,$http,$log){var _mediaFileResolvers={};return{getMediaPropertyValue:function getMediaPropertyValue(options){if(!options||!options.mediaModel)throw"The options objet does not contain the required parameters: mediaModel";var props=[];options.mediaModel.properties?props=options.mediaModel.properties:$(options.mediaModel.tabs).each(function(i,tab){props=props.concat(tab.properties)});var mediaVal,mediaRoot=Umbraco.Sys.ServerVariables.umbracoSettings.mediaPath,imageProp=_.find(props,function(item){return"umbracoFile"===item.alias||!(!Utilities.isString(item.value)||0!==item.value.indexOf(mediaRoot))});if(!imageProp)return"";var split=imageProp.value.split(","),self=this;return(mediaVal=_.map(split,function(item){return{file:item,isImage:self.detectIfImageByExtension(item)}})).length&&mediaVal.length>0&&(!options.imageOnly||!0===options.imageOnly&&mediaVal[0].isImage)?mediaVal[0].file:""},getImagePropertyValue:function getImagePropertyValue(options){if(!options||!options.imageModel&&!options.mediaModel)throw"The options objet does not contain the required parameters: imageModel";return options.mediaModel=options.imageModel?options.imageModel:options.mediaModel,options.imageOnly=!0,this.getMediaPropertyValue(options)},getThumbnail:function getThumbnail(options){if(!options||!options.imageModel)throw"The options objet does not contain the required parameters: imageModel";var imagePropVal=this.getImagePropertyValue(options);return""!==imagePropVal?this.getThumbnailFromPath(imagePropVal):""},registerFileResolver:function registerFileResolver(propertyEditorAlias,func){_mediaFileResolvers[propertyEditorAlias]=func},resolveFileFromEntity:function resolveFileFromEntity(mediaEntity,thumbnail){var mediaPath=Utilities.isObject(mediaEntity.metaData)?mediaEntity.metaData.MediaPath:null;return mediaPath?thumbnail?this.detectIfImageByExtension(mediaPath)?this.getThumbnailFromPath(mediaPath):"svg"===this.getFileExtension(mediaPath)?this.getThumbnailFromPath(mediaPath):null:mediaPath:($log.warn("Cannot resolve the file url from the mediaEntity, it does not contain the required metaData"),null)},resolveFile:function resolveFile(mediaItem,thumbnail){function iterateProps(props){var res=null;for(var resolver in _mediaFileResolvers){var property=_.find(props,function(prop){return prop.editor===resolver});if(property){res=_mediaFileResolvers[resolver](property,mediaItem,thumbnail);break}}return res}var result="";if(mediaItem.properties)result=iterateProps(mediaItem.properties);else if(mediaItem.tabs)for(var tab in mediaItem.tabs)if(mediaItem.tabs[tab].properties&&(result=iterateProps(mediaItem.tabs[tab].properties)))break;return result},hasFilePropertyType:function hasFilePropertyType(mediaItem){function iterateProps(props){var res=!1;for(var resolver in _mediaFileResolvers){if(_.find(props,function(prop){return prop.editor===resolver})){res=!0;break}}return res}var result=!1;if(mediaItem.properties)result=iterateProps(mediaItem.properties);else if(mediaItem.tabs)for(var tab in mediaItem.tabs)if(mediaItem.tabs[tab].properties&&(result=iterateProps(mediaItem.tabs[tab].properties)))break;return result},scaleToMaxSize:function scaleToMaxSize(maxSize,width,height){var retval={width:width,height:height},maxWidth=maxSize,maxHeight=maxSize,ratio=0;return width>maxWidth&&(ratio=maxWidth/width,retval.width=maxWidth,retval.height=height*ratio,height*=ratio,width*=ratio),height>maxHeight&&(ratio=maxHeight/height,retval.height=maxHeight,retval.width=width*ratio,width*=ratio),retval},getThumbnailFromPath:function getThumbnailFromPath(imagePath){return"svg"===this.getFileExtension(imagePath)?imagePath:this.detectIfImageByExtension(imagePath)?umbRequestHelper.getApiUrl("imagesApiBaseUrl","GetBigThumbnail",[{originalImagePath:imagePath}])+"&rnd="+Math.random():null},detectIfImageByExtension:function detectIfImageByExtension(imagePath){if(!imagePath)return!1;var lowered=imagePath.toLowerCase(),ext=lowered.substr(lowered.lastIndexOf(".")+1);return-1!==(","+Umbraco.Sys.ServerVariables.umbracoSettings.imageFileTypes+",").indexOf(","+ext+",")},formatFileTypes:function formatFileTypes(fileTypes){for(var fileTypesArray=fileTypes.split(","),newFileTypesArray=[],i=0;i<fileTypesArray.length;i++){var fileType=fileTypesArray[i].trim();fileType&&(0!==fileType.indexOf(".")&&(fileType=".".concat(fileType)),newFileTypesArray.push(fileType))}return newFileTypesArray.join(",")},getFileExtension:function getFileExtension(filePath){if(!filePath)return null;var lowered=filePath.toLowerCase();return lowered.substr(lowered.lastIndexOf(".")+1)},getProcessedImageUrl:function getProcessedImageUrl(imagePath,options){return options?umbRequestHelper.resourcePromise($http.get(umbRequestHelper.getApiUrl("imagesApiBaseUrl","GetProcessedImageUrl",{imagePath:imagePath,width:options.width,height:options.height,focalPointLeft:options.focalPoint?options.focalPoint.left:null,focalPointTop:options.focalPoint?options.focalPoint.top:null,mode:options.mode,cacheBusterValue:options.cacheBusterValue,cropX1:options.crop?options.crop.x1:null,cropX2:options.crop?options.crop.x2:null,cropY1:options.crop?options.crop.y1:null,cropY2:options.crop?options.crop.y2:null})),"Failed to retrieve processed image URL for image: "+imagePath):imagePath}}}function mediaTypeHelper(mediaTypeResource,$q){var mediaTypeHelperService={isFolderType:function isFolderType(mediaEntity){if(!mediaEntity)throw"mediaEntity is null";if(!mediaEntity.contentTypeAlias)throw"mediaEntity.contentTypeAlias is null";return mediaEntity.contentTypeAlias.endsWith("Folder")},getAllowedImagetypes:function getAllowedImagetypes(mediaId){return mediaTypeResource.getAllowedTypes(mediaId).then(function(types){var allowedQ=types.map(function(type){return mediaTypeResource.getById(type.id)});return $q.all(allowedQ).then(function(fullTypes){return mediaTypeHelperService.getTypeWithEditor(fullTypes,["Umbraco.ImageCropper","Umbraco.UploadField"])})})},getTypeWithEditor:function getTypeWithEditor(types,editors){return types.filter(function(mediatype){for(var i=0;i<mediatype.groups.length;i++)for(var group=mediatype.groups[i],j=0;j<group.properties.length;j++){var property=group.properties[j];if(-1!==editors.indexOf(property.editor))return mediatype}})},getTypeAcceptingFileExtensions:function getTypeAcceptingFileExtensions(mediaTypes,fileExtensions){return mediaTypes.filter(function(mediaType){var uploadProperty,acceptedFileExtensions;return mediaType.groups.forEach(function(group){var foundProperty=group.properties.find(function(property){return"umbracoFile"===property.alias});foundProperty&&(uploadProperty=foundProperty)}),!!uploadProperty&&("Umbraco.ImageCropper"===uploadProperty.editor?acceptedFileExtensions=Umbraco.Sys.ServerVariables.umbracoSettings.imageFileTypes:"Umbraco.UploadField"===uploadProperty.editor&&(acceptedFileExtensions=uploadProperty.config.fileExtensions&&uploadProperty.config.fileExtensions.length>0?uploadProperty.config.fileExtensions.map(function(x){return x.value}):null),!(acceptedFileExtensions&&acceptedFileExtensions.length>0)||fileExtensions.length===fileExtensions.filter(function(fileExt){return acceptedFileExtensions.includes(fileExt)}).length)})}};return mediaTypeHelperService}function umbracoMenuActions(treeService,$location,navigationService,appState,localizationService,usersResource,umbRequestHelper,notificationsService){return{ExportMember:function ExportMember(args){var url=umbRequestHelper.getApiUrl("memberApiBaseUrl","ExportMemberData",[{key:args.entity.id}]);umbRequestHelper.downloadFile(url).then(function(){localizationService.localize("speechBubbles_memberExportedSuccess").then(function(value){notificationsService.success(value)})},function(data){localizationService.localize("speechBubbles_memberExportedError").then(function(value){notificationsService.error(value)})})},DisableUser:function DisableUser(args){localizationService.localize("defaultdialogs_confirmdisable").then(function(txtConfirmDisable){UmbClientMgr.mainTree().getActionNode();confirm(txtConfirmDisable+' "'+args.entity.name+'"?\n\n')&&usersResource.disableUser(args.entity.id).then(function(){navigationService.syncTree({tree:args.treeAlias,path:[args.entity.parentId,args.entity.id],forceReload:!0})})})},RefreshNode:function RefreshNode(args){var treeRoot=appState.getTreeState("currentRootNode");if(treeRoot&&treeRoot.root){var treeNode=treeService.getDescendantNode(treeRoot.root,args.entity.id,args.treeAlias);treeNode&&treeService.loadNodeChildren({node:treeNode,section:args.section}).then(function(){navigationService.hideMenu()})}},CreateChildEntity:function CreateChildEntity(args){navigationService.hideNavigation();var route="/"+args.section+"/"+args.treeAlias+"/edit/"+args.entity.id;$location.path(route).search({create:!0})}}}function navigationService($routeParams,$location,$q,$injector,eventsService,umbModelMapper,treeService,appState,backdropService){var navReadyPromise=$q.defer(),mainTreeApi=null;eventsService.on("app.navigationReady",function(e,args){mainTreeApi=args.treeApi,navReadyPromise.resolve(mainTreeApi)}),eventsService.on("appState.backdrop",function(e,args){$(args.element).addClass("above-backdrop")});var nonRoutingQueryStrings=["mculture","cculture","csegment","lq","sr"],retainedQueryStrings=["mculture"];function setMode(mode){switch(mode){case"tree":appState.setGlobalState("navMode","tree"),appState.setGlobalState("showNavigation",!0),appState.setMenuState("showMenu",!1),appState.setMenuState("showMenuDialog",!1),appState.setGlobalState("stickyNavigation",!1),appState.setGlobalState("showTray",!1);break;case"menu":appState.setGlobalState("navMode","menu"),appState.setGlobalState("showNavigation",!0),appState.setMenuState("showMenu",!0),appState.setMenuState("showMenuDialog",!1),appState.setGlobalState("stickyNavigation",!0);break;case"dialog":appState.setGlobalState("navMode","dialog"),appState.setGlobalState("stickyNavigation",!0),appState.setGlobalState("showNavigation",!0),appState.setMenuState("showMenu",!1),appState.setMenuState("showMenuDialog",!0),appState.setMenuState("allowHideMenuDialog",!0);break;case"search":appState.setGlobalState("navMode","search"),appState.setGlobalState("stickyNavigation",!1),appState.setGlobalState("showNavigation",!0),appState.setMenuState("showMenu",!1),appState.setSectionState("showSearchResults",!0),appState.setMenuState("showMenuDialog",!1);break;default:appState.setGlobalState("navMode","default"),appState.setMenuState("showMenu",!1),appState.setMenuState("showMenuDialog",!1),appState.setMenuState("allowHideMenuDialog",!0),appState.setSectionState("showSearchResults",!1),appState.setGlobalState("stickyNavigation",!1),appState.setGlobalState("showTray",!1),appState.setMenuState("currentNode",null),!0===appState.getGlobalState("isTablet")&&appState.setGlobalState("showNavigation",!1)}}function pathToRouteParts(requestPath){if(!Utilities.isString(requestPath))throw"The value for requestPath is not a string";var pathAndQuery=requestPath.split("#")[1];if(pathAndQuery){(pathAndQuery.indexOf("%253")||pathAndQuery.indexOf("%252"))&&(pathAndQuery=decodeURIComponent(pathAndQuery));for(var pathParts=pathAndQuery.split("?"),path=pathParts[0],qryParts=(1===pathParts.length?"":pathParts[1]).split("&"),result={path:path},i=0;i<qryParts.length;i++){var keyVal=qryParts[i].split("=");2==keyVal.length&&(result[keyVal[0]]=keyVal[1])}return result}}function closeBackdrop(){if(!document.body.classList.contains("umb-tour-is-visible")){var leftColumn=document.getElementById("leftcolumn");if(leftColumn)leftColumn.classList.contains("above-backdrop")&&(backdropService.close(),leftColumn.classList.remove("above-backdrop"))}}function showBackdrop(){var backDropOptions={element:document.getElementById("leftcolumn")};backdropService.open(backDropOptions)}var service={isRouteChangingNavigation:function isRouteChangingNavigation(currUrlParams,nextUrlParams){if(Utilities.isString(currUrlParams)&&(currUrlParams=pathToRouteParts(currUrlParams)),Utilities.isString(nextUrlParams)&&(nextUrlParams=pathToRouteParts(nextUrlParams)),!0===nextUrlParams.sr)return!1;var allowRoute=!0,currRoutingKeys=_.difference(_.keys(currUrlParams),nonRoutingQueryStrings),nextRoutingKeys=_.difference(_.keys(nextUrlParams),nonRoutingQueryStrings),diff1=_.difference(currRoutingKeys,nextRoutingKeys),diff2=_.difference(nextRoutingKeys,currRoutingKeys);if(0===diff1.length&&0===diff2.length){var partsChanged=0;currRoutingKeys.forEach(function(k){currUrlParams[k]!=nextUrlParams[k]&&partsChanged++}),0===partsChanged&&(allowRoute=!1)}return allowRoute},waitForNavReady:function waitForNavReady(){return navReadyPromise.promise},clearSearch:function clearSearch(toRetain){toRetain=_.union(retainedQueryStrings,toRetain);var currentSearch=$location.search();$location.search(""),toRetain.forEach(function(k){currentSearch[k]&&$location.search(k,currentSearch[k])})},setSoftRedirect:function setSoftRedirect(){$location.search("sr",!0)},retainQueryStrings:function retainQueryStrings(currRouteParams,nextRouteParams){var toRetain=Utilities.copy(nextRouteParams),updated=!1;return retainedQueryStrings.forEach(function(r){currRouteParams[r]&&void 0!==nextRouteParams[r]&&!nextRouteParams[r]&&(toRetain[r]=currRouteParams[r],updated=!0)}),updated?toRetain:null},loadLegacyIFrame:function loadLegacyIFrame(source){$location.path("/"+appState.getSectionState("currentSection")+"/framed/"+encodeURIComponent(source))},changeSection:function changeSection(sectionAlias,force){setMode("default-opensection"),force&&appState.getSectionState("currentSection")===sectionAlias&&appState.setSectionState("currentSection",""),appState.setSectionState("currentSection",sectionAlias),this.showTree(sectionAlias),$location.path(sectionAlias)},showTree:function showTree(sectionAlias,syncArgs){return sectionAlias!==appState.getSectionState("currentSection")&&(appState.setSectionState("currentSection",sectionAlias),syncArgs)?this.syncTree(syncArgs):(setMode("tree"),$q.when(!0))},showTray:function showTray(){appState.setGlobalState("showTray",!0)},hideTray:function hideTray(){appState.setGlobalState("showTray",!1)},syncTree:function syncTree(args){if(!args)throw"args cannot be null";if(!args.path)throw"args.path cannot be null";if(!args.tree)throw"args.tree cannot be null";return navReadyPromise.promise.then(function(){return mainTreeApi.syncTree(args)})},hasTree:function hasTree(treeAlias){return navReadyPromise.promise.then(function(){return mainTreeApi.hasTree(treeAlias)})},_syncPath:function _syncPath(path,forceReload){return navReadyPromise.promise.then(function(){return mainTreeApi.syncTree({path:path,forceReload:forceReload})})},reloadNode:function reloadNode(node){return navReadyPromise.promise.then(function(){return mainTreeApi.reloadNode(node)})},reloadSection:function reloadSection(sectionAlias){return navReadyPromise.promise.then(function(){return treeService.clearCache({section:sectionAlias}),mainTreeApi.load(sectionAlias)})},hideTree:function hideTree(){!0!==appState.getGlobalState("isTablet")||appState.getGlobalState("stickyNavigation")||(appState.setSectionState("currentSection",$routeParams.section),setMode("default-hidesectiontree"))},showMenu:function showMenu(args){var self=this;return treeService.getMenu({treeNode:args.node}).then(function(data){if(showBackdrop(),data.defaultAlias&&!args.skipDefault){var found=_.find(data.menuItems,function(item){return item.alias=data.defaultAlias});if(found)return appState.setMenuState("currentNode",args.node),self.showDialog({node:args.node,action:found,section:appState.getSectionState("currentSection")}),$q.resolve()}return setMode("menu"),appState.setMenuState("currentNode",args.node),appState.setMenuState("menuActions",data.menuItems),appState.setMenuState("dialogTitle",args.node.name),$q.resolve()})},hideMenu:function hideMenu(){appState.setMenuState("currentNode",null),appState.setMenuState("menuActions",[]),setMode("tree"),closeBackdrop()},executeMenuAction:function executeMenuAction(action,node,section){if(!action)throw"action cannot be null";if(!node)throw"node cannot be null";if(!section)throw"section cannot be null";if(appState.setMenuState("currentNode",node),action.metaData&&action.metaData.actionRoute&&Utilities.isString(action.metaData.actionRoute)){var parts=action.metaData.actionRoute.split("?");return $location.path(parts[0]).search(parts.length>1?parts[1]:""),void this.hideNavigation()}if(action.metaData&&action.metaData.jsAction&&Utilities.isString(action.metaData.jsAction)){var menuAction=action.metaData.jsAction.split(".");if(2!==menuAction.length){var js=action.metaData.jsAction.replace("javascript:","");eval(js)}else{var menuActionService=$injector.get(menuAction[0]);if(!menuActionService)throw"The angular service "+menuAction[0]+" could not be found";var method=menuActionService[menuAction[1]];if(!method)throw"The method "+menuAction[1]+" on the angular service "+menuAction[0]+" could not be found";method.apply(this,[{entity:umbModelMapper.convertToEntityBasic(node),action:action,section:section,treeAlias:treeService.getTreeAlias(node)}])}}else showBackdrop(),service.showDialog({node:node,action:action,section:section})},showDialog:function showDialog(args){if(!args)throw"showDialog is missing the args parameter";if(!args.action)throw"The args parameter must have an 'action' property as the clicked menu action object";if(!args.node)throw"The args parameter must have a 'node' as the active tree node";var templateUrl;if(args.action.metaData.dialogTitle?appState.setMenuState("dialogTitle",args.action.metaData.dialogTitle):appState.setMenuState("dialogTitle",args.action.name),args.action.metaData.actionView)templateUrl=args.action.metaData.actionView;else{var treeAlias=treeService.getTreeAlias(args.node);if(!treeAlias)throw"Could not get tree alias for node "+args.node.id;templateUrl=this.getTreeTemplateUrl(treeAlias,args.action.alias)}setMode("dialog"),templateUrl&&appState.setMenuState("dialogTemplateUrl",templateUrl)},getTreeTemplateUrl:function getTreeTemplateUrl(treeAlias,action){var packageTreeFolder=treeService.getTreePackageFolder(treeAlias);return packageTreeFolder?Umbraco.Sys.ServerVariables.umbracoSettings.appPluginsPath+"/"+packageTreeFolder+"/backoffice/"+treeAlias+"/"+action+".html":("views/"+treeAlias+"/"+action+".html").toLowerCase()},allowHideDialog:function allowHideDialog(allow){"dialog"===appState.getGlobalState("navMode")&&appState.setMenuState("allowHideMenuDialog",allow)},hideDialog:function hideDialog(showMenu){!1!==appState.getMenuState("allowHideMenuDialog")&&(showMenu?this.showMenu({skipDefault:!0,node:appState.getMenuState("currentNode")}):(closeBackdrop(),setMode("default")))},showSearch:function showSearch(){setMode("search")},hideSearch:function hideSearch(){setMode("default-hidesearch")},hideNavigation:function hideNavigation(){appState.setMenuState("menuActions",[]),closeBackdrop(),setMode("default")}};return service}function searchResultFormatter(umbRequestHelper){return{configureContentResult:function configureContentResult(content,treeAlias,appAlias){content.menuUrl=umbRequestHelper.getApiUrl("contentTreeBaseUrl","GetMenu",[{id:content.id},{application:appAlias}]),content.editorPath=appAlias+"/"+treeAlias+"/edit/"+content.id,Utilities.extend(content.metaData,{treeAlias:treeAlias}),content.subTitle=content.metaData.Url},configureMemberResult:function configureMemberResult(member,treeAlias,appAlias){member.menuUrl=umbRequestHelper.getApiUrl("memberTreeBaseUrl","GetMenu",[{id:member.id},{application:appAlias}]),member.editorPath=appAlias+"/"+treeAlias+"/edit/"+(member.key?member.key:member.id),Utilities.extend(member.metaData,{treeAlias:treeAlias}),member.subTitle=member.metaData.Email},configureMediaResult:function configureMediaResult(media,treeAlias,appAlias){media.menuUrl=umbRequestHelper.getApiUrl("mediaTreeBaseUrl","GetMenu",[{id:media.id},{application:appAlias}]),media.editorPath=appAlias+"/"+treeAlias+"/edit/"+media.id,Utilities.extend(media.metaData,{treeAlias:treeAlias})},configureDefaultResult:function configureDefaultResult(content,treeAlias,appAlias){content.editorPath=appAlias+"/"+treeAlias+"/edit/"+content.id,Utilities.extend(content.metaData,{treeAlias:treeAlias})}}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){if(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function serverValidationManager($timeout){var callbacks=[],errorMsgItems=[],defaultMatchOptions={matchType:null};function executeCallback(errorsForCallback,callback,culture,segment,isValid){callback.apply(instance,[isValid,errorsForCallback,errorMsgItems,culture,segment])}function getFieldErrors(fieldName){if(!Utilities.isString(fieldName))throw"fieldName must be a string";return _.filter(errorMsgItems,function(item){return null===item.propertyAlias&&"invariant"===item.culture&&item.fieldName===fieldName})}function getPropertyErrors(propertyAlias,culture,segment,fieldName,options){if(!Utilities.isString(propertyAlias))throw"propertyAlias must be a string";if(fieldName&&!Utilities.isString(fieldName))throw"fieldName must be a string";return culture||(culture="invariant"),segment||(segment=null),options||(options=defaultMatchOptions),_.filter(errorMsgItems,function(errMsgItem){return!!errMsgItem.propertyAlias&&(function matchErrMsgItemProperty(errMsgItem,propertyValidationKey,options){if(errMsgItem.propertyAlias===propertyValidationKey)return!0;if("prefix"===options.matchType&&errMsgItem.propertyAlias.startsWith(propertyValidationKey+"/"))return!0;if("suffix"===options.matchType&&errMsgItem.propertyAlias.endsWith("/"+propertyValidationKey))return!0;if("contains"===options.matchType&&errMsgItem.propertyAlias.includes("/"+propertyValidationKey+"/"))return!0;return!1}(errMsgItem,propertyAlias,options)&&errMsgItem.culture===culture&&errMsgItem.segment===segment&&(options.matchType||errMsgItem.fieldName===fieldName||void 0===fieldName||""===fieldName))})}function notifyCallback(cb){if(null===cb.propertyAlias&&null!==cb.fieldName){var fieldErrors=getFieldErrors(cb.fieldName),valid=0===fieldErrors.length;executeCallback(fieldErrors,cb.callback,cb.culture,cb.segment,valid)}else if(null!=cb.propertyAlias){var propErrors=getPropertyErrors(cb.propertyAlias,cb.culture,cb.segment,cb.fieldName,cb.options),_valid=0===propErrors.length;executeCallback(propErrors,cb.callback,cb.culture,cb.segment,_valid)}else{var variantErrors=function getVariantErrors(culture,segment){return culture||(culture="invariant"),segment||(segment=null),_.filter(errorMsgItems,function(item){return item.culture===culture&&item.segment===segment})}(cb.culture,cb.segment),_valid2=0===variantErrors.length;executeCallback(variantErrors,cb.callback,cb.culture,cb.segment,_valid2)}}function notifyCallbacks(){0!==errorMsgItems.length&&callbacks.forEach(function(cb){return notifyCallback(cb)})}function parseComplexEditorError(errorMsg,parentPropertyAlias){var json=Utilities.isArray(errorMsg)?errorMsg:JSON.parse(errorMsg),result=[];function extractModelState(validation,parentPath){if(validation.$id&&validation.ModelState){var ms={validationPath:"".concat(parentPath,"/").concat(validation.$id),modelState:validation.ModelState};return result.push(ms),ms}return null}return function iterateErrorBlocks(blocks,parentPath){for(var i=0;i<blocks.length;i++){var validation=blocks[i],ms=extractModelState(validation,parentPath);if(ms)for(var nested=_.omit(validation,"$id","$elementTypeAlias","ModelState"),_i=0,_Object$entries=Object.entries(nested);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];Array.isArray(value)&&iterateErrorBlocks(value,"".concat(ms.validationPath,"/").concat(key))}}}(json,parentPropertyAlias),result}function getFieldCallbacks(fieldName){return _.filter(callbacks,function(item){return null===item.propertyAlias&&"invariant"===item.culture&&null===item.segment&&item.fieldName===fieldName})}function addFieldError(fieldName,errorMsg){if(fieldName){hasFieldError(fieldName)||errorMsgItems.push({propertyAlias:null,culture:"invariant",segment:null,fieldName:fieldName,errorMsg:errorMsg});var errorsForCallback=getFieldErrors(fieldName),cbs=getFieldCallbacks(fieldName);for(var cb in cbs)executeCallback(errorsForCallback,cbs[cb].callback,null,null,!1)}}function _addPropertyError(propertyAlias,culture,fieldName,errorMsg,segment){if(propertyAlias){if(culture||(culture="invariant"),segment||(segment=null),errorMsg||(errorMsg=""),Utilities.isString(errorMsg)&&(errorMsg=errorMsg.trimStartSpecial().trim()),Utilities.isString(errorMsg)&&errorMsg.startsWith("[")||Utilities.isArray(errorMsg))parseComplexEditorError(errorMsg,propertyAlias).forEach(function(x){return addErrorsForModelState(x.modelState,x.validationPath)}),errorMsg="";hasPropertyError(propertyAlias,culture,fieldName,segment)||errorMsgItems.push({propertyAlias:propertyAlias,culture:culture,segment:segment,fieldName:fieldName,errorMsg:errorMsg})}}function hasPropertyError(propertyAlias,culture,fieldName,segment){return culture||(culture="invariant"),segment||(segment=null),!!_.find(errorMsgItems,function(item){return item.propertyAlias===propertyAlias&&item.culture===culture&&item.segment===segment&&(item.fieldName===fieldName||void 0===fieldName||""===fieldName)})}function hasFieldError(fieldName){return!!_.find(errorMsgItems,function(item){return null===item.propertyAlias&&"invariant"===item.culture&&null===item.segment&&item.fieldName===fieldName})}function addErrorsForModelState(modelState,parentValidationPath){if(!Utilities.isObject(modelState))throw"modelState is not an object";for(var _i2=0,_Object$entries2=Object.entries(modelState);_i2<_Object$entries2.length;_i2++){var _Object$entries2$_i=_slicedToArray(_Object$entries2[_i2],2),key=_Object$entries2$_i[0],value=_Object$entries2$_i[1],parts=key.split(".");if(parts.length>1&&"_Properties"===parts[0]){var propertyValidationKey=createPropertyValidationKey(parts[1],parentValidationPath),culture=null;parts.length>2&&"null"===(culture=parts[2])&&(culture=null);var segment=null;parts.length>3&&"null"===(segment=parts[3])&&(segment=null);var htmlFieldReference="";parts.length>4&&(htmlFieldReference=parts[4]||""),_addPropertyError(propertyValidationKey,culture,htmlFieldReference,value&&Array.isArray(value)&&value.length>0?value[0]:null,segment)}else addFieldError(key,value[0])}hasPropertyError&&notifyCallbacks()}function createPropertyValidationKey(propertyAlias,parentValidationPath){return parentValidationPath?parentValidationPath+"/"+propertyAlias:propertyAlias}function clear(){errorMsgItems=[]}var instance={addErrorsForModelState:addErrorsForModelState,parseComplexEditorError:parseComplexEditorError,createPropertyValidationKey:createPropertyValidationKey,notifyAndClearAllSubscriptions:function notifyAndClearAllSubscriptions(){$timeout(function(){notifyCallbacks(),clear()})},notify:function notify(){$timeout(function(){for(var i=0;i<errorMsgItems.length;i++)errorMsgItems[i];notifyCallbacks()})},subscribe:function subscribe(propertyAlias,culture,fieldName,callback,segment,options){if(callback){var id=String.CreateGuid();culture||(culture="invariant"),segment||(segment=null);var cb=null;return null===propertyAlias?cb={propertyAlias:null,culture:culture,segment:segment,fieldName:fieldName,callback:callback,id:id}:void 0!==propertyAlias&&(cb={propertyAlias:propertyAlias,culture:culture,segment:segment,fieldName:fieldName,callback:callback,id:id,options:options}),callbacks.push(cb),notifyCallback(cb),function unsubscribeId(){callbacks=_.reject(callbacks,function(item){return item.id===id})}}},unsubscribe:function unsubscribe(propertyAlias,culture,fieldName,segment){culture||(culture="invariant"),segment||(segment=null),null===propertyAlias?callbacks=_.reject(callbacks,function(item){return null===item.propertyAlias&&item.culture===culture&&item.segment===segment&&item.fieldName===fieldName}):void 0!==propertyAlias&&(callbacks=_.reject(callbacks,function(item){return!(item.propertyAlias!==propertyAlias||item.culture!==culture||item.segment!==segment||item.fieldName!==fieldName&&(void 0!==item.fieldName&&""!==item.fieldName||void 0!==fieldName&&""!==fieldName))}))},getPropertyCallbacks:function getPropertyCallbacks(propertyAlias,culture,fieldName,segment){return culture||(culture="invariant"),segment||(segment=null),_.filter(callbacks,function(cb){return cb.options||(cb.options=defaultMatchOptions),function matchCallbackItemProperty(cb,propertyValidationKey){return cb.propertyAlias===propertyValidationKey||(!("prefix"!==cb.options.matchType||!propertyValidationKey.startsWith(cb.propertyAlias+"/"))||(!("suffix"!==cb.options.matchType||!propertyValidationKey.endsWith("/"+cb.propertyAlias))||!("contains"!==cb.options.matchType||!propertyValidationKey.includes("/"+cb.propertyAlias+"/"))))}(cb,propertyAlias)&&cb.culture===culture&&cb.segment===segment&&(cb.options.matchType||cb.fieldName===fieldName||void 0===cb.fieldName||""===cb.fieldName)})},getFieldCallbacks:getFieldCallbacks,getCultureCallbacks:function getCultureCallbacks(culture){return _.filter(callbacks,function(item){return item.culture===culture&&null===item.segment&&null===item.propertyAlias&&null===item.fieldName})},getVariantCallbacks:function getVariantCallbacks(culture,segment){return _.filter(callbacks,function(item){return item.culture===culture&&item.segment===segment&&null===item.propertyAlias&&null===item.fieldName})},addFieldError:addFieldError,addPropertyError:function addPropertyError(propertyAlias,culture,fieldName,errorMsg,segment){_addPropertyError(propertyAlias,culture,fieldName,errorMsg,segment),notifyCallbacks()},removePropertyError:function removePropertyError(propertyAlias,culture,fieldName,segment,options){var errors=getPropertyErrors(propertyAlias,culture,segment,fieldName,options);errorMsgItems=errorMsgItems.filter(function(v){return-1===errors.indexOf(v)}),errors.length>0&&notifyCallbacks()},reset:function reset(){for(var cb in clear(),callbacks)callbacks[cb].callback.apply(instance,[!0,[],[],null,null])},clear:clear,getPropertyError:function getPropertyError(propertyAlias,culture,fieldName,segment){var errors=getPropertyErrors(propertyAlias,culture,segment,fieldName);if(errors.length>0)return errors[0]},getPropertyErrorsByValidationPath:function getPropertyErrorsByValidationPath(propertyValidationPath,culture,segment,options){return getPropertyErrors(propertyValidationPath,culture,segment,"",options)},getFieldError:function getFieldError(fieldName){return _.find(errorMsgItems,function(item){return null===item.propertyAlias&&"invariant"===item.culture&&null===item.segment&&item.fieldName===fieldName})},hasPropertyError:hasPropertyError,hasFieldError:hasFieldError,hasCultureError:function hasCultureError(culture){return culture||(culture="invariant"),!!_.find(errorMsgItems,function(item){return item.culture===culture&&null===item.segment})},hasVariantError:function hasVariantError(culture,segment){return culture||(culture="invariant"),segment||(segment=null),!!_.find(errorMsgItems,function(item){return item.culture===culture&&item.segment===segment})}};return Object.defineProperty(instance,"items",{get:function get(){return errorMsgItems},set:function set(value){throw"Cannot set the items array"}}),instance}function tinyMceService($rootScope,$q,imageHelper,$locale,$http,$timeout,stylesheetResource,macroResource,macroService,$routeParams,umbRequestHelper,angularHelper,userService,editorService,entityResource,eventsService,localStorageService,mediaHelper){var fallbackStyles=[{title:"Page header",block:"h2"},{title:"Section header",block:"h3"},{title:"Paragraph header",block:"h4"},{title:"Normal",block:"p"},{title:"Quote",block:"blockquote"},{title:"Code",block:"code"}],availableLanguages=["ar","ar_SA","hy","az","eu","be","bn_BD","bs","bg_BG","ca","zh_CN","zh_TW","hr","cs","da","dv","nl","en_CA","en_GB","et","fo","fi","fr_FR","gd","gl","ka_GE","de","de_AT","el","he_IL","hi_IN","hu_HU","is_IS","id","it","ja","kab","kk","km_KH","ko_KR","ku","ku_IQ","lv","lt","lb","ml","ml_IN","mn_MN","nb_NO","fa","fa_IR","pl","pt_BR","pt_PT","ro","ru","sr","si_LK","sk","sl_SI","es","es_MX","sv_SE","tg","ta","ta_IN","tt","th_TH","tr","tr_TR","ug","uk","uk_UA","vi","vi_VN","cy"],defaultLanguage="en_US";function getStyles(configuredStylesheets){var stylesheets=[],styleFormats=[],promises=[$q.when(!0)];return configuredStylesheets?configuredStylesheets.forEach(function(val,key){0===val.indexOf(Umbraco.Sys.ServerVariables.umbracoSettings.cssPath+"/")?stylesheets.push(val):stylesheets.push(Umbraco.Sys.ServerVariables.umbracoSettings.cssPath+"/"+val+".css"),promises.push(stylesheetResource.getRulesByName(val).then(function(rules){rules.forEach(function(rule){var r={};if(r.title=rule.name,"."==rule.selector[0])r.inline="span",r.classes=rule.selector.substring(1);else if("#"===rule.selector[0])r.inline="span",r.attributes={id:rule.selector.substring(1)};else if("."!==rule.selector[0]&&rule.selector.indexOf(".")>-1){var split=rule.selector.split(".");r.block=split[0],r.classes=rule.selector.substring(rule.selector.indexOf(".")+1).replace(/\./g," ")}else if("#"!=rule.selector[0]&&rule.selector.indexOf("#")>-1){split=rule.selector.split("#");r.block=split[0],r.classes=rule.selector.substring(rule.selector.indexOf("#")+1)}else r.block=rule.selector;styleFormats.push(r)})}))}):styleFormats=fallbackStyles,$q.all(promises).then(function(){return stylesheets.push("".concat(Umbraco.Sys.ServerVariables.umbracoSettings.umbracoPath,"/assets/css/rte-content.css")),$q.when({stylesheets:stylesheets,styleFormats:styleFormats})})}function getLanguage(){var language=defaultLanguage,localeId=$locale.id.replace("-","_"),languageMatch=_.find(availableLanguages,function(o){return o.toLowerCase()===localeId});if(void 0===languageMatch){var localeParts=localeId.split("_");languageMatch=_.find(availableLanguages,function(o){return o===localeParts[0]})}return void 0!==languageMatch&&(language=languageMatch),language}function uploadImageHandler(blobInfo,success,failure,progress){var xhr,formData;(xhr=new XMLHttpRequest).open("POST",Umbraco.Sys.ServerVariables.umbracoUrls.tinyMceApiBaseUrl+"UploadImage"),xhr.onloadstart=function(e){angularHelper.safeApply($rootScope,function(){eventsService.emit("rte.file.uploading")})},xhr.onloadend=function(e){angularHelper.safeApply($rootScope,function(){eventsService.emit("rte.file.uploaded")})},xhr.upload.onprogress=function(e){progress(e.loaded/e.total*100)},xhr.onerror=function(){failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status)},xhr.onload=function(){var json;xhr.status<200||xhr.status>=300?failure("HTTP Error: "+xhr.status):(json=JSON.parse(xhr.responseText))&&"string"==typeof json.tmpLocation?(localStorageService.set("tinymce__".concat(blobInfo.blobUri()),json.tmpLocation),success(blobInfo.blobUri())):failure("Invalid JSON: "+xhr.responseText)},(formData=new FormData).append("file",blobInfo.blob(),blobInfo.blob().name),xhr.send(formData)}function cleanupPasteData(plugin,args){args.content=args.content.replace(/<\s*span[^>]*>(.*?)<\s*\/\s*span>/g,"$1"),args.content=args.content.replace(/<\s*b([^>]*)>(.*?)<\s*\/\s*b([^>]*)>/g,"<strong$1>$2</strong$3>"),args.content=args.content.replace(/<\s*i([^>]*)>(.*?)<\s*\/\s*i([^>]*)>/g,"<em$1>$2</em$3>")}function sizeImageInEditor(editor,imageDomElement,imgUrl){var size=editor.dom.getSize(imageDomElement);if(editor.settings.maxImageSize&&0!==editor.settings.maxImageSize){var newSize=imageHelper.scaleToMaxSize(editor.settings.maxImageSize,size.w,size.h);editor.dom.setAttrib(imageDomElement,"width",newSize.width),editor.dom.setAttrib(imageDomElement,"height",newSize.height),imgUrl&&mediaHelper.getProcessedImageUrl(imgUrl,{width:newSize.width,height:newSize.height}).then(function(resizedImgUrl){editor.dom.setAttrib(imageDomElement,"data-mce-src",resizedImgUrl)}),editor.execCommand("mceAutoResize",!1,null,null)}}function isMediaPickerEnabled(toolbarItemArray){var insertMediaButtonFound=!1;return toolbarItemArray.forEach(function(toolbarItem){toolbarItem.indexOf("umbmediapicker")>-1&&(insertMediaButtonFound=!0)}),insertMediaButtonFound}return{getTinyMceEditorConfig:function getTinyMceEditorConfig(args){tinymce.DOM.events.domLoaded=!0,tinymce.baseURL=Umbraco.Sys.ServerVariables.umbracoSettings.umbracoPath+"/lib/tinymce/";var promises=[this.configuration(),getStyles(args.stylesheets)];return $q.all(promises).then(function(result){var tinyMceConfig=result[0],styles=result[1],toolbars=function getToolbars(configuredToolbar,tinyMceConfig){var allowedSelectionToolbar=_.map(_.filter(tinyMceConfig.commands,function(f){return"Selection"===f.mode||"All"===f.mode}),function(f){return f.alias}),allowedInsertToolbar=_.map(_.filter(tinyMceConfig.commands,function(f){return"Insert"===f.mode||"All"===f.mode}),function(f){return f.alias});return{insertToolbar:_.filter(configuredToolbar,function(t){return-1!==allowedInsertToolbar.indexOf(t)}).join(" | "),selectionToolbar:_.filter(configuredToolbar,function(t){return-1!==allowedSelectionToolbar.indexOf(t)}).join(" | ")}}(args.toolbar,tinyMceConfig),plugins=_.map(tinyMceConfig.plugins,function(plugin){return plugin.name});plugins.push("autoresize"),plugins.push("noneditable"),plugins.includes("table")&&plugins.push("colorpicker");var modeTheme="",modeInline=!1;switch(args.mode){case"classic":modeTheme="modern",modeInline=!1;break;case"distraction-free":modeTheme="inlite",modeInline=!0;break;default:modeTheme="modern",modeInline=!1}var config={theme:modeTheme,inline:modeInline,plugins:plugins,valid_elements:tinyMceConfig.validElements,invalid_elements:tinyMceConfig.inValidElements,extended_valid_elements:"@[id|class|style],-div[id|dir|class|align|style],ins[datetime|cite],-ul[class|style],-li[class|style],-h1[id|dir|class|align|style],-h2[id|dir|class|align|style],-h3[id|dir|class|align|style],-h4[id|dir|class|align|style],-h5[id|dir|class|align|style],-h6[id|style|dir|class|align],span[id|class|style|lang]",menubar:!1,statusbar:!1,relative_urls:!1,autoresize_bottom_margin:10,content_css:styles.stylesheets,style_formats:styles.styleFormats,language:getLanguage(),toolbar:args.toolbar.join(" "),insert_toolbar:toolbars.insertToolbar,selection_toolbar:toolbars.selectionToolbar,body_class:"umb-rte",cache_suffix:"?umb__rnd="+Umbraco.Sys.ServerVariables.application.cacheBuster};isMediaPickerEnabled(args.toolbar)&&(config.images_upload_handler=uploadImageHandler,config.automatic_uploads=!1,config.images_replace_blob_uris=!1,config.paste_data_images=!0),args.htmlId?config.selector="#"+args.htmlId:args.target&&(config.target=args.target);var pasteConfig={paste_remove_styles:!0,paste_text_linebreaktype:!0,paste_strip_class_attributes:"none",paste_preprocess:cleanupPasteData};if(Utilities.extend(config,pasteConfig),tinyMceConfig.customConfig){for(var i in tinyMceConfig.customConfig){var val=tinyMceConfig.customConfig[i];if(val){if((val=val.toString().trim()).detectIsJson())try{tinyMceConfig.customConfig[i]=JSON.parse(val),Utilities.isArray(config[i])&&Utilities.isArray(tinyMceConfig.customConfig[i])&&(tinyMceConfig.customConfig[i]=config[i].concat(tinyMceConfig.customConfig[i]))}catch(e){}"true"===val&&(tinyMceConfig.customConfig[i]=!0),"false"===val&&(tinyMceConfig.customConfig[i]=!1)}}Utilities.extend(config,tinyMceConfig.customConfig)}return config})},configuration:function configuration(){return umbRequestHelper.resourcePromise($http.get(umbRequestHelper.getApiUrl("rteApiBaseUrl","GetConfiguration"),{cache:!0}),"Failed to retrieve tinymce configuration")},defaultPrevalues:function defaultPrevalues(){var cfg={toolbar:["ace","styleselect","bold","italic","alignleft","aligncenter","alignright","bullist","numlist","outdent","indent","link","umbmediapicker","umbmacro","umbembeddialog"],stylesheets:[],maxImageSize:500};return cfg},createInsertEmbeddedMedia:function createInsertEmbeddedMedia(editor,callback){editor.addButton("umbembeddialog",{icon:"custom icon-tv",tooltip:"Embed",stateSelector:"div[data-embed-url]",onclick:function onclick(){var selectedElm=editor.selection.getNode(),nodeName=selectedElm.nodeName,modify=null;if("DIV"===nodeName.toUpperCase()&&selectedElm.classList.contains("embeditem")){var embedUrl=editor.dom.getAttrib(selectedElm,"data-embed-url"),embedWidth=editor.dom.getAttrib(selectedElm,"data-embed-width"),embedHeight=editor.dom.getAttrib(selectedElm,"data-embed-height"),embedConstrain=editor.dom.getAttrib(selectedElm,"data-embed-constrain");modify={url:embedUrl,width:parseInt(embedWidth)||0,height:parseInt(embedHeight)||0,constrain:embedConstrain}}callback&&angularHelper.safeApply($rootScope,function(){callback(selectedElm,modify)})}})},insertEmbeddedMediaInEditor:function insertEmbeddedMediaInEditor(editor,embed,activeElement){var wrapper=tinymce.activeEditor.dom.create("div",{class:"mceNonEditable embeditem","data-embed-url":embed.url,"data-embed-height":embed.height,"data-embed-width":embed.width,"data-embed-constrain":embed.constrain,contenteditable:!1},embed.preview);activeElement&&"DIV"===activeElement.nodeName.toUpperCase()&&activeElement.classList.contains("embeditem")?activeElement.replaceWith(wrapper):editor.selection.setNode(wrapper)},createAceCodeEditor:function createAceCodeEditor(editor,callback){editor.addButton("ace",{icon:"code",tooltip:"View Source Code",onclick:function onclick(){callback&&angularHelper.safeApply($rootScope,function(){callback()})}})},createMediaPicker:function createMediaPicker(editor,callback){editor.addButton("umbmediapicker",{icon:"custom icon-picture",tooltip:"Media Picker",stateSelector:"img[data-udi]",onclick:function onclick(){var currentTarget,imgDomElement,selectedElm=editor.selection.getNode();if("IMG"===selectedElm.nodeName){var img=$(selectedElm);imgDomElement=selectedElm;var hasUdi=!!img.attr("data-udi"),hasDataTmpImg=!!img.attr("data-tmpimg");currentTarget={altText:img.attr("alt"),url:img.attr("src")},hasUdi?currentTarget.udi=img.attr("data-udi"):currentTarget.id=img.attr("rel"),hasDataTmpImg&&(currentTarget.tmpimg=img.attr("data-tmpimg"))}userService.getCurrentUser().then(function(userData){callback&&angularHelper.safeApply($rootScope,function(){callback(currentTarget,userData,imgDomElement)})})}})},insertMediaInEditor:function insertMediaInEditor(editor,img,imgDomElement){if(img)if(imgDomElement){var hasImageSrcChanged=!1;img.url!==editor.dom.getAttrib(imgDomElement,"src")&&(hasImageSrcChanged=!0),editor.dom.setAttrib(imgDomElement,"alt",img.altText),img.udi&&editor.dom.setAttrib(imgDomElement,"data-udi",img.udi),img.url&&editor.dom.setAttrib(imgDomElement,"src",img.url),hasImageSrcChanged&&(editor.dom.setAttrib(imgDomElement,"width",null),editor.dom.setAttrib(imgDomElement,"height",null),sizeImageInEditor(editor,imgDomElement,img.url))}else{var data={alt:img.altText||"",src:img.url?img.url:"nothing.jpg",id:"__mcenew","data-udi":img.udi};editor.selection.setContent(editor.dom.createHTML("img",data)),$timeout(function(){var imgElm=editor.dom.get("__mcenew");editor.dom.setAttrib(imgElm,"id",null);var onImageLoaded=function onImageLoaded(){sizeImageInEditor(editor,imgElm,img.url),editor.fire("Change")};!0===imgElm.complete?onImageLoaded():imgElm.onload=onImageLoaded})}},createInsertMacro:function createInsertMacro(editor,callback){var self=this,activeMacroElement=null;editor.on("preInit",function(args){editor.serializer.addRules("div"),editor.serializer.addNodeFilter("div",function(nodes,name){for(var i=0;i<nodes.length;i++)"umb-macro-holder"===nodes[i].attr("class")&&nodes[i].parent&&"P"===nodes[i].parent.name.toUpperCase()&&nodes[i].parent.unwrap()})}),editor.on("SetContent",function(o){$(editor.dom.select(".umb-macro-holder.mceNonEditable")).each(function(){self.loadMacroContent($(this),null,editor)})}),editor.addButton("umbmacro",{icon:"custom icon-settings-alt",tooltip:"Insert macro",onPostRender:function onPostRender(){var ctrl=this;editor.on("NodeChange",function onNodeChanged(evt){activeMacroElement=function getRealMacroElem(element){var e=$(element).closest(".umb-macro-holder");return e.length>0?"P"===e.get(0).parentNode.nodeName&&1===element.parentNode.childNodes.length?e.get(0).parentNode:e.get(0):null}(evt.element),ctrl.active(null!==activeMacroElement)})},onclick:function onclick(){var dialogData={richTextEditor:!0};if(activeMacroElement){var contents=$(activeMacroElement).contents(),comment=_.find(contents,function(item){return 8===item.nodeType});if(!comment)throw"Cannot parse the current macro, the syntax in the editor is invalid";var syntax=comment.textContent.trim(),parsed=macroService.parseMacroSyntax(syntax);dialogData={macroData:parsed,activeMacroElement:activeMacroElement}}callback&&angularHelper.safeApply($rootScope,function(){callback(dialogData)})}})},insertMacroInEditor:function insertMacroInEditor(editor,macroObject,activeMacroElement){var macroSyntaxComment="\x3c!-- "+macroObject.syntax+" --\x3e",uniqueId="umb-macro-"+editor.dom.uniqueId(),macroDiv=editor.dom.create("div",{class:"umb-macro-holder "+macroObject.macroAlias+" "+uniqueId+" mceNonEditable",contenteditable:"false"},macroSyntaxComment+"<ins>Macro alias: <strong>"+macroObject.macroAlias+"</strong></ins>");activeMacroElement?activeMacroElement.replaceWith(macroDiv):editor.selection.setNode(macroDiv);var $macroDiv=$(editor.dom.select("div.umb-macro-holder."+uniqueId));editor.setDirty(!0),this.loadMacroContent($macroDiv,macroObject,editor)},loadMacroContent:function loadMacroContent($macroDiv,macroData,editor){if(!macroData){var contents=$macroDiv.contents(),comment=_.find(contents,function(item){return 8===item.nodeType});if(!comment)throw"Cannot parse the current macro, the syntax in the editor is invalid";var syntax=comment.textContent.trim(),parsed=macroService.parseMacroSyntax(syntax);macroData=parsed}var $ins=$macroDiv.find("ins");$macroDiv.addClass("loading"),$macroDiv.attr("contenteditable","false");var contentId=$routeParams.id;angularHelper.safeApply($rootScope,function(){macroResource.getMacroResultAsHtmlForEditor(macroData.macroAlias,contentId,macroData.macroParamsDictionary).then(function(htmlResult){if($macroDiv.removeClass("loading"),""!==(htmlResult=htmlResult.trim())){var wasDirty=editor.isDirty();$ins.html(htmlResult),wasDirty||editor.undoManager.clear()}})})},createLinkPicker:function createLinkPicker(editor,onClick){function createLinkList(callback){return function(){var linkList=editor.settings.link_list;"string"==typeof linkList?tinymce.util.XHR.send({url:linkList,success:function success(text){callback(tinymce.util.JSON.parse(text))}}):callback(linkList)}}function showDialog(linkList){var selectedElm,anchorElm,win,data={},selection=editor.selection,dom=editor.dom;function linkListChangeHandler(e){var textCtrl=win.find("#text");(!textCtrl.value()||e.lastControl&&textCtrl.value()===e.lastControl.text())&&textCtrl.value(e.control.text()),win.find("#href").value(e.control.value())}selectedElm=selection.getNode(),anchorElm=dom.getParent(selectedElm,"a[href]"),data.text=anchorElm?anchorElm.innerText||anchorElm.textContent:selection.getContent({format:"text"}),data.href=anchorElm?dom.getAttrib(anchorElm,"href"):"",data.target=anchorElm?dom.getAttrib(anchorElm,"target"):"",data.rel=anchorElm?dom.getAttrib(anchorElm,"rel"):"","IMG"===selectedElm.nodeName&&(data.text=" "),linkList&&function buildLinkList(){var linkListItems=[{text:"None",value:""}];return tinymce.each(linkList,function(link){linkListItems.push({text:link.text||link.title,value:link.value||link.url,menu:link.menu})}),linkListItems}(),!1!==editor.settings.target_list&&function buildTargetList(targetValue){var targetListItems=[{text:"None",value:""}];return editor.settings.target_list||targetListItems.push({text:"New window",value:"_blank"}),tinymce.each(editor.settings.target_list,function(target){targetListItems.push({text:target.text||target.title,value:target.value,selected:targetValue===target.value})}),targetListItems}(data.target),editor.settings.rel_list&&function buildRelList(relValue){var relListItems=[{text:"None",value:""}];return tinymce.each(editor.settings.rel_list,function(rel){relListItems.push({text:rel.text||rel.title,value:rel.value,selected:relValue===rel.value})}),relListItems}(data.rel);var currentTarget=null;if(anchorElm){var anchor=$(anchorElm);currentTarget={name:anchor.attr("title"),url:anchor.attr("href"),target:anchor.attr("target")};var anchorVal=anchor[0].dataset.anchor;if(anchorVal&&(currentTarget.anchor=anchorVal.substring(1)),currentTarget.url.indexOf("localLink:")>0){var linkId=currentTarget.url.substring(currentTarget.url.indexOf(":")+1,currentTarget.url.lastIndexOf("}")),parsedIntId=parseInt(linkId,10);isNaN(parsedIntId)?currentTarget.udi=linkId:currentTarget.id=linkId}}angularHelper.safeApply($rootScope,function(){onClick&&onClick(currentTarget,anchorElm)})}editor.addButton("link",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onclick:createLinkList(showDialog),stateSelector:"a[href]"}),editor.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink",stateSelector:"a[href]"}),editor.addShortcut("Ctrl+K","",createLinkList(showDialog)),this.showDialog=showDialog,editor.addMenuItem("link",{icon:"link",text:"Insert link",shortcut:"Ctrl+K",onclick:createLinkList(showDialog),stateSelector:"a[href]",context:"insert",prependToContext:!0}),editor.addShortcut("Ctrl+S","",function(){angularHelper.safeApply($rootScope,function(){eventsService.emit("rte.shortcut.save")})})},insertLinkInEditor:function insertLinkInEditor(editor,target,anchorElm){var href=target.url,id=!!target.udi?target.udi:target.id?target.id:null;if(target.anchor&&"?"!==target.anchor[0]&&"#"!==target.anchor[0]&&(target.anchor=(-1===target.anchor.indexOf("=")?"#":"?")+target.anchor),!target.anchor){var urlParts=href.split(/(#|\?)/);3===urlParts.length&&(href=urlParts[0],target.anchor=urlParts[1]+urlParts[2])}function createElemAttributes(){var a={href:href,title:target.name,target:target.target?target.target:null,rel:target.rel?target.rel:null};return target.anchor?(a["data-anchor"]=target.anchor,a.href=a.href+target.anchor):a["data-anchor"]=null,a}function insertLink(){anchorElm?(editor.dom.setAttribs(anchorElm,createElemAttributes()),editor.selection.select(anchorElm),editor.execCommand("mceEndTyping")):editor.execCommand("mceInsertLink",!1,createElemAttributes())}if(href||target.anchor)return id?(href="/{localLink:"+id+"}",void insertLink()):(href||(href=""),href.indexOf("@")>0&&-1===href.indexOf("//")&&-1===href.indexOf(":")?(href="mailto:"+href,void insertLink()):/^\s*www\./i.test(href)?(href="http://"+href,void insertLink()):void insertLink());editor.execCommand("unlink")},pinToolbar:function pinToolbar(editor){if(editor.editorContainer){var tinyMce=$(editor.editorContainer),toolbar=tinyMce.find(".mce-toolbar"),toolbarHeight=toolbar.height(),tinyMceRect=editor.editorContainer.getBoundingClientRect(),tinyMceTop=tinyMceRect.top,tinyMceBottom=tinyMceRect.bottom,tinyMceWidth=tinyMceRect.width;tinyMce.find(".mce-edit-area").css("padding-top",toolbarHeight),tinyMceTop<177&&177+toolbarHeight<tinyMceBottom?toolbar.css("position","fixed").css("top","177px").css("left","auto").css("right","auto").css("width",tinyMceWidth):toolbar.css("position","absolute").css("left","").css("right","").css("top","").css("width","")}},unpinToolbar:function unpinToolbar(editor){var tinyMce=$(editor.editorContainer),toolbar=tinyMce.find(".mce-toolbar");tinyMce.find(".mce-edit-area").css("padding-top","0"),toolbar.css("position","static")},initializeEditor:function initializeEditor(args){if(!args.editor)throw"args.editor is required";args.editor.suffix=".min";var unwatch=null;function startWatch(){unwatch=$rootScope.$watch(function(){return args.model.value},function(newVal,oldVal){newVal!==oldVal&&(args.editor.setContent(newVal||"",{format:"raw"}),args.editor.fire("LoadContent",null))})}function syncContent(){args.model.value!==args.editor.getContent()&&(!function stopWatch(){unwatch&&unwatch()}(),angularHelper.safeApply($rootScope,function(){args.model.value=args.editor.getContent(),args.currentForm&&args.currentForm.$setDirty(),args.currentFormInput&&args.currentFormInput.$setDirty()}),startWatch())}!1===isMediaPickerEnabled(args.editor.settings.toolbar.split(" "))&&args.editor.on("dragend dragover draggesture dragdrop drop drag",function(e){e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none",e.stopPropagation()}),args.editor.on("SetContent",function(e){-1!==e.content.search(/src=["']blob:.*?["']/gi)&&(args.editor.uploadImages(function(data){data.forEach(function(item){var img=item.element,imgSrc=img.getAttribute("src"),tmpLocation=localStorageService.get("tinymce__".concat(imgSrc));tinymce.activeEditor.$(img).attr({"data-tmpimg":tmpLocation}),sizeImageInEditor(args.editor,img)})}),args.editor.dom.select("img[src^='blob:']:not([data-tmpimg])").forEach(function(imageElement){var blobSrcUri=args.editor.dom.getAttrib(imageElement,"src"),tmpLocation=localStorageService.get("tinymce__".concat(blobSrcUri));tmpLocation&&(sizeImageInEditor(args.editor,imageElement),args.editor.dom.setAttrib(imageElement,"data-tmpimg",tmpLocation))}))}),args.editor.on("init",function(e){args.model.value&&args.editor.setContent(args.model.value),args.editor.getBody().setAttribute("spellcheck",!0),startWatch()}),args.editor.on("Change",function(e){syncContent()}),args.editor.on("Keyup",function(e){syncContent()}),args.editor.on("blur",function(e){syncContent()}),args.editor.on("ObjectResized",function(e){var path=$(e.target).attr("src").split("?")[0];mediaHelper.getProcessedImageUrl(path,{width:e.width,height:e.height,mode:"max"}).then(function(resizedPath){$(e.target).attr("data-mce-src",resizedPath)}),syncContent()}),args.editor.on("Dirty",function(e){syncContent()});var self=this;self.createLinkPicker(args.editor,function(currentTarget,anchorElement){entityResource.getAnchors(args.model.value).then(function(anchorValues){var linkPicker={currentTarget:currentTarget,dataTypeKey:args.model.dataTypeKey,ignoreUserStartNodes:args.model.config.ignoreUserStartNodes,anchors:anchorValues,size:args.model.config.editor.overlayWidthSize,submit:function submit(model){self.insertLinkInEditor(args.editor,model.target,anchorElement),editorService.close()},close:function close(){editorService.close()}};editorService.linkPicker(linkPicker)})}),self.createMediaPicker(args.editor,function(currentTarget,userData,imgDomElement){var startNodeId,startNodeIsVirtual;args.model.config.startNodeId||(!0===args.model.config.ignoreUserStartNodes?(startNodeId=-1,startNodeIsVirtual=!0):(startNodeId=1!==userData.startMediaIds.length?-1:userData.startMediaIds[0],startNodeIsVirtual=1!==userData.startMediaIds.length));var mediaPicker={currentTarget:currentTarget,onlyImages:!0,showDetails:!0,disableFolderSelect:!0,disableFocalPoint:!0,startNodeId:startNodeId,startNodeIsVirtual:startNodeIsVirtual,dataTypeKey:args.model.dataTypeKey,submit:function submit(model){self.insertMediaInEditor(args.editor,model.selection[0],imgDomElement),editorService.close()},close:function close(){editorService.close()}};editorService.mediaPicker(mediaPicker)}),self.createInsertEmbeddedMedia(args.editor,function(activeElement,modify){var embed={modify:modify,submit:function submit(model){self.insertEmbeddedMediaInEditor(args.editor,model.embed,activeElement),editorService.close()},close:function close(){editorService.close()}};editorService.embed(embed)}),self.createInsertMacro(args.editor,function(dialogData){var macroPicker={dialogData:dialogData,submit:function submit(model){var macroObject=macroService.collectValueData(model.selectedMacro,model.macroParams,dialogData.renderingEngine);self.insertMacroInEditor(args.editor,macroObject,dialogData.activeMacroElement),editorService.close()},close:function close(){editorService.close()}};editorService.macroPicker(macroPicker)}),self.createAceCodeEditor(args.editor,function(){var aceEditor={content:args.editor.getContent(),view:"views/propertyeditors/rte/codeeditor.html",submit:function submit(model){args.editor.setContent(model.content),args.editor.fire("Change"),editorService.close()},close:function close(){editorService.close()}};editorService.open(aceEditor)})}}}function treeService($q,treeResource,iconHelper,notificationsService,eventsService){var treeCache={};function getCacheKey(args){if(!args||!args.cacheKey)return null;var cacheKey=args.cacheKey;return cacheKey+="_"+args.section}return{_getTreeCache:function _getTreeCache(){return treeCache},_trackExpandedPaths:function _trackExpandedPaths(node,expandedPaths){if(node.children&&Utilities.isArray(node.children)&&0!=node.children.length){var childPath=this.getPath(node.children[node.children.length-1]).join(",");if(!expandedPaths.includes(childPath))if(0!==expandedPaths.length)expandedPaths.slice(0).forEach(function(p){childPath.startsWith(p+",")?(expandedPaths.splice(expandedPaths.indexOf(p),1),!1===expandedPaths.includes(childPath)&&expandedPaths.push(childPath)):p.startsWith(childPath+",")||!1===expandedPaths.includes(childPath)&&expandedPaths.push(childPath)});else expandedPaths.push(childPath)}},_formatNodeDataForUseInUI:function _formatNodeDataForUseInUI(parentNode,treeNodes,section,level){var childLevel=level||1;parentNode.section||(parentNode.section=section),parentNode.metaData&&!0===parentNode.metaData.noAccess&&(parentNode.cssClasses||(parentNode.cssClasses=[]),parentNode.cssClasses.push("no-access"));for(var funcParent=function funcParent(){return parentNode},i=0;i<treeNodes.length;i++){var treeNode=treeNodes[i];if(treeNode.level=childLevel,treeNode.parent=funcParent,treeNode.section=section,!treeNode.routePath)if(treeNode.metaData&&treeNode.metaData.treeAlias)treeNode.routePath=section;else{var treeAlias=this.getTreeAlias(treeNode);treeNode.routePath=section+"/"+treeAlias+"/edit/"+treeNode.id}if(void 0===treeNode.iconIsClass||treeNode.iconIsClass){var converted=iconHelper.convertFromLegacyTreeNodeIcon(treeNode);treeNode.cssClass="icon umb-tree-icon sprTree "+converted,converted&&converted.startsWith(".")?treeNode.style="height:16px;width:16px;":treeNode.style=""}else treeNode.style="background-image: url('"+treeNode.iconFilePath+"');",treeNode.cssClass="icon umb-tree-icon sprTree legacy-custom-file";treeNode.metaData&&!0===treeNode.metaData.noAccess&&(treeNode.cssClasses||(treeNode.cssClasses=[]),treeNode.cssClasses.push("no-access"))}},getTreePackageFolder:function getTreePackageFolder(treeAlias){if(Umbraco.Sys.ServerVariables.umbracoPlugins&&Umbraco.Sys.ServerVariables.umbracoPlugins.trees&&Utilities.isArray(Umbraco.Sys.ServerVariables.umbracoPlugins.trees)){var found=_.find(Umbraco.Sys.ServerVariables.umbracoPlugins.trees,function(item){return function invariantEquals(a,b){return"string"==typeof a&&"string"==typeof b?0===a.localeCompare(b,void 0,{sensitivity:"base"}):a===b}(item.alias,treeAlias)});return found?found.packageFolder:void 0}},clearCache:function clearCache(args){if(args){if(args.section&&args.cacheKey){var cacheKey=getCacheKey(args);cacheKey&&treeCache&&null!=treeCache[cacheKey]&&(treeCache=_.omit(treeCache,cacheKey))}else if(args.childrenOf){if(!args.cacheKey)throw"args.cacheKey is required if args.childrenOf is supplied";var self=this;this.clearCache({cacheKey:args.cacheKey,filter:function filter(cc){var parent=self.getDescendantNode(cc.root,args.childrenOf);return parent&&(parent.children=null,parent.expanded=!1),cc}})}else if(args.filter&&Utilities.isFunction(args.filter)){if(!args.cacheKey)throw"args.cacheKey is required if args.filter is supplied";var byKey=treeCache[args.cacheKey];if(byKey){var result=args.filter(byKey);result?treeCache[args.cacheKey]=result:treeCache=_.omit(treeCache,args.cacheKey)}}else if(args.cacheKey){var allKeys1=_.keys(treeCache),toRemove1=_.filter(allKeys1,function(k){return k.startsWith(args.cacheKey+"_")});treeCache=_.omit(treeCache,toRemove1)}else if(args.section){var allKeys2=_.keys(treeCache),toRemove2=_.filter(allKeys2,function(k){return k.endsWith("_"+args.section)});treeCache=_.omit(treeCache,toRemove2)}}else treeCache={}},loadNodeChildren:function loadNodeChildren(args){if(!args)throw"No args object defined for loadNodeChildren";if(!args.node)throw"No node defined on args object for loadNodeChildren";return args.isDialog&&args.node.metaData.isContainer||this.removeChildNodes(args.node),args.node.loading=!0,this.getChildren(args).then(function(data){return args.node.loading=!1,args.node.children=data,args.node.children&&args.node.children.length>0&&(args.node.expanded=!0,args.node.hasChildren=!0,Utilities.isFunction(args.node.updateNodeData)&&args.node.updateNodeData(args.node)),$q.when(data)},function(reason){return eventsService.emit("treeService.treeNodeLoadError",{error:reason}),args.node.loading=!1,notificationsService.error(reason),$q.reject(reason)})},removeNode:function removeNode(treeNode){if(Utilities.isFunction(treeNode.parent)){if(null==treeNode.parent())throw"Cannot remove a node that doesn't have a parent";var parent=treeNode.parent();parent.children.splice(parent.children.indexOf(treeNode),1),parent.hasChildren=0!==parent.children.length,eventsService.emit("treeService.removeNode",{node:treeNode})}},removeChildNodes:function removeChildNodes(treeNode){treeNode.expanded=!1,treeNode.children=[],treeNode.hasChildren=!1},getChildNode:function getChildNode(treeNode,id){if(!treeNode.children)return null;var found=_.find(treeNode.children,function(child){return String(child.id).toLowerCase()===String(id).toLowerCase()});return void 0===found?null:found},getDescendantNode:function getDescendantNode(treeNode,id,treeAlias){if(!0===treeNode.isContainer&&!treeAlias)throw"Cannot get a descendant node from a section container node without a treeAlias specified";var self=this;var foundRoot=function getTreeRoot(tn){if(tn.isContainer){for(var c=0;c<tn.children.length;c++)if(tn.children[c].isContainer){var root=getTreeRoot(tn.children[c]);if(root)return root}else if(self.getTreeAlias(tn.children[c])===treeAlias)return tn.children[c];return null}return tn}(treeNode);if(!foundRoot)throw"Could not find a tree in the current section with alias "+treeAlias;if((treeNode=foundRoot).id===id)return treeNode;var found=this.getChildNode(treeNode,id);if(found)return found;if(!treeNode.children)return null;for(var i=0;i<treeNode.children.length;i++){var child=treeNode.children[i];if(child.children&&Utilities.isArray(child.children)&&child.children.length>0&&(found=this.getDescendantNode(child,id)))return found}return void 0===found?null:found},getTreeRoot:function getTreeRoot(treeNode){if(!treeNode)throw"treeNode cannot be null";for(var root=null,current=treeNode;null===root&&current;)current.metaData&&current.metaData.treeAlias?root=current:current=Utilities.isFunction(current.parent)?current.parent():null;return root},getTreeAlias:function getTreeAlias(treeNode){var root=this.getTreeRoot(treeNode);return root?root.metaData.treeAlias:""},getTree:function getTree(args){args?args.section||(args.section="content"):args={section:"content",cacheKey:null};var cacheKey=getCacheKey(args);if(cacheKey&&void 0!==treeCache[cacheKey])return $q.when(treeCache[cacheKey]);var self=this;return treeResource.loadApplication(args).then(function(data){var result={name:data.name,alias:args.section,root:data};if(self._formatNodeDataForUseInUI(result.root,result.root.children,args.section),result.root.containsGroups)for(var i=0;i<result.root.children.length;i++){var group=result.root.children[i];self._formatNodeDataForUseInUI(group,group.children,args.section)}return cacheKey?(treeCache[cacheKey]=result,$q.when(treeCache[cacheKey])):$q.when(result)})},getMenu:function getMenu(args){if(!args)throw"args cannot be null";if(!args.treeNode)throw"args.treeNode cannot be null";return treeResource.loadMenu(args.treeNode).then(function(data){for(var i=0;i<data.length;i++)data[i].cssclass=iconHelper.convertFromLegacyIcon(data[i].cssclass);return data})},getChildren:function getChildren(args){if(!args)throw"No args object defined for getChildren";if(!args.node)throw"No node defined on args object for getChildren";var section=args.section||"content",treeItem=args.node,self=this;return treeResource.loadNodes({node:treeItem}).then(function(data){return self._formatNodeDataForUseInUI(treeItem,data,section,treeItem.level+1),$q.when(data)})},reloadNode:function reloadNode(node){if(!node)throw"node cannot be null";if(!node.parent())throw"cannot reload a single node without a parent";if(!node.section)throw"cannot reload a single node without an assigned node.section";return node.loading=!0,this.getChildren({node:node.parent(),section:node.section}).then(function(data){var found=_.find(data,function(item){return item.id===node.id});if(found){var index=_.indexOf(node.parent().children,node);return Utilities.isFunction(node.parent().children[index].updateNodeData)?node.parent().children[index].updateNodeData(found):_.extend(node.parent().children[index],found),node.parent().children[index].loading=!1,$q.when(node.parent().children[index])}return $q.reject()},function(){return $q.reject()})},getPath:function getPath(node){if(!node)throw"node cannot be null";if(!Utilities.isFunction(node.parent))throw"node.parent is not a function, the path cannot be resolved";for(var reversePath=[],current=node;null!=current;)reversePath.push(current.id),current=current.metaData&&current.metaData.treeAlias||!current.parent?null:current.parent();return reversePath.reverse()},syncTree:function syncTree(args){if(!args)throw"No args object defined for syncTree";if(!args.node)throw"No node defined on args object for syncTree";if(!args.path)throw"No path defined on args object for syncTree";if(!Utilities.isArray(args.path))throw"Path must be an array";args.path.length<1&&args.path.push("-1");var root=this.getTreeRoot(args.node);if(!root)throw"Could not get the root tree node based on the node passed in";var currPathIndex=0;if(String(args.path[currPathIndex]).toLowerCase()===String(args.node.id).toLowerCase()){if(1===args.path.length)return $q.when(root);currPathIndex=1}var deferred=$q.defer(),self=this,node=args.node;return function doSync(){var child=self.getChildNode(node,args.path[currPathIndex]);return child?args.path.length===currPathIndex+1?args.forceReload?self.reloadNode(child):$q.when(child):(currPathIndex++,node=child,doSync()):self.loadNodeChildren({node:node,section:node.section}).then(function(children){deferred.notify({type:"treeNodeExpanded",node:node,children:children});var found=self.getChildNode(node,args.path[currPathIndex]);return found?args.path.length===currPathIndex+1?$q.when(found):(currPathIndex++,node=found,doSync()):$q.reject()},function(){return $q.reject()})}().then(function(args){deferred.resolve(args)},function(args){deferred.reject(args)}),deferred.promise}}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function umbRequestHelper($http,$q,notificationsService,eventsService,formHelper,overlayService){return{convertVirtualToAbsolutePath:function convertVirtualToAbsolutePath(virtualPath){if(virtualPath.startsWith("/"))return virtualPath;if(!virtualPath.startsWith("~/"))throw"The path "+virtualPath+" is not a virtual path";if(!Umbraco.Sys.ServerVariables.application.applicationPath)throw"No applicationPath defined in Umbraco.ServerVariables.application.applicationPath";return Umbraco.Sys.ServerVariables.application.applicationPath+virtualPath.trimStart("~/")},dictionaryToQueryString:function dictionaryToQueryString(queryStrings){if(Utilities.isArray(queryStrings))return _.map(queryStrings,function(item){var key=null,val=null;for(var k in item){key=k,val=item[k];break}if(null===key||null===val)throw"The object in the array was not formatted as a key/value pair";return encodeURIComponent(key)+"="+encodeURIComponent(val)}).join("&");if(Utilities.isObject(queryStrings))return decodeURIComponent($.param(queryStrings));throw"The queryString parameter is not an array or object of key value pairs"},getApiUrl:function getApiUrl(apiName,actionName,queryStrings){if(!(Umbraco&&Umbraco.Sys&&Umbraco.Sys.ServerVariables&&Umbraco.Sys.ServerVariables.umbracoUrls))throw"No server variables defined!";if(!Umbraco.Sys.ServerVariables.umbracoUrls[apiName])throw"No url found for api name "+apiName;return Umbraco.Sys.ServerVariables.umbracoUrls[apiName]+actionName+(queryStrings?"?"+(Utilities.isString(queryStrings)?queryStrings:this.dictionaryToQueryString(queryStrings)):"")},resourcePromise:function resourcePromise(httpPromise,opts){var callbacks={success:opts&&opts.success?opts.success:function defaultSuccess(data,status,headers,config){return data},error:opts&&opts.error?opts.error:function defaultError(data,status,headers,config){var err={errorMsg:Utilities.isString(opts)?opts:"An error occurred!",data:data,status:status};return"object"==_typeof(opts)&&"function"==typeof opts.then&&(err.errorMsg=opts),err}};return httpPromise.then(function(response){var result=callbacks.success.apply(this,[response.data,response.status,response.headers,response.config]);return formHelper.showNotifications(response.data),$q.resolve(result)},function(response){if(response){if(!response.status)return $q.reject(response);var result=callbacks.error.apply(this,[response.data,response.status,response.headers,response.config]);if(response.status>=500&&response.status<600)if(!0===Umbraco.Sys.ServerVariables.isDebuggingEnabled){var error={errorMsg:"An error occurred",data:response.data};overlayService.ysod(error)}else notificationsService.error("Server error","Contact administrator, see log for full details.<br/><i>"+result.errorMsg+"</i>");else formHelper.showNotifications(result.data);return $q.reject({errorMsg:result.errorMsg,data:result.data,status:result.status})}})},postSaveContent:function postSaveContent(args){if(!args.restApiUrl)throw"args.restApiUrl is a required argument";if(!args.content)throw"args.content is a required argument";if(!args.action)throw"args.action is a required argument";if(!args.files)throw"args.files is a required argument";if(!args.dataFormatter)throw"args.dataFormatter is a required argument";null!==args.showNotifications&&void 0!==args.showNotifications||(args.showNotifications=!0);var activeTab=_.find(args.content.tabs,function(item){return item.active}),activeTabIndex=void 0===activeTab?0:_.indexOf(args.content.tabs,activeTab);return this.postMultiPartRequest(args.restApiUrl,{key:"contentItem",value:args.dataFormatter(args.content,args.action)},function(data,formData){for(var f in args.files){var file=args.files[f],fileKey="file_"+(file.alias||"").replace(/_/g,"\\_")+"_"+(file.culture?file.culture.replace(/_/g,"\\_"):"")+"_"+(file.segment?file.segment.replace(/_/g,"\\_"):"");Utilities.isArray(file.metaData)&&file.metaData.length>0&&(fileKey+="_"+_.map(file.metaData,function(x){return(""+x).replace(/_/g,"\\_")}).join("_")),formData.append(fileKey,file.file)}}).then(function(response){return response.data.tabs&&response.data.tabs.length>0&&(response.data.tabs.forEach(function(item){return item.active=!1}),response.data.tabs[activeTabIndex].active=!0),args.showNotifications&&formHelper.showNotifications(response.data),$q.resolve(response.data)},function(response){if(!response.status)return $q.reject(response);if(response.status>=500&&response.status<600)if(void 0!==response.data&&"function"==typeof response.data.indexOf&&response.data.indexOf("Maximum request length exceeded")>=0)notificationsService.error("Server error","The uploaded file was too large, check with your site administrator to adjust the maximum size allowed");else if(!0===Umbraco.Sys.ServerVariables.isDebuggingEnabled){var error={errorMsg:"An error occurred",data:response.data};overlayService.ysod(error)}else notificationsService.error("Server error","Contact administrator, see log for full details.<br/><i>"+response.data.ExceptionMessage+"</i>");else args.showNotifications&&formHelper.showNotifications(response.data);return $q.reject({errorMsg:"An error occurred",data:response.data,status:response.status})})},postMultiPartRequest:function postMultiPartRequest(url,jsonData,transformCallback){if(!jsonData)throw"jsonData cannot be null";if(Utilities.isArray(jsonData))jsonData.forEach(function(item){if(!item.key||!item.value)throw"jsonData array item must have both a key and a value property"});else if(!jsonData.key||!jsonData.value)throw"jsonData object must have both a key and a value property";return $http({method:"POST",url:url,headers:{"Content-Type":void 0},transformRequest:function transformRequest(data){var formData=new FormData;return Utilities.isArray(data)?data.forEach(function(item){formData.append(item.key,Utilities.isString(item.value)?item.value:Utilities.toJson(item.value))}):formData.append(data.key,Utilities.isString(data.value)?data.value:Utilities.toJson(data.value)),transformCallback&&transformCallback.apply(this,[data,formData]),formData},data:jsonData}).then(function(response){return $q.resolve(response)},function(response){return $q.reject(response)})},downloadFile:function downloadFile(httpPath){return $http.get(httpPath,{responseType:"arraybuffer"}).then(function(response){var success=!1,headers=response.headers(),filename=headers["x-filename"]||"download.bin";filename=decodeURIComponent(filename);var contentType=headers["content-type"]||"application/octet-stream";try{var blob=new Blob([response.data],{type:contentType});if(navigator.msSaveBlob)navigator.msSaveBlob(blob,filename);else{var saveBlob=navigator.webkitSaveBlob||navigator.mozSaveBlob||navigator.saveBlob;if(void 0===saveBlob)throw"Not supported";saveBlob(blob,filename)}success=!0}catch(ex){console.log("saveBlob method failed with the following exception:"),console.log(ex)}if(!success){var urlCreator=window.URL||window.webkitURL||window.mozURL||window.msURL;if(urlCreator){var link=document.createElement("a");if("download"in link)try{blob=new Blob([response.data],{type:contentType});var url=urlCreator.createObjectURL(blob);link.setAttribute("href",url),link.setAttribute("download",filename);var event=document.createEvent("MouseEvents");event.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),link.dispatchEvent(event),success=!0}catch(ex){console.log("Download link method with simulated click failed with the following exception:"),console.log(ex)}if(!success)try{blob=new Blob([response.data],{type:"application/octet-stream"}),url=urlCreator.createObjectURL(blob);window.location=url,success=!0}catch(ex){console.log("Download link method with window.location failed with the following exception:"),console.log(ex)}}}return success||window.open(httpPath,"_blank",""),$q.resolve(response)},function(response){return $q.reject({errorMsg:"An error occurred downloading the file",data:response.data,status:response.status})})}}}function versionHelper(){return{versionCompare:function versionCompare(v1,v2,options){var lexicographical=options&&options.lexicographical,zeroExtend=options&&options.zeroExtend,v1parts=v1.split("."),v2parts=v2.split(".");function isValidPart(x){return(lexicographical?/^\d+[A-Za-z]*$/:/^\d+$/).test(x)}if(!v1parts.every(isValidPart)||!v2parts.every(isValidPart))return NaN;if(zeroExtend){for(;v1parts.length<v2parts.length;)v1parts.push("0");for(;v2parts.length<v1parts.length;)v2parts.push("0")}lexicographical||(v1parts=v1parts.map(Number),v2parts=v2parts.map(Number));for(var i=0;i<v1parts.length;++i){if(v2parts.length===i)return 1;if(v1parts[i]!==v2parts[i])return v1parts[i]>v2parts[i]?1:-1}return v1parts.length!==v2parts.length?-1:0}}}function dateHelper(){return{convertToServerStringTime:function convertToServerStringTime(momentLocal,serverOffsetMinutes,format){var formattedOffset=(serverOffsetMinutes>0?"+":"-")+moment().startOf("day").minutes(Math.abs(serverOffsetMinutes)).format("HH:mm");return moment.utc(momentLocal).utcOffset(formattedOffset).format(format||"YYYY-MM-DD HH:mm:ss")},convertToLocalMomentTime:function convertToLocalMomentTime(strVal,serverOffsetMinutes){var isoFormat,formattedOffset=(serverOffsetMinutes>0?"+":"-")+moment().startOf("day").minutes(Math.abs(serverOffsetMinutes)).format("HH:mm");return isoFormat=strVal.indexOf("T")>-1&&strVal.endsWith("Z")?moment.utc(strVal).format("YYYY-MM-DDTHH:mm:ss")+formattedOffset:moment(strVal).format("YYYY-MM-DDTHH:mm:ss")+formattedOffset,moment.parseZone(isoFormat).local()},getLocalDate:function getLocalDate(date,culture,format){if(date){var serverOffset=Umbraco.Sys.ServerVariables.application.serverTimeOffset;return(-serverOffset!==(new Date).getTimezoneOffset()?this.convertToLocalMomentTime(date,serverOffset):moment(date,"YYYY-MM-DD HH:mm:ss")).locale(culture).format(format)}}}}function packageHelper(assetsService,treeService,eventsService,$templateCache){return{packageInstalled:function packageInstalled(){treeService.clearCache(),$templateCache.removeAll(),eventsService.emit("app.reInitialize")}}}function umbModelMapper(){return{convertToEntityBasic:function convertToEntityBasic(source){var required=["id","name","icon","parentId","path"];required.forEach(function(k){if(!hasOwnProperty.call(source,k))throw"The source object does not contain the property ".concat(k)});return _.pick(source,required.concat(["metaData","key","alias"]))}}}function umbSessionStorage($window){var storage=$window.sessionStorage?$window.sessionStorage:{};return{get:function get(key){return Utilities.fromJson(storage["umb_"+key])},set:function set(key,value){storage["umb_"+key]=Utilities.toJson(value)}}}function updateChecker($http,umbRequestHelper){return{check:function check(){return umbRequestHelper.resourcePromise($http.get(umbRequestHelper.getApiUrl("updateCheckApiBaseUrl","GetCheck")),"Failed to retrieve update status")}}}function umbPropEditorHelper(){return{getViewPath:function getViewPath(input,isPreValue){var path=String(input);return path.startsWith("/")?path:path.indexOf("/")>=0?path:isPreValue?"views/prevalueeditors/"+path+".html":"views/propertyeditors/"+path+"/"+path+".html"}}}function windowResizeListener($rootScope){var registered,inited,resize,notify,WinResizer=(registered=[],inited=!1,resize=_.debounce(function(ev){notify()},100),notify=function notify(){var h=$(window).height(),w=$(window).width();$rootScope.$apply(function(){for(var i=0,cnt=registered.length;i<cnt;i++)registered[i].apply($(window),[{width:w,height:h}])})},{register:function register(fn){registered.push(fn),!1===inited&&($(window).on("resize",resize),inited=!0)},unregister:function unregister(fn){var index=registered.indexOf(fn);index>-1&&registered.splice(index,1)}});return{register:function register(cb){WinResizer.register(cb)},unregister:function unregister(cb){WinResizer.unregister(cb)}}}function xmlhelper($http){var x2js=new function X2JS(){var escapeMode=!1,DOMNodeTypes={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,DOCUMENT_NODE:9};function getNodeLocalName(node){var nodeLocalName=node.localName;return null==nodeLocalName&&(nodeLocalName=node.baseName),null!==nodeLocalName&&""!==nodeLocalName||(nodeLocalName=node.nodeName),nodeLocalName}function escapeXmlChars(str){return"string"==typeof str?str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):str}function startTag(jsonObj,element,attrList,closed){var resultStr="<"+(null!=jsonObj&&null!=jsonObj.__prefix?jsonObj.__prefix+":":"")+element;if(null!=attrList)for(var aidx=0;aidx<attrList.length;aidx++){var attrName=attrList[aidx],attrVal=jsonObj[attrName];resultStr+=" "+attrName.substr(1)+"='"+attrVal+"'"}return resultStr+=closed?"/>":">"}function endTag(jsonObj,elementName){return"</"+(null!==jsonObj.__prefix?jsonObj.__prefix+":":"")+elementName+">"}function jsonXmlSpecialElem(jsonObj,jsonObjField){return!!(function endsWith(str,suffix){return-1!==str.indexOf(suffix,str.length-suffix.length)}(jsonObjField.toString(),"_asArray")||0===jsonObjField.toString().indexOf("_")||jsonObj[jsonObjField]instanceof Function)}function jsonXmlElemCount(jsonObj){var elementsCnt=0;if(jsonObj instanceof Object)for(var it in jsonObj)jsonXmlSpecialElem(jsonObj,it)||elementsCnt++;return elementsCnt}function parseJSONAttributes(jsonObj){var attrList=[];if(jsonObj instanceof Object)for(var ait in jsonObj)-1===ait.toString().indexOf("__")&&0===ait.toString().indexOf("_")&&attrList.push(ait);return attrList}function parseJSONTextObject(jsonTxtObj){var result="";return jsonTxtObj instanceof Object?result+=function parseJSONTextAttrs(jsonTxtObj){var result="";return null!=jsonTxtObj.__cdata&&(result+="<![CDATA["+jsonTxtObj.__cdata+"]]>"),null!=jsonTxtObj.__text&&(result+=escapeMode?escapeXmlChars(jsonTxtObj.__text):jsonTxtObj.__text),result}(jsonTxtObj):null!=jsonTxtObj&&(result+=escapeMode?escapeXmlChars(jsonTxtObj):jsonTxtObj),result}function parseJSONArray(jsonArrRoot,jsonArrObj,attrList){var result="";if(0===jsonArrRoot.length)result+=startTag(jsonArrRoot,jsonArrObj,attrList,!0);else for(var arIdx=0;arIdx<jsonArrRoot.length;arIdx++)result+=startTag(jsonArrRoot[arIdx],jsonArrObj,parseJSONAttributes(jsonArrRoot[arIdx]),!1),result+=parseJSONObject(jsonArrRoot[arIdx]),result+=endTag(jsonArrRoot[arIdx],jsonArrObj);return result}function parseJSONObject(jsonObj){var result="";if(jsonXmlElemCount(jsonObj)>0)for(var it in jsonObj)if(!jsonXmlSpecialElem(jsonObj,it)){var subObj=jsonObj[it],attrList=parseJSONAttributes(subObj);null==subObj?result+=startTag(subObj,it,attrList,!0):subObj instanceof Object?subObj instanceof Array?result+=parseJSONArray(subObj,it,attrList):jsonXmlElemCount(subObj)>0||null!==subObj.__text||null!==subObj.__cdata?(result+=startTag(subObj,it,attrList,!1),result+=parseJSONObject(subObj),result+=endTag(subObj,it)):result+=startTag(subObj,it,attrList,!0):(result+=startTag(subObj,it,attrList,!1),result+=parseJSONTextObject(subObj),result+=endTag(subObj,it))}return result+=parseJSONTextObject(jsonObj)}this.parseXmlString=function(xmlDocStr){var xmlDoc;return window.DOMParser?xmlDoc=(new window.DOMParser).parseFromString(xmlDocStr,"text/xml"):(0===xmlDocStr.indexOf("<?")&&(xmlDocStr=xmlDocStr.substr(xmlDocStr.indexOf("?>")+2)),(xmlDoc=new ActiveXObject("Microsoft.XMLDOM")).async="false",xmlDoc.loadXML(xmlDocStr)),xmlDoc},this.xml2json=function(xmlDoc){return function parseDOMChildren(node){var result,child,childName;if(node.nodeType===DOMNodeTypes.DOCUMENT_NODE)return(result={})[childName=getNodeLocalName(child=node.firstChild)]=parseDOMChildren(child),result;if(node.nodeType===DOMNodeTypes.ELEMENT_NODE){(result={}).__cnt=0;for(var nodeChildren=node.childNodes,cidx=0;cidx<nodeChildren.length;cidx++)if(childName=getNodeLocalName(child=nodeChildren.item(cidx)),result.__cnt++,null===result[childName])result[childName]=parseDOMChildren(child),result[childName+"_asArray"]=new Array(1),result[childName+"_asArray"][0]=result[childName];else{if(null!==result[childName]&&!(result[childName]instanceof Array)){var tmpObj=result[childName];result[childName]=[],result[childName][0]=tmpObj,result[childName+"_asArray"]=result[childName]}for(var aridx=0;null!==result[childName][aridx];)aridx++;result[childName][aridx]=parseDOMChildren(child)}for(var aidx=0;aidx<node.attributes.length;aidx++){var attr=node.attributes.item(aidx);result.__cnt++,result["_"+attr.name]=attr.value}var nodePrefix=function getNodePrefix(node){return node.prefix}(node);return null!==nodePrefix&&""!==nodePrefix&&(result.__cnt++,result.__prefix=nodePrefix),1===result.__cnt&&null!==result["#text"]&&(result=result["#text"]),null!==result["#text"]&&(result.__text=result["#text"],escapeMode&&(result.__text=function unescapeXmlChars(str){return str.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}(result.__text)),delete result["#text"],delete result["#text_asArray"]),null!=result["#cdata-section"]&&(result.__cdata=result["#cdata-section"],delete result["#cdata-section"],delete result["#cdata-section_asArray"]),null==result.__text&&null==result.__cdata||(result.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),result}return node.nodeType===DOMNodeTypes.TEXT_NODE||node.nodeType===DOMNodeTypes.CDATA_SECTION_NODE?node.nodeValue:void 0}(xmlDoc)},this.xml_str2json=function(xmlDocStr){var xmlDoc=this.parseXmlString(xmlDocStr);return this.xml2json(xmlDoc)},this.json2xml_str=function(jsonObj){return parseJSONObject(jsonObj)},this.json2xml=function(jsonObj){var xmlDocStr=this.json2xml_str(jsonObj);return this.parseXmlString(xmlDocStr)},this.getVersion=function(){return"1.0.11"},this.escapeMode=function(enabled){escapeMode=enabled}};return{toJson:function toJson(xml){return x2js.xml_str2json(xml)},fromJson:function fromJson(json){return x2js.json2xml_str(json)}}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}angular.module("umbraco.services",["umbraco.interceptors","umbraco.resources"]),angular.module("umbraco.services").factory("angularHelper",angularHelper),angular.module("umbraco.services").factory("appState",appState),angular.module("umbraco.services").factory("assetsService",function($q,$log,angularHelper,umbRequestHelper,$rootScope,$http,userService,javascriptLibraryResource){var initAssetsLoaded=!1;function appendRnd(url){if(!Umbraco.Sys.ServerVariables.application)return url;var rnd=Umbraco.Sys.ServerVariables.application.cacheBuster,_op=url.indexOf("?")>0?"&":"?";return url=url+_op+"umb__rnd="+rnd}function convertVirtualPath(path){return path.startsWith("~/")&&(path=umbRequestHelper.convertVirtualToAbsolutePath(path)),path}function getLocales(locales,supportedLocales,path){for(var localeUrls=[],i=(locales=locales.split(","),0);i<locales.length;i++){var locale=locales[i].toString().toLowerCase();if("en-us"!==locale&&(supportedLocales.indexOf(locale+".js")>-1&&localeUrls.push(path+locale+".js"),locale.indexOf("-")>-1)){var majorLocale=locale.split("-")[0]+".js";supportedLocales.indexOf(majorLocale)>-1&&localeUrls.push(path+majorLocale)}}return localeUrls}function loadLocales(locales,supportedLocales){var localeUrls=function getMomentLocales(locales,supportedLocales){return getLocales(locales,supportedLocales,"lib/moment/")}(locales,supportedLocales.moment);if((localeUrls=localeUrls.concat(function getFlatpickrLocales(locales,supportedLocales){return getLocales(locales,supportedLocales,"lib/flatpickr/l10n/")}(locales,supportedLocales.flatpickr))).length>=1)return service.load(localeUrls,$rootScope);$q.when(!0)}var service={loadedAssets:{},_getAssetPromise:function _getAssetPromise(path){if(this.loadedAssets[path])return this.loadedAssets[path];var deferred=$q.defer();return this.loadedAssets[path]={deferred:deferred,state:"new",path:path},this.loadedAssets[path]},_loadInitAssets:function _loadInitAssets(){if(!1===initAssetsLoaded){return this.loadJs(umbRequestHelper.getApiUrl("serverVarsJs","",""),$rootScope).then(function(){return initAssetsLoaded=!0,function loadLocaleForCurrentUser(){userService.getCurrentUser().then(function(currentUser){return javascriptLibraryResource.getSupportedLocales().then(function(supportedLocales){return loadLocales(currentUser.locale,supportedLocales)})})}()})}return $q.when(!0)},loadLocales:loadLocales,loadCss:function loadCss(path,scope,attributes,timeout){path=convertVirtualPath(path);var asset=this._getAssetPromise(path);return"new"===asset.state?(asset.state="loading",LazyLoad.css(appendRnd(path),function(){scope||(scope=$rootScope),asset.state="loaded",angularHelper.safeApply(scope,function(){asset.deferred.resolve(!0)})})):"loaded"===asset.state&&asset.deferred.resolve(!0),asset.deferred.promise},loadJs:function loadJs(path,scope,attributes,timeout){path=convertVirtualPath(path);var asset=this._getAssetPromise(path);return"new"===asset.state?(asset.state="loading",LazyLoad.js(appendRnd(path),function(){scope||(scope=$rootScope),asset.state="loaded",angularHelper.safeApply(scope,function(){asset.deferred.resolve(!0)})})):"loaded"===asset.state&&asset.deferred.resolve(!0),asset.deferred.promise},load:function load(pathArray,scope,defaultAssetType){var promise;if(!Utilities.isArray(pathArray))throw"pathArray must be an array";var nonEmpty=_.reject(pathArray,function(item){return void 0===item||""===item});if(0===nonEmpty.length){var deferred=$q.defer();return promise=deferred.promise,deferred.resolve(!0),promise}var promises=[],assets=[];nonEmpty.forEach(function(path){path=convertVirtualPath(path);var asset=service._getAssetPromise(path);"loaded"!==asset.state&&("new"===asset.state&&(asset.state="loading",assets.push(asset)),promises.push(asset.deferred.promise))}),promise=$q.all(promises);for(var cssAssets=[],jsAssets=[],i=0;i<assets.length;i++){var asset=assets[i];if(asset.path.match(/(\.css$|\.css\?)/gi))cssAssets.push(asset);else if(asset.path.match(/(\.js$|\.js\?)/gi))jsAssets.push(asset);else switch(defaultAssetType){case"css":cssAssets.push(asset);break;case"js":jsAssets.push(asset);break;default:throw"Found unknown asset without a valid defaultAssetType specified"}}function assetLoaded(asset){asset.state="loaded",scope||(scope=$rootScope),angularHelper.safeApply(scope,function(){return asset.deferred.resolve(!0)})}if(cssAssets.length>0){var cssPaths=cssAssets.map(function(css){return appendRnd(css.path)});LazyLoad.css(cssPaths,function(){return cssAssets.forEach(assetLoaded)})}if(jsAssets.length>0){var jsPaths=jsAssets.map(function(js){return appendRnd(js.path)});LazyLoad.js(jsPaths,function(){return jsAssets.forEach(assetLoaded)})}return promise}};return service}),function(){angular.module("umbraco.services").factory("backdropService",function backdropService(eventsService){var args={opacity:null,element:null,elementPreventClick:!1,disableEventsOnClick:!1,show:!1};return{open:function open(options){options&&options.element&&(args.element=options.element),options&&options.disableEventsOnClick&&(args.disableEventsOnClick=options.disableEventsOnClick),args.show=!0,eventsService.emit("appState.backdrop",args)},close:function close(){args.opacity=null,args.element=null,args.elementPreventClick=!1,args.disableEventsOnClick=!1,args.show=!1,eventsService.emit("appState.backdrop",args)},setOpacity:function setOpacity(opacity){args.opacity=opacity,eventsService.emit("appState.backdrop",args)},setHighlight:function setHighlight(element,preventClick){args.element=element,args.elementPreventClick=preventClick,eventsService.emit("appState.backdrop",args)}}})}(),function(){angular.module("umbraco").run(["clipboardService","udiService",function(clipboardService,udiService){function replaceUdi(obj,key,dataObject){var udi=obj[key],newUdi=udiService.create("element");obj[key]=newUdi,dataObject.forEach(function(data){data.udi===udi&&(data.udi=newUdi)})}function rawBlockResolver(value,propPasteResolverMethod){null!=value&&"object"===_typeof(value)&&void 0!==value.layout&&void 0!==value.contentData&&void 0!==value.settingsData&&(!function replaceUdisOfObject(obj,propValue){for(var k in obj)if("contentUdi"===k)replaceUdi(obj,k,propValue.contentData);else if("settingsUdi"===k)replaceUdi(obj,k,propValue.settingsData);else{var propType=_typeof(obj[k]);null==propType||"object"!==propType&&"array"!==propType||replaceUdisOfObject(obj[k],propValue)}}(value.layout,value),value.contentData.length>0&&value.contentData.forEach(function(item){for(var k in item)propPasteResolverMethod(item[k],clipboardService.TYPES.RAW)}),value.settingsData.length>0&&value.settingsData.forEach(function(item){for(var k in item)propPasteResolverMethod(item[k],clipboardService.TYPES.RAW)}))}clipboardService.registerPastePropertyResolver(function elementTypeBlockResolver(obj,propPasteResolverMethod){rawBlockResolver(obj.value,propPasteResolverMethod)},clipboardService.TYPES.ELEMENT_TYPE),clipboardService.registerPastePropertyResolver(rawBlockResolver,clipboardService.TYPES.RAW),clipboardService.registerPastePropertyResolver(function provideNewUdisForBlockResolver(block,propPasteResolverMethod){block.layout&&function removeBlockReferences(obj){for(var k in obj)if("contentUdi"===k)delete obj[k];else if("settingsUdi"===k)delete obj[k];else{var propType=_typeof(obj[k]);null==propType||"object"!==propType&&"array"!==propType||removeBlockReferences(obj[k])}}(block.layout),block.data&&(block.data.udi=block.layout.contentUdi=udiService.create("element")),block.settingsData&&(block.settingsData.udi=block.layout.settingsUdi=udiService.create("element"))},clipboardService.TYPES.BLOCK)}]),angular.module("umbraco.services").service("blockEditorService",function blockEditorService(blockEditorModelObject){return{createModelObject:function createModelObject(propertyModelValue,propertyEditorAlias,blockConfigurations,scopeOfExistance,propertyEditorScope){return new blockEditorModelObject(propertyModelValue,propertyEditorAlias,blockConfigurations,scopeOfExistance,propertyEditorScope)}}})}(),function(){angular.module("umbraco.services").service("blockEditorModelObject",function blockEditorModelObjectFactory($interpolate,$q,udiService,contentResource,localizationService,umbRequestHelper,clipboardService,notificationsService){function mapToElementModel(elementModel,dataModel){if(elementModel&&elementModel.variants&&elementModel.variants.length)for(var variant=elementModel.variants[0],t=0;t<variant.tabs.length;t++)for(var tab=variant.tabs[t],p=0;p<tab.properties.length;p++){var prop=tab.properties[p];dataModel[prop.alias]&&(prop.value=dataModel[prop.alias])}}function mapToPropertyModel(elementModel,dataModel){if(elementModel&&elementModel.variants&&elementModel.variants.length)for(var variant=elementModel.variants[0],t=0;t<variant.tabs.length;t++)for(var tab=variant.tabs[t],p=0;p<tab.properties.length;p++){var prop=tab.properties[p];prop.value&&(dataModel[prop.alias]=prop.value)}}function mapElementValues(fromModel,toModel){if(fromModel&&fromModel.variants)if(fromModel.variants.length){var fromVariant=fromModel.variants[0];if(fromVariant)for(var toVariant=toModel.variants[0],t=0;t<fromVariant.tabs.length;t++){var fromTab=fromVariant.tabs[t],toTab=toVariant.tabs.find(function(tab){return tab.alias===fromTab.alias});if(fromTab&&fromTab.properties&&fromTab.properties.length>0&&toTab&&toTab.properties&&toTab.properties.length>0)for(var p=0;p<fromTab.properties.length;p++){var fromProp=fromTab.properties[p];toTab.properties[p].value=fromProp.value}}else toModel.variants=[null]}else toModel.variants=[];else toModel.variants=null}function getBlockLabel(blockObject){if(void 0!==blockObject.labelInterpolator){var labelVars=Object.assign({$settings:blockObject.settingsData||{},$layout:blockObject.layout||{},$index:(blockObject.index||0)+1},blockObject.data);return blockObject.labelInterpolator(labelVars)}return blockObject.content.contentTypeName}function addWatchers(blockObject,isolatedScope,forSettings){var model=forSettings?blockObject.settings:blockObject.content;if(model&&model.variants&&model.variants.length){for(var variant=model.variants[0],field=forSettings?"settings":"content",watcherCreator=forSettings?createSettingsModelPropWatcher:createContentModelPropWatcher,t=0;t<variant.tabs.length;t++)for(var tab=variant.tabs[t],p=0;p<tab.properties.length;p++){var prop=tab.properties[p];blockObject.__watchers.push(isolatedScope.$watch("blockObjects._"+blockObject.key+"."+field+".variants[0].tabs["+t+"].properties["+p+"].value",watcherCreator(blockObject,prop))),!0===forSettings?blockObject.__watchers.push(isolatedScope.$watch("blockObjects._"+blockObject.key+".settingsData."+prop.alias,createLayoutSettingsModelWatcher(blockObject,prop))):blockObject.__watchers.push(isolatedScope.$watch("blockObjects._"+blockObject.key+".data."+prop.alias,createDataModelWatcher(blockObject,prop)))}0===blockObject.__watchers.length&&blockObject.updateLabel()}}function createDataModelWatcher(blockObject,prop){return function(){prop.value!==blockObject.data[prop.alias]&&(prop.value=blockObject.data[prop.alias],blockObject.updateLabel())}}function createLayoutSettingsModelWatcher(blockObject,prop){return function(){prop.value!==blockObject.settingsData[prop.alias]&&(prop.value=blockObject.settingsData[prop.alias])}}function createContentModelPropWatcher(blockObject,prop){return function(){blockObject.data[prop.alias]!==prop.value&&(blockObject.data[prop.alias]=prop.value),blockObject.updateLabel()}}function createSettingsModelPropWatcher(blockObject,prop){return function(){blockObject.settingsData[prop.alias]!==prop.value&&(blockObject.settingsData[prop.alias]=prop.value)}}function createDataEntry(elementTypeKey,dataItems){var data={contentTypeKey:elementTypeKey,udi:udiService.create("element")};return dataItems.push(data),data.udi}function getDataByUdi(udi,dataItems){return dataItems.find(function(entry){return entry.udi===udi})||null}function ensureUdiAndKey(contentData,udi){contentData.udi=udi,contentData.key=udiService.getKey(udi)}var notSupportedProperties=["Umbraco.Tags","Umbraco.UploadField","Umbraco.ImageCropper","Umbraco.NestedContent"];function BlockEditorModelObject(propertyModelValue,propertyEditorAlias,blockConfigurations,scopeOfExistance,propertyEditorScope){if(!propertyModelValue)throw new Error("propertyModelValue cannot be undefined, to ensure we keep the binding to the angular model we need minimum an empty object.");this.__watchers=[],this.__labels={},this.value=propertyModelValue,this.value.layout=this.value.layout||{},this.value.contentData=this.value.contentData||[],this.value.settingsData=this.value.settingsData||[],this.propertyEditorAlias=propertyEditorAlias,this.blockConfigurations=blockConfigurations,this.blockConfigurations.forEach(function(blockConfiguration){null!=blockConfiguration.view&&""!==blockConfiguration.view&&(blockConfiguration.view=umbRequestHelper.convertVirtualToAbsolutePath(blockConfiguration.view)),null!=blockConfiguration.stylesheet&&""!==blockConfiguration.stylesheet&&(blockConfiguration.stylesheet=umbRequestHelper.convertVirtualToAbsolutePath(blockConfiguration.stylesheet)),null!=blockConfiguration.thumbnail&&""!==blockConfiguration.thumbnail&&(blockConfiguration.thumbnail=umbRequestHelper.convertVirtualToAbsolutePath(blockConfiguration.thumbnail))}),this.scaffolds=[],this.isolatedScope=scopeOfExistance.$new(!0),this.isolatedScope.blockObjects={},this.__watchers.push(this.isolatedScope.$on("$destroy",this.destroy.bind(this))),this.__watchers.push(propertyEditorScope.$on("formSubmittingFinalPhase",this.sync.bind(this)))}return BlockEditorModelObject.prototype={update:function update(propertyModelValue,propertyEditorScope){for(var key in this.__watchers.forEach(function(w){w()}),delete this.__watchers,this.isolatedScope.blockObjects)this.destroyBlockObject(this.isolatedScope.blockObjects[key]);this.isolatedScope.blockObjects={},this.value=propertyModelValue,this.value.layout=this.value.layout||{},this.value.contentData=this.value.contentData||[],this.value.settingsData=this.value.settingsData||[],this.__watchers=[],this.__watchers.push(this.isolatedScope.$on("$destroy",this.destroy.bind(this))),this.__watchers.push(propertyEditorScope.$on("formSubmittingFinalPhase",this.sync.bind(this)))},getBlockConfiguration:function getBlockConfiguration(key){return this.blockConfigurations.find(function(bc){return bc.contentElementTypeKey===key})||null},load:function load(){var self=this,tasks=[];tasks.push(localizationService.localize("blockEditor_tabBlockSettings").then(function(settingsName){self.__labels&&(self.__labels.settingsName=settingsName)}));var scaffoldKeys=[];return this.blockConfigurations.forEach(function(blockConfiguration){scaffoldKeys.push(blockConfiguration.contentElementTypeKey),null!=blockConfiguration.settingsElementTypeKey&&scaffoldKeys.push(blockConfiguration.settingsElementTypeKey)}),scaffoldKeys=scaffoldKeys.filter(function(value,index,self){return self.indexOf(value)===index}),tasks.push(contentResource.getScaffoldByKeys(-20,scaffoldKeys).then(function(scaffolds){Object.values(scaffolds).forEach(function(scaffold){self.scaffolds&&self.scaffolds.push(function formatScaffoldData(scaffold){if(scaffold.variants.forEach(function(variant){variant.tabs.forEach(function(tab){tab.properties.forEach(function(property){-1!==notSupportedProperties.indexOf(property.editor)&&(property.view="notsupported")})})}),!scaffold.apps)return console.warn("No content apps found in scaffold"),scaffold;var contentApp=scaffold.apps.find(function(entry){return"umbContent"===entry.alias});contentApp&&(contentApp.view="views/common/infiniteeditors/blockeditor/blockeditor.content.html");var infoAppIndex=scaffold.apps.findIndex(function(entry){return"umbInfo"===entry.alias});return infoAppIndex>=0&&scaffold.apps.splice(infoAppIndex,1),scaffold}(scaffold))})}).catch(function(){})),$q.all(tasks)},getAvailableAliasesForBlockContent:function getAvailableAliasesForBlockContent(){var _this=this;return this.blockConfigurations.map(function(blockConfiguration){var scaffold=_this.getScaffoldFromKey(blockConfiguration.contentElementTypeKey);if(scaffold)return scaffold.contentTypeAlias})},getAvailableBlocksForBlockPicker:function getAvailableBlocksForBlockPicker(){var _this2=this,blocks=[];return this.blockConfigurations.forEach(function(blockConfiguration){var scaffold=_this2.getScaffoldFromKey(blockConfiguration.contentElementTypeKey);scaffold&&blocks.push({blockConfigModel:blockConfiguration,elementTypeModel:scaffold.documentType})}),blocks},getScaffoldFromKey:function getScaffoldFromKey(contentTypeKey){return this.scaffolds.find(function(o){return o.contentTypeKey===contentTypeKey})||null},getScaffoldFromAlias:function getScaffoldFromAlias(contentTypeAlias){return this.scaffolds.find(function(o){return o.contentTypeAlias===contentTypeAlias})||null},getBlockObject:function getBlockObject(layoutEntry){var contentUdi=layoutEntry.contentUdi,dataModel=getDataByUdi(contentUdi,this.value.contentData);if(null===dataModel)return console.error("Couldn't find content data of "+contentUdi),null;var blockConfiguration=this.getBlockConfiguration(dataModel.contentTypeKey),contentScaffold=null;null===blockConfiguration?console.warn("The block of "+contentUdi+" is not being initialized because its contentTypeKey('"+dataModel.contentTypeKey+"') is not allowed for this PropertyEditor"):null===(contentScaffold=this.getScaffoldFromKey(blockConfiguration.contentElementTypeKey))&&console.error("The block of "+contentUdi+" is not begin initialized cause its Element Type was not loaded."),null!==blockConfiguration&&null!==contentScaffold||(blockConfiguration={label:"Unsupported",unsupported:!0});var blockObject={cloneNode:function(){return null}};if(blockObject.key=String.CreateGuid().replace(/-/g,""),blockObject.config=Utilities.copy(blockConfiguration),blockObject.config.label&&""!==blockObject.config.label&&(blockObject.labelInterpolator=$interpolate(blockObject.config.label)),blockObject.__scope=this.isolatedScope,blockObject.updateLabel=_.debounce(function(){this.__scope&&(this.label=getBlockLabel(this),this.__scope.$evalAsync())}.bind(blockObject),10),null!==contentScaffold?(blockObject.content=Utilities.copy(contentScaffold),ensureUdiAndKey(blockObject.content,contentUdi),mapToElementModel(blockObject.content,dataModel)):blockObject.content=null,blockObject.data=dataModel,blockObject.layout=layoutEntry,blockObject.__watchers=[],blockConfiguration.settingsElementTypeKey){var settingsScaffold=this.getScaffoldFromKey(blockConfiguration.settingsElementTypeKey);if(null!==settingsScaffold){layoutEntry.settingsUdi||(layoutEntry.settingsUdi=createDataEntry(blockConfiguration.settingsElementTypeKey,this.value.settingsData));var settingsUdi=layoutEntry.settingsUdi,settingsData=getDataByUdi(settingsUdi,this.value.settingsData);if(null===settingsData)return console.error("Couldnt find settings data of "+settingsUdi),null;settingsData.contentTypeKey!==settingsScaffold.contentTypeKey&&(settingsData.contentTypeKey=settingsScaffold.contentTypeKey),blockObject.settingsData=settingsData,null!==settingsScaffold?(blockObject.settings=Utilities.copy(settingsScaffold),ensureUdiAndKey(blockObject.settings,settingsUdi),mapToElementModel(blockObject.settings,settingsData)):blockObject.settings=null,function appendSettingsContentApp(contentModel,settingsName){if(contentModel.apps){var settingsTab={name:settingsName,alias:"settings",icon:"icon-settings",view:"views/common/infiniteeditors/blockeditor/blockeditor.settings.html",hasError:!1};contentModel.apps.push(settingsTab)}}(blockObject.content,this.__labels.settingsName)}}return blockObject.retrieveValuesFrom=function(content,settings){null!==this.content&&mapElementValues(content,this.content),null!==this.config.settingsElementTypeKey&&mapElementValues(settings,this.settings)},blockObject.sync=function(){null!==this.content&&mapToPropertyModel(this.content,this.data),null!==this.config.settingsElementTypeKey&&mapToPropertyModel(this.settings,this.settingsData)},blockObject.label=getBlockLabel(blockObject),this.isolatedScope.blockObjects["_"+blockObject.key]=blockObject,addWatchers(blockObject,this.isolatedScope),addWatchers(blockObject,this.isolatedScope,!0),blockObject.destroy=function(){this.__watchers.forEach(function(w){w()}),delete this.__watchers,delete this.config,delete this.layout,delete this.data,delete this.settingsData,delete this.content,delete this.settings,delete this.__scope.blockObjects["_"+this.key],delete this.__scope,delete this.destroy,delete this.key},blockObject},removeDataAndDestroyModel:function removeDataAndDestroyModel(blockObject){var udi=blockObject.layout.contentUdi,settingsUdi=blockObject.layout.settingsUdi||null;this.destroyBlockObject(blockObject),this.removeDataByUdi(udi),settingsUdi&&this.removeSettingsByUdi(settingsUdi)},destroyBlockObject:function destroyBlockObject(blockObject){blockObject.destroy()},getLayout:function getLayout(defaultStructure){return this.value.layout[this.propertyEditorAlias]||(this.value.layout[this.propertyEditorAlias]=defaultStructure),this.value.layout[this.propertyEditorAlias]},create:function create(contentElementTypeKey){var blockConfiguration=this.getBlockConfiguration(contentElementTypeKey);if(null===blockConfiguration)return null;var entry={contentUdi:createDataEntry(contentElementTypeKey,this.value.contentData)};return null!=blockConfiguration.settingsElementTypeKey&&(entry.settingsUdi=createDataEntry(blockConfiguration.settingsElementTypeKey,this.value.settingsData)),entry},createFromElementType:function createFromElementType(elementTypeDataModel){var contentElementTypeKey=(elementTypeDataModel=clipboardService.parseContentForPaste(elementTypeDataModel,clipboardService.TYPES.ELEMENT_TYPE)).contentTypeKey,layoutEntry=this.create(contentElementTypeKey);if(null===layoutEntry)return null;var dataModel=getDataByUdi(layoutEntry.contentUdi,this.value.contentData);return null===dataModel?null:(mapToPropertyModel(elementTypeDataModel,dataModel),layoutEntry)},createFromBlockData:function createFromBlockData(blockData){var blockConfiguration,layoutEntry=(blockData=clipboardService.parseContentForPaste(blockData,clipboardService.TYPES.BLOCK)).layout;if(null===layoutEntry)return null;if(!blockData.data)return null;if(null===(blockConfiguration=this.getBlockConfiguration(blockData.data.contentTypeKey)))return null;if(this.value.contentData.push(blockData.data),blockData.settingsData)if(blockConfiguration.settingsElementTypeKey){if(blockConfiguration.settingsElementTypeKey!==blockData.settingsData.contentTypeKey)return notificationsService.error("Clipboard","Couldn't paste because settings-data is not compatible."),null;this.value.settingsData.push(blockData.settingsData)}else delete layoutEntry.settingUdi;return layoutEntry},sync:function sync(){for(var key in this.isolatedScope.blockObjects)this.isolatedScope.blockObjects[key].sync()},removeDataByUdi:function removeDataByUdi(udi){var index=this.value.contentData.findIndex(function(o){return o.udi===udi});-1!==index&&this.value.contentData.splice(index,1)},removeSettingsByUdi:function removeSettingsByUdi(udi){var index=this.value.settingsData.findIndex(function(o){return o.udi===udi});-1!==index&&this.value.settingsData.splice(index,1)},destroy:function destroy(){for(var key in this.__watchers.forEach(function(w){w()}),this.isolatedScope.blockObjects)this.destroyBlockObject(this.isolatedScope.blockObjects[key]);delete this.__watchers,delete this.value,delete this.propertyEditorAlias,delete this.blockConfigurations,delete this.scaffolds,this.isolatedScope.$destroy(),delete this.isolatedScope,delete this.destroy}},BlockEditorModelObject})}(),angular.module("umbraco.services").factory("clipboardService",clipboardService),angular.module("umbraco.services").factory("contentAppHelper",contentAppHelper),angular.module("umbraco.services").factory("contentEditingHelper",contentEditingHelper),angular.module("umbraco.services").factory("contentTypeHelper",contentTypeHelper),angular.module("umbraco.services").factory("cropperHelper",cropperHelper),angular.module("umbraco.services").factory("dataTypeHelper",dataTypeHelper),function(){angular.module("umbraco.services").factory("editorService",function editorService(eventsService,keyboardService,$timeout){var editorsKeyboardShorcuts=[],editors=[],isEnabled=!0,lastElementInFocus=null;function open(editor){unbindKeyboardShortcuts(),0===editors.length&&(lastElementInFocus=document.activeElement),editor.infiniteMode=!0,editors.push(editor);var args={editors:editors,editor:editor};eventsService.emit("appState.editors.open",args)}function unbindKeyboardShortcuts(){var shortcuts=Utilities.copy(keyboardService.keyboardEvent);editorsKeyboardShorcuts.push(shortcuts);for(var _i=0,_Object$entries=Object.entries(shortcuts);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0];_Object$entries$_i[1],keyboardService.unbind(key)}}function rebindKeyboardShortcuts(){for(var lastSetOfShortcutsIndex=editorsKeyboardShorcuts.length-1,lastSetOfShortcuts=editorsKeyboardShorcuts[lastSetOfShortcutsIndex],_i2=0,_Object$entries2=Object.entries(lastSetOfShortcuts);_i2<_Object$entries2.length;_i2++){var _Object$entries2$_i=_slicedToArray(_Object$entries2[_i2],2),key=_Object$entries2$_i[0],value=_Object$entries2$_i[1];keyboardService.bind(key,value.callback,value.opt)}editorsKeyboardShorcuts.splice(lastSetOfShortcutsIndex,1)}return eventsService.on("appState.backdrop",function(name,args){!0===args.show?function blur(){unbindKeyboardShortcuts(),isEnabled=!1}():function focus(){!1===isEnabled&&(rebindKeyboardShortcuts(),isEnabled=!0)}()}),{getEditors:function getEditors(){return editors},getNumberOfEditors:function getNumberOfEditors(){return editors.length},open:open,close:function close(){var closedEditor=editors[editors.length-1];editors.splice(-1,1);var args={editors:editors,editor:closedEditor};eventsService.emit("appState.editors.close",args),$timeout(function(){rebindKeyboardShortcuts(),0===editors.length&&lastElementInFocus&&lastElementInFocus.focus()},0)},closeAll:function closeAll(){var args={editors:editors=[],editor:null};eventsService.emit("appState.editors.close",args)},mediaEditor:function mediaEditor(editor){editor.view="views/media/edit.html",open(editor)},contentEditor:function contentEditor(editor){editor.view="views/content/edit.html",open(editor)},contentPicker:function contentPicker(editor){editor.view="views/common/infiniteeditors/treepicker/treepicker.html",editor.size||(editor.size="small"),editor.section="content",editor.treeAlias="content",open(editor)},contentTypePicker:function contentTypePicker(editor){editor.view="views/common/infiniteeditors/treepicker/treepicker.html",editor.size||(editor.size="small"),editor.section="settings",editor.treeAlias="documentTypes",open(editor)},mediaTypePicker:function mediaTypePicker(editor){editor.view="views/common/infiniteeditors/treepicker/treepicker.html",editor.size||(editor.size="small"),editor.section="settings",editor.treeAlias="mediaTypes",open(editor)},memberTypePicker:function memberTypePicker(editor){editor.view="views/common/infiniteeditors/treepicker/treepicker.html",editor.size||(editor.size="small"),editor.section="settings",editor.treeAlias="memberTypes",open(editor)},copy:function copy(editor){editor.view="views/common/infiniteeditors/copy/copy.html",editor.size||(editor.size="small"),open(editor)},move:function move(editor){editor.view="views/common/infiniteeditors/move/move.html",editor.size||(editor.size="small"),open(editor)},embed:function embed(editor){editor.view="views/common/infiniteeditors/embed/embed.html",editor.size||(editor.size="small"),open(editor)},rollback:function rollback(editor){editor.view="views/common/infiniteeditors/rollback/rollback.html",editor.size||(editor.size="medium"),open(editor)},filePicker:function filePicker(editor){editor.view="views/common/infiniteeditors/treepicker/treepicker.html",editor.size||(editor.size="small"),editor.section="settings",editor.treeAlias="files",editor.entityType="file",open(editor)},staticFilePicker:function staticFilePicker(editor){editor.view="views/common/infiniteeditors/treepicker/treepicker.html",editor.size||(editor.size="small"),editor.section="settings",editor.treeAlias="staticFiles",editor.entityType="file",open(editor)},linkPicker:function linkPicker(editor){editor.view="views/common/infiniteeditors/linkpicker/linkpicker.html",editor.size||(editor.size="small"),open(editor)},mediaPicker:function mediaPicker(editor){editor.view="views/common/infiniteeditors/mediapicker/mediapicker.html",editor.size||(editor.size="medium"),editor.updatedMediaNodes=[],open(editor)},iconPicker:function iconPicker(editor){editor.view="views/common/infiniteeditors/iconpicker/iconpicker.html",editor.size||(editor.size="small"),open(editor)},documentTypeEditor:function documentTypeEditor(editor){editor.view="views/documenttypes/edit.html",open(editor)},mediaTypeEditor:function mediaTypeEditor(editor){editor.view="views/mediatypes/edit.html",open(editor)},memberTypeEditor:function memberTypeEditor(editor){editor.view="views/membertypes/edit.html",open(editor)},queryBuilder:function queryBuilder(editor){editor.view="views/common/infiniteeditors/querybuilder/querybuilder.html",open(editor)},treePicker:function treePicker(editor){editor.view="views/common/infiniteeditors/treepicker/treepicker.html",editor.size||(editor.size="small"),open(editor)},nodePermissions:function nodePermissions(editor){editor.view="views/common/infiniteeditors/nodepermissions/nodepermissions.html",editor.size||(editor.size="small"),open(editor)},insertCodeSnippet:function insertCodeSnippet(editor){editor.view="views/common/infiniteeditors/insertcodesnippet/insertcodesnippet.html",editor.size||(editor.size="small"),open(editor)},userGroupPicker:function userGroupPicker(editor){editor.view="views/common/infiniteeditors/usergrouppicker/usergrouppicker.html",editor.size||(editor.size="small"),open(editor)},userGroupEditor:function userGroupEditor(editor){editor.view="views/users/group.html",open(editor)},templateEditor:function templateEditor(editor){editor.view="views/templates/edit.html",open(editor)},sectionPicker:function sectionPicker(editor){editor.view="views/common/infiniteeditors/sectionpicker/sectionpicker.html",editor.size||(editor.size="small"),open(editor)},insertField:function insertField(editor){editor.view="views/common/infiniteeditors/insertfield/insertfield.html",editor.size||(editor.size="small"),open(editor)},templateSections:function templateSections(editor){editor.view="views/common/infiniteeditors/templatesections/templatesections.html",editor.size||(editor.size="small"),open(editor)},userPicker:function userPicker(editor){editor.view="views/common/infiniteeditors/userpicker/userpicker.html",editor.size||(editor.size="small"),open(editor)},itemPicker:function itemPicker(editor){editor.view="views/common/infiniteeditors/itempicker/itempicker.html",editor.size||(editor.size="small"),open(editor)},macroPicker:function macroPicker(editor){editor.view="views/common/infiniteeditors/macropicker/macropicker.html",editor.size||(editor.size="small"),open(editor)},memberGroupPicker:function memberGroupPicker(editor){editor.view="views/common/infiniteeditors/membergrouppicker/membergrouppicker.html",editor.size||(editor.size="small"),open(editor)},memberPicker:function memberPicker(editor){editor.view="views/common/infiniteeditors/treepicker/treepicker.html",editor.size||(editor.size="small"),editor.section="member",editor.treeAlias="member",open(editor)},memberEditor:function memberEditor(editor){editor.view="views/member/edit.html",open(editor)},mediaCropDetails:function mediaCropDetails(editor){editor.view="views/common/infiniteeditors/mediapicker/overlays/mediacropdetails.html",open(editor)}}})}(),angular.module("umbraco.services").factory("editorState",function($rootScope,eventsService){var current=null,state={set:function set(entity){current=entity,eventsService.emit("editorState.changed",{entity:entity})},reset:function reset(){current=null},getCurrent:function getCurrent(){return current}};return Object.defineProperty(state,"current",{get:function get(){return current},set:function set(value){throw"Use editorState.set to set the value of the current entity"}}),$rootScope.$on("$routeChangeSuccess",function(event,current,previous){state.reset()}),state}),function(){angular.module("umbraco.services").factory("entityHelper",function entityHelper(){return{getEntityTypeFromSection:function getEntityTypeFromSection(section){return"member"===section?"Member":"media"===section?"Media":"Document"}}})}(),angular.module("umbraco.services").factory("eventsService",eventsService),angular.module("umbraco.services").factory("externalLoginInfoService",externalLoginInfoService),angular.module("umbraco.services").factory("fileManager",fileManager),function(){angular.module("umbraco.services").factory("focusService",function focusService(){var currentFocus=null,lastKnownFocus=null;return document.addEventListener("focusin",function focusInApp(e){currentFocus=e.target}),{getLastKnownFocus:function getLastKnownFocus(){return lastKnownFocus},rememberFocus:function rememberFocus(){lastKnownFocus=currentFocus},setLastKnownFocus:function setLastKnownFocus(element){lastKnownFocus=element}}})}(),function(){angular.module("umbraco.services").factory("focusLockService",function focusLockService($document){var elementToInert=$document[0].querySelector("#mainwrapper");return{addInertAttribute:function addInertAttribute(){elementToInert&&elementToInert.setAttribute("inert",!0)},removeInertAttribute:function removeInertAttribute(){elementToInert&&elementToInert.removeAttribute("inert")}}})}(),angular.module("umbraco.services").factory("formHelper",formHelper),angular.module("umbraco.services").factory("gridService",function($http,$q){var configPath=Umbraco.Sys.ServerVariables.umbracoUrls.gridConfig;return{getGridEditors:function getGridEditors(){return $http.get(configPath)}}}),angular.module("umbraco.services").factory("helpService",function($http,$q,umbRequestHelper,dashboardResource){var helpTopics={};function fetchUrl(site,url){var deferred=$q.defer(),found=function getCachedHelp(url){return helpTopics[url]?helpTopics[cacheKey]:null}(url);return found?deferred.resolve(found):dashboardResource.getRemoteXmlData(site,url).then(function(data){var feed=$(data.data),topics=[];$("item",feed).each(function(i,item){var topic={};topic.thumbnail=$(item).find("thumbnail").attr("url"),topic.title=$("title",item).text(),topic.link=$("guid",item).text(),topic.description=$("description",item).text(),topics.push(topic)}),function setCachedHelp(url,data){helpTopics[url]=data}(topics),deferred.resolve(topics)},function(exception){console.error("ex from remote data",exception)}),deferred.promise}var service={findHelp:function findHelp(args){return fetchUrl("OUR",service.getUrl("rss/help",args))},findVideos:function findVideos(args){return fetchUrl("TV",service.getUrl("feeds/help",args))},getContextHelpForPage:function getContextHelpForPage(section,tree,baseurl){var qs="?section="+section+"&tree="+tree;tree&&(qs+="&tree="+tree),baseurl&&(qs+="&baseurl="+encodeURIComponent(baseurl));var url=umbRequestHelper.getApiUrl("helpApiBaseUrl","GetContextHelpForPage"+qs);return umbRequestHelper.resourcePromise($http.get(url),"Failed to get lessons content")},getUrl:function getUrl(url,args){return url+"?"+$.param(args)}};return service}),angular.module("umbraco.services").factory("historyService",function($rootScope,$timeout,angularHelper,eventsService){var nArray=[];return{add:function add(item){var icon=item.icon||"icon-file";angularHelper.safeApply($rootScope,function(){var result=function _add(item){if(!item)return null;var listWithoutThisItem=_.reject(nArray,function(i){return i.link===item.link});return listWithoutThisItem.splice(0,0,item),(nArray=listWithoutThisItem)[0]}({name:item.name,icon:icon,link:item.link,time:new Date});return eventsService.emit("historyService.add",{added:result,all:nArray}),result})},remove:function remove(index){angularHelper.safeApply($rootScope,function(){var result=nArray.splice(index,1);eventsService.emit("historyService.remove",{removed:result,all:nArray})})},removeAll:function removeAll(){angularHelper.safeApply($rootScope,function(){nArray=[],eventsService.emit("historyService.removeAll")})},getCurrent:function getCurrent(){return nArray},getLastAccessedItemForSection:function getLastAccessedItemForSection(sectionAlias){for(var i=0,len=nArray.length;i<len;i++){var item=nArray[i];if(0===item.link.indexOf(sectionAlias+"/"))return item}return null}}}),angular.module("umbraco.services").factory("iconHelper",iconHelper),angular.module("umbraco.services").factory("imageHelper",imageHelper),angular.module("umbraco.services").factory("keyboardService",["$window","$timeout",keyboardService]),function(){angular.module("umbraco.services").factory("listViewHelper",function listViewHelper($location,$rootScope,localStorageService,urlHelper,editorService){var firstSelectedIndex=0,localStorageKey="umblistViewLayout";function setLayout(id,selectedLayout,availableLayouts){for(var activeLayout={},layoutFound=!1,i=0;availableLayouts.length>i;i++){var layout=availableLayouts[i];layout.path===selectedLayout.path?(activeLayout=layout,layout.active=!0,layoutFound=!0):layout.active=!1}return layoutFound||(activeLayout=getFirstAllowedLayout(availableLayouts)),saveLayoutInLocalStorage(id,activeLayout),activeLayout}function saveLayoutInLocalStorage(id,selectedLayout){var layoutFound=!1,storedLayouts=[];if(localStorageService.get(localStorageKey)&&(storedLayouts=localStorageService.get(localStorageKey)),storedLayouts.length>0)for(var i=0;storedLayouts.length>i;i++){var layout=storedLayouts[i];isMatchingLayout(id,layout)&&(layout.path=selectedLayout.path,layoutFound=!0)}if(!layoutFound){var storageObject={id:id,path:selectedLayout.path};storedLayouts.push(storageObject)}localStorageService.set(localStorageKey,storedLayouts)}function getFirstAllowedLayout(layouts){var firstAllowedLayout={};if(null!=layouts)for(var i=0;layouts.length>i;i++){var layout=layouts[i];if(!0===layout.selected){firstAllowedLayout=layout;break}}return firstAllowedLayout}function selectItem(item,selection){for(var isSelected=!1,i=0;selection.length>i;i++){var selectedItem=selection[i];(2147483647!==item.id&&item.id===selectedItem.id||item.key&&item.key===selectedItem.key)&&(isSelected=!0)}if(!isSelected){var obj={id:item.id};item.key&&(obj.key=item.key),selection.push(obj),item.selected=!0,$rootScope.$broadcast("listView.itemsChanged",{items:selection})}}function deselectItem(item,selection){for(var i=0;selection.length>i;i++){var selectedItem=selection[i];(2147483647!==item.id&&item.id===selectedItem.id||item.key&&item.key===selectedItem.key)&&(selection.splice(i,1),item.selected=!1,$rootScope.$broadcast("listView.itemsChanged",{items:selection}))}}function isSelectedAll(items,selection){for(var numberOfSelectedItem=0,itemIndex=0;items.length>itemIndex;itemIndex++)for(var item=items[itemIndex],selectedIndex=0;selection.length>selectedIndex;selectedIndex++){var selectedItem=selection[selectedIndex];(2147483647!==item.id&&item.id===selectedItem.id||item.key&&item.key===selectedItem.key)&&numberOfSelectedItem++}if(numberOfSelectedItem===items.length)return!0}function isMatchingLayout(id,layout){return layout.id===id||layout.nodeId===id}return{getLayout:function getLayout(id,availableLayouts){var storedLayouts=[];if(localStorageService.get(localStorageKey)&&(storedLayouts=localStorageService.get(localStorageKey)),storedLayouts&&storedLayouts.length>0)for(var i=0;storedLayouts.length>i;i++){var layout=storedLayouts[i];if(isMatchingLayout(id,layout))return setLayout(id,layout,availableLayouts)}return getFirstAllowedLayout(availableLayouts)},getFirstAllowedLayout:getFirstAllowedLayout,setLayout:setLayout,saveLayoutInLocalStorage:saveLayoutInLocalStorage,selectHandler:function selectHandler(selectedItem,selectedIndex,items,selection,$event){var start=0,end=0;if(!0===$event.shiftKey)if(selectedIndex>firstSelectedIndex)for(start=firstSelectedIndex,end=selectedIndex;end>=start;start++)selectItem(items[start],selection);else for(start=firstSelectedIndex,end=selectedIndex;end<=start;start--)selectItem(items[start],selection);else selectedItem.selected?deselectItem(selectedItem,selection):selectItem(selectedItem,selection),firstSelectedIndex=selectedIndex},selectItem:selectItem,deselectItem:deselectItem,clearSelection:function clearSelection(items,folders,selection){var i=0;if(selection.length=0,Utilities.isArray(items))for(i=0;items.length>i;i++)items[i].selected=!1;if(Utilities.isArray(folders))for(i=0;folders.length>i;i++)folders[i].selected=!1;$rootScope.$broadcast("listView.itemsChanged",{items:selection})},selectAllItems:function selectAllItems(items,selection,$event){var checkbox=$event.target,clearSelection=!1;if(Utilities.isArray(items)){selection.length=0;for(var i=0;i<items.length;i++){var item=items[i],obj={id:item.id};item.key&&(obj.key=item.key),checkbox.checked?selection.push(obj):clearSelection=!0,item.selected=checkbox.checked}clearSelection&&(selection.length=0),$rootScope.$broadcast("listView.itemsChanged",{items:selection})}},selectAllItemsToggle:function selectAllItemsToggle(items,selection){Utilities.isArray(items)&&(isSelectedAll(items,selection)?(items.forEach(function(item){item.selected=!1}),selection.length=0):(selection.length=0,items.forEach(function(item){var obj={id:item.id};item.key&&(obj.key=item.key),item.selected=!0,selection.push(obj)})),$rootScope.$broadcast("listView.itemsChanged",{items:selection}))},isSelectedAll:isSelectedAll,setSortingDirection:function setSortingDirection(col,direction,options){return options.orderBy.toUpperCase()===col.toUpperCase()&&options.orderDirection===direction},setSorting:function setSorting(field,allow,options){allow&&(options.orderBy===field&&"asc"===options.orderDirection?options.orderDirection="desc":options.orderDirection="asc",options.orderBy=field)},getButtonPermissions:function getButtonPermissions(unmergedPermissions,currentIdsWithPermissions){null==currentIdsWithPermissions&&(currentIdsWithPermissions={}),_.each(unmergedPermissions,function(value,key,list){currentIdsWithPermissions[key]=value});var arr=[];_.each(currentIdsWithPermissions,function(value,key,list){arr.push(value)});var intersectPermissions=_.intersection.apply(_,arr);return{canCopy:_.contains(intersectPermissions,"O"),canCreate:_.contains(intersectPermissions,"C"),canDelete:_.contains(intersectPermissions,"D"),canMove:_.contains(intersectPermissions,"M"),canPublish:_.contains(intersectPermissions,"U"),canUnpublish:_.contains(intersectPermissions,"U")}},editItem:function editItem(item,scope){if(item.editPath){if(scope&&scope.options&&scope.options.useInfiniteEditor){var editorModel={id:item.id,submit:function submit(model){editorService.close(),scope.getContent(scope.contentId)},close:function close(){editorService.close(),scope.getContent(scope.contentId)}};if(0==item.editPath.indexOf("/content/"))return void editorService.contentEditor(editorModel);if(0==item.editPath.indexOf("/media/"))return void editorService.mediaEditor(editorModel);if(0==item.editPath.indexOf("/member/"))return editorModel.id=item.key,void editorService.memberEditor(editorModel)}var parts=item.editPath.split("?"),path=parts[0],params=parts[1]?urlHelper.getQueryStringParams("?"+parts[1]):{};for(var p in $location.path(path),params)$location.search(p,params[p])}}}})}(),function(){angular.module("umbraco.services").factory("listViewPrevalueHelper",function listViewPrevalueHelper(){var prevalues=[];return{getPrevalues:function getPrevalues(){return prevalues},setPrevalues:function setPrevalues(values){prevalues=values}}})}(),angular.module("umbraco.services").factory("localizationService",function($http,$q,eventsService){var resourceFileLoadStatus="none",resourceLoadingPromise=[],innerDictionary=[];var service={initLocalizedResources:function initLocalizedResources(){var deferred=$q.defer();return"loaded"===resourceFileLoadStatus?(deferred.resolve(innerDictionary),deferred.promise):"loading"===resourceFileLoadStatus?(resourceLoadingPromise.push(deferred),deferred.promise):(resourceFileLoadStatus="loading",$http({method:"GET",url:"LocalizedText",cache:!1}).then(function(response){for(var p in resourceFileLoadStatus="loaded",innerDictionary=response.data,eventsService.emit("localizationService.updated",response.data),deferred.resolve(response.data),resourceLoadingPromise)resourceLoadingPromise[p].resolve(response.data)},function(err){for(var p in deferred.reject("Something broke"),resourceLoadingPromise)resourceLoadingPromise[p].reject("Something broke")}),deferred.promise)},tokenize:function tokenize(value,scope){if(value){var localizer=value.split(":"),retval={tokens:void 0,key:localizer[0].substring(0)};if(localizer.length>1){retval.tokens=localizer[1].split(",");for(var x=0;x<retval.tokens.length;x++)retval.tokens[x]=scope.$eval(retval.tokens[x])}return retval}return value},tokenReplace:function tokenReplace(text,tokens){if(tokens)for(var i=0;i<tokens.length;i++)text=text.replace("%"+i+"%",_.escape(tokens[i]));return text},localize:function localize(value,tokens,fallbackValue){return service.initLocalizedResources().then(function(dic){return function _lookup(alias,tokens,dictionary,fallbackValue){alias&&"@"===alias[0]&&(alias=alias.substring(1));var underscoreIndex=alias.indexOf("_");alias&&underscoreIndex<0&&(underscoreIndex=(alias="general_"+alias).indexOf("_"));var areaAlias=alias.substring(0,underscoreIndex),valueAlias=alias.substring(underscoreIndex+1),areaEntry=dictionary[areaAlias];if(areaEntry){var valueEntry=areaEntry[valueAlias];if(valueEntry)return service.tokenReplace(valueEntry,tokens)}return fallbackValue||"["+alias+"]"}(value,tokens,dic,fallbackValue)})},localizeMany:function localizeMany(keys){if(keys){for(var promises=[],i=0;i<keys.length;i++)promises.push(service.localize(keys[i],void 0));return $q.all(promises).then(function(localizedValues){return localizedValues})}},concat:function concat(keys){if(keys){for(var promises=[],i=0;i<keys.length;i++)promises.push(service.localize(keys[i],void 0));return $q.all(promises).then(function(localizedValues){for(var returnValue="",j=0;j<localizedValues.length;j++)returnValue+=localizedValues[j];return returnValue})}},format:function format(keys,message){if(keys){for(var promises=[],i=0;i<keys.length;i++)promises.push(service.localize(keys[i],void 0));return $q.all(promises).then(function(localizedValues){for(var j=0;j<localizedValues.length;j++){var regex=new RegExp("%"+j+"%","g");message=message.replace(regex,localizedValues[j])}return message})}}};return eventsService.on("app.authenticated",function(){resourceFileLoadStatus="none",resourceLoadingPromise=[]}),service}),angular.module("umbraco.services").factory("macroService",macroService),angular.module("umbraco.services").factory("mediaHelper",mediaHelper),angular.module("umbraco.services").factory("mediaTypeHelper",mediaTypeHelper),angular.module("umbraco.services").factory("umbracoMenuActions",umbracoMenuActions),angular.module("umbraco.services").factory("navigationService",navigationService),angular.module("umbraco.services").factory("notificationsService",function($rootScope,$timeout,angularHelper){var nArray=[];function setViewPath(view){return view.indexOf("/")<0&&(view="views/common/notifications/"+view),view.indexOf(".html")<0&&(view+=".html"),view}var service={add:function add(item){angularHelper.safeApply($rootScope,function(){return item.view&&(item.view=setViewPath(item.view),item.sticky=!0,item.type="form",item.headline=null),item.message&&(item.headline+=": ",item.message.length>200&&(item.sticky=!0)),item.id=String.CreateGuid(),nArray.push(item),item.sticky||$timeout(function(){var found=_.find(nArray,function(i){return i.id===item.id});if(found){var index=nArray.indexOf(found);nArray.splice(index,1)}},1e4),item})},hasView:function hasView(view){return view?(view=setViewPath(view).toLowerCase(),_.find(nArray,function(notification){return notification.view.toLowerCase()===view})):_.find(nArray,function(notification){return notification.view})},addView:function addView(view,args){var item={args:args,view:view};service.add(item)},showNotification:function showNotification(args){if(!args)throw"args cannot be null";if(void 0===args.type||null===args.type)throw"args.type cannot be null";if(!args.header)throw"args.header cannot be null";switch(args.type){case 0:case"Save":this.success(args.header,args.message);break;case 1:case"Info":this.info(args.header,args.message);break;case 2:case"Error":this.error(args.header,args.message);break;case 3:case"Success":this.success(args.header,args.message);break;case 4:case"Warning":this.warning(args.header,args.message)}},success:function success(headline,message){return service.add({headline:headline,message:message,type:"success",time:new Date})},error:function error(headline,message){return service.add({headline:headline,message:message,type:"error",time:new Date})},warning:function warning(headline,message){return service.add({headline:headline,message:message,type:"warning",time:new Date})},info:function info(headline,message){return service.add({headline:headline,message:message,type:"info",time:new Date})},remove:function remove(index){if(Utilities.isObject(index)){var i=nArray.indexOf(index);angularHelper.safeApply($rootScope,function(){nArray.splice(i,1)})}else angularHelper.safeApply($rootScope,function(){nArray.splice(index,1)})},removeAll:function removeAll(){angularHelper.safeApply($rootScope,function(){nArray=[]})},current:nArray,getCurrent:function getCurrent(){return nArray}};return service}),function(){angular.module("umbraco.services").factory("overlayService",function overlayService(eventsService,backdropService,focusLockService){var currentOverlay=null;function open(newOverlay){currentOverlay&&_close();var backdropOptions={},overlay=newOverlay;overlay.position||(overlay.position="center"),overlay.size||(overlay.size="small"),overlay.view||(overlay.view="views/common/overlays/default/default.html"),overlay.disableBackdropClick&&(backdropOptions.disableEventsOnClick=!0),overlay.show=!0,focusLockService.addInertAttribute(),backdropService.open(backdropOptions),currentOverlay=overlay,eventsService.emit("appState.overlay",overlay)}function _close(){focusLockService.removeInertAttribute(),document.body.classList.contains("umb-tour-is-visible")||backdropService.close(),currentOverlay=null,eventsService.emit("appState.overlay",null)}function confirm(overlay){switch(overlay.closeButtonLabelKey||(overlay.closeButtonLabelKey="general_cancel"),overlay.view||(overlay.view="views/common/overlays/confirm/confirm.html"),overlay.close||(overlay.close=function(){_close()}),overlay.confirmType){case"delete":overlay.confirmMessageStyle||(overlay.confirmMessageStyle="danger"),overlay.submitButtonStyle||(overlay.submitButtonStyle="danger"),overlay.submitButtonLabelKey||(overlay.submitButtonLabelKey="actions_delete");break;case"remove":overlay.submitButtonStyle||(overlay.submitButtonStyle="primary"),overlay.submitButtonLabelKey||(overlay.submitButtonLabelKey="actions_remove");break;default:overlay.submitButtonLabelKey||(overlay.submitButtonLabelKey="general_confirm")}open(overlay)}return{open:open,close:_close,ysod:function ysod(error){open({view:"views/common/overlays/ysod/ysod.html",error:error,close:function close(){_close()}})},confirm:confirm,confirmDelete:function confirmDelete(overlay){overlay.confirmType="delete",confirm(overlay)},confirmRemove:function confirmRemove(overlay){overlay.confirmType="remove",confirm(overlay)}}})}(),function(){angular.module("umbraco.services").factory("overlayHelper",function overlayHelper(){var numberOfOverlays=0;return{numberOfOverlays:numberOfOverlays,registerOverlay:function registerOverlay(){return++numberOfOverlays},unregisterOverlay:function unregisterOverlay(){return--numberOfOverlays},getNumberOfOverlays:function getNumberOfOverlays(){return numberOfOverlays}}})}(),function(){angular.module("umbraco.services").factory("platformService",function platformService(){return{isMac:function isMac(){return navigator.platform.toUpperCase().indexOf("MAC")>=0}}})}(),function(){angular.module("umbraco.services").factory("requestRetryQueue",function requestRetryQueue($q,$log){var retryQueue=[],retryUser=null,service={onItemAddedCallbacks:[],hasMore:function hasMore(){return retryQueue.length>0},push:function push(retryItem){retryQueue.push(retryItem),Utilities.forEach(service.onItemAddedCallbacks,function(cb){try{cb(retryItem)}catch(e){$log.error("requestRetryQueue.push(retryItem): callback threw an error"+e)}})},pushRetryFn:function pushRetryFn(reason,userName,retryFn){if(2===arguments.length&&(retryFn=userName,userName=reason,reason=void 0),retryUser&&retryUser!==userName||null===userName)throw new Error("invalid user");retryUser=userName;var deferred=$q.defer(),retryItem={reason:reason,retry:function retry(){$q.when(retryFn()).then(function(value){deferred.resolve(value)},function(value){deferred.reject(value)})},cancel:function cancel(){deferred.reject()}};return service.push(retryItem),deferred.promise},retryReason:function retryReason(){return service.hasMore()&&retryQueue[0].reason},cancelAll:function cancelAll(){for(;service.hasMore();)retryQueue.shift().cancel();retryUser=null},retryAll:function retryAll(userName){if(null!=retryUser)if(retryUser===userName)for(;service.hasMore();)retryQueue.shift().retry();else service.cancelAll()}};return service})}(),angular.module("umbraco.services").factory("searchService",function(entityResource,$injector,searchResultFormatter){return{searchMembers:function searchMembers(args){if(!args.term)throw"args.term is required";return entityResource.search(args.term,"Member",args.searchFrom).then(function(data){return data.forEach(function(item){return searchResultFormatter.configureMemberResult(item)}),data})},searchContent:function searchContent(args){if(!args.term)throw"args.term is required";return entityResource.search(args.term,"Document",args.searchFrom,args.canceler,args.dataTypeKey).then(function(data){return data.forEach(function(item){return searchResultFormatter.configureContentResult(item)}),data})},searchMedia:function searchMedia(args){if(!args.term)throw"args.term is required";return entityResource.search(args.term,"Media",args.searchFrom,args.canceler,args.dataTypeKey).then(function(data){return data.forEach(function(item){return searchResultFormatter.configureMediaResult(item)}),data})},searchAll:function searchAll(args){var _this=this;if(!args.term)throw"args.term is required";return entityResource.searchAll(args.term,args.canceler).then(function(data){return Object.values(data).forEach(function(resultByType){var formatterMethod=searchResultFormatter.configureDefaultResult;if(resultByType.jsSvc){var searchFormatterService=$injector.get(resultByType.jsSvc);if(searchFormatterService&&(resultByType.jsMethod||(resultByType.jsMethod="format"),!(formatterMethod=searchFormatterService[resultByType.jsMethod])))throw"The method "+resultByType.jsMethod+" on the angular service "+resultByType.jsSvc+" could not be found"}resultByType.results.forEach(function(item){formatterMethod.apply(_this,[item,resultByType.treeAlias,resultByType.appAlias])})}),data})},setCurrent:function setCurrent(sectionAlias){}}}),angular.module("umbraco.services").factory("searchResultFormatter",searchResultFormatter),function(){angular.module("umbraco.services").factory("sectionService",function sectionService(userService,$q,sectionResource){return{getSectionsForUser:function getSectionsForUser(){var deferred=$q.defer();return userService.getCurrentUser().then(function(u){u.sections?deferred.resolve(u.sections):sectionResource.getSections().then(function(sections){u.sections=sections,deferred.resolve(u.sections)})}),deferred.promise}}})}(),angular.module("umbraco.services").factory("serverValidationManager",serverValidationManager),function(){angular.module("umbraco.services").factory("tabbableService",function tabbableService(){var candidateSelectors=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"iframe[data-mce-style]"],candidateSelector=candidateSelectors.join(","),matches="undefined"==typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;function tabbable(el,options){options=options||{};var i,candidate,candidateTabindex,regularTabbables=[],orderedTabbables=[],untouchabilityChecker=new UntouchabilityChecker(el.ownerDocument||el),candidates=el.querySelectorAll(candidateSelector);for(options.includeContainer&&matches.call(el,candidateSelector)&&(candidates=Array.prototype.slice.apply(candidates)).unshift(el),i=0;i<candidates.length;i++)isNodeMatchingSelectorTabbable(candidate=candidates[i],untouchabilityChecker)&&(0===(candidateTabindex=getTabindex(candidate))?regularTabbables.push(candidate):orderedTabbables.push({documentOrder:i,tabIndex:candidateTabindex,node:candidate}));return orderedTabbables.sort(sortOrderedTabbables).map(function(a){return a.node}).concat(regularTabbables)}function isNodeMatchingSelectorTabbable(node,untouchabilityChecker){return!(!isNodeMatchingSelectorFocusable(node,untouchabilityChecker)||function isNonTabbableRadio(node){return function isRadio(node){return isInput(node)&&"radio"===node.type}(node)&&!function isTabbableRadio(node){if(!node.name)return!0;var checked=function getCheckedRadio(nodes){for(var i=0;i<nodes.length;i++)if(nodes[i].checked)return nodes[i]}(node.ownerDocument.querySelectorAll('input[type="radio"][name="'+node.name+'"]'));return!checked||checked===node}(node)}(node)||getTabindex(node)<0)}function isTabbable(node,untouchabilityChecker){if(!node)throw new Error("No node provided");return!1!==matches.call(node,candidateSelector)&&isNodeMatchingSelectorTabbable(node,untouchabilityChecker)}function isNodeMatchingSelectorFocusable(node,untouchabilityChecker){return untouchabilityChecker=untouchabilityChecker||new UntouchabilityChecker(node.ownerDocument||node),!(node.disabled||function isHiddenInput(node){return isInput(node)&&"hidden"===node.type}(node)||untouchabilityChecker.isUntouchable(node))}tabbable.isTabbable=isTabbable,tabbable.isFocusable=isFocusable;var focusableCandidateSelector=candidateSelectors.concat("iframe").join(",");function isFocusable(node,untouchabilityChecker){if(!node)throw new Error("No node provided");return!1!==matches.call(node,focusableCandidateSelector)&&isNodeMatchingSelectorFocusable(node,untouchabilityChecker)}function getTabindex(node){var tabindexAttr=parseInt(node.getAttribute("tabindex"),10);return isNaN(tabindexAttr)?function isContentEditable(node){return"true"===node.contentEditable}(node)?0:node.tabIndex:tabindexAttr}function sortOrderedTabbables(a,b){return a.tabIndex===b.tabIndex?a.documentOrder-b.documentOrder:a.tabIndex-b.tabIndex}function isInput(node){return"INPUT"===node.tagName}function UntouchabilityChecker(elementDocument){this.doc=elementDocument,this.cache=[]}return UntouchabilityChecker.prototype.hasDisplayNone=function hasDisplayNone(node,nodeComputedStyle){if(node===this.doc.documentElement)return!1;var cached=function find(list,predicate){for(var i=0,length=list.length;i<length;i++)if(predicate(list[i]))return list[i]}(this.cache,function(item){return item===node});if(cached)return cached[1];if(!nodeComputedStyle){if(node instanceof DocumentFragment)return!0;nodeComputedStyle=this.doc.defaultView.getComputedStyle(node)}var result=!1;return"none"===nodeComputedStyle.display?result=!0:node.parentNode&&(result=this.hasDisplayNone(node.parentNode)),this.cache.push([node,result]),result},UntouchabilityChecker.prototype.isUntouchable=function isUntouchable(node){if(node===this.doc.documentElement)return!1;var computedStyle=this.doc.defaultView.getComputedStyle(node);return!!this.hasDisplayNone(node,computedStyle)||"hidden"===computedStyle.visibility},{tabbable:tabbable,isTabbable:isTabbable,isFocusable:isFocusable}})}(),function(){angular.module("umbraco.services").factory("templateHelper",function templateHelperService(localizationService){return{getInsertDictionarySnippet:function getInsertDictionarySnippet(nodeName){return'@Umbraco.GetDictionaryValue("'+nodeName+'")'},getInsertPartialSnippet:function getInsertPartialSnippet(parentId,nodeName){var partialViewName=nodeName.replace(".cshtml","");return parentId&&(partialViewName=parentId+"/"+partialViewName),'@Html.Partial("'+partialViewName+'")'},getQuerySnippet:function getQuerySnippet(queryExpression){var code="\n@{\n\tvar selection = "+queryExpression+";\n}\n";return code+='<ul>\n\t@foreach (var item in selection)\n\t{\n\t\t<li>\n\t\t\t<a href="@item.Url()">@item.Name()</a>\n\t\t</li>\n\t}\n</ul>\n\n'},getRenderBodySnippet:function getRenderBodySnippet(){return"@RenderBody()"},getRenderSectionSnippet:function getRenderSectionSnippet(sectionName,mandatory){return'@RenderSection("'+sectionName+'", '+mandatory+")"},getAddSectionSnippet:function getAddSectionSnippet(sectionName){return"@section "+sectionName+"\r\n{\r\n\r\n\t{0}\r\n\r\n}\r\n"},getGeneralShortcuts:function getGeneralShortcuts(){return localizationService.localizeMany(["shortcuts_generalHeader","buttons_undo","buttons_redo","buttons_save"]).then(function(data){var labels={};return labels.header=data[0],labels.undo=data[1],labels.redo=data[2],labels.save=data[3],{name:labels.header,shortcuts:[{description:labels.undo,keys:[{key:"ctrl"},{key:"z"}]},{description:labels.redo,keys:[{key:"ctrl"},{key:"y"}]},{description:labels.save,keys:[{key:"ctrl"},{key:"s"}]}]}})},getEditorShortcuts:function getEditorShortcuts(){return localizationService.localizeMany(["shortcuts_editorHeader","shortcuts_commentLine","shortcuts_removeLine","shortcuts_copyLineUp","shortcuts_copyLineDown","shortcuts_moveLineUp","shortcuts_moveLineDown"]).then(function(data){var labels={};return labels.header=data[0],labels.commentline=data[1],labels.removeline=data[2],labels.copylineup=data[3],labels.copylinedown=data[4],labels.movelineup=data[5],labels.movelinedown=data[6],{name:labels.header,shortcuts:[{description:labels.commentline,keys:[{key:"ctrl"},{key:"/"}]},{description:labels.removeline,keys:[{key:"ctrl"},{key:"d"}]},{description:labels.copylineup,keys:{win:[{key:"alt"},{key:"shift"},{key:"up"}],mac:[{key:"cmd"},{key:"alt"},{key:"up"}]}},{description:labels.copylinedown,keys:{win:[{key:"alt"},{key:"shift"},{key:"down"}],mac:[{key:"cmd"},{key:"alt"},{key:"down"}]}},{description:labels.movelineup,keys:[{key:"alt"},{key:"up"}]},{description:labels.movelinedown,keys:[{key:"alt"},{key:"down"}]}]}})},getTemplateEditorShortcuts:function getTemplateEditorShortcuts(){return localizationService.localizeMany(["template_insert","template_insertPageField","template_insertPartialView","template_insertDictionaryItem","template_insertMacro","template_queryBuilder","template_insertSections","template_mastertemplate"]).then(function(data){var labels={};return labels.insert=data[0],labels.pagefield=data[1],labels.partialview=data[2],labels.dictionary=data[3],labels.macro=data[4],labels.querybuilder=data[5],labels.sections=data[6],labels.mastertemplate=data[7],{name:"Umbraco",shortcuts:[{description:labels.insert.concat(" ",labels.pagefield),keys:[{key:"alt"},{key:"shift"},{key:"v"}]},{description:labels.insert.concat(" ",labels.partialview),keys:[{key:"alt"},{key:"shift"},{key:"p"}]},{description:labels.insert.concat(" ",labels.dictionary),keys:[{key:"alt"},{key:"shift"},{key:"d"}]},{description:labels.insert.concat(" ",labels.macro),keys:[{key:"alt"},{key:"shift"},{key:"m"}]},{description:labels.querybuilder,keys:[{key:"alt"},{key:"shift"},{key:"q"}]},{description:labels.insert.concat(" ",labels.sections),keys:[{key:"alt"},{key:"shift"},{key:"s"}]},{description:labels.mastertemplate,keys:[{key:"alt"},{key:"shift"},{key:"t"}]}]}})},getPartialViewEditorShortcuts:function getPartialViewEditorShortcuts(){return localizationService.localizeMany(["template_insert","template_insertPageField","template_insertDictionaryItem","template_insertMacro","template_queryBuilder"]).then(function(data){var labels={};return labels.insert=data[0],labels.pagefield=data[1],labels.dictionary=data[2],labels.macro=data[3],labels.querybuilder=data[4],{name:"Umbraco",shortcuts:[{description:labels.insert.concat(" ",labels.pagefield),keys:[{key:"alt"},{key:"shift"},{key:"v"}]},{description:labels.insert.concat(" ",labels.dictionary),keys:[{key:"alt"},{key:"shift"},{key:"d"}]},{description:labels.insert.concat(" ",labels.macro),keys:[{key:"alt"},{key:"shift"},{key:"m"}]},{description:labels.querybuilder,keys:[{key:"alt"},{key:"shift"},{key:"q"}]}]}})}}})}(),angular.module("umbraco.services").factory("tinyMceService",tinyMceService),function(){angular.module("umbraco.services").factory("tourService",function tourService(eventsService,currentUserResource,$q,tourResource){var tours=[],currentTour=null;function getTours(){return tours}function validateTour(tour){if(!tour)throw"A tour is not specified";if(!tour.alias)throw"A tour alias is required";if(!tour.steps)throw"Tour "+tour.alias+" is missing tour steps";if(tour.steps&&0===tour.steps.length)throw"Tour "+tour.alias+" is missing tour steps";if(0===tour.requiredSections.length)throw"Tour "+tour.alias+" is missing the required sections"}function setTourStatuses(tours){var deferred=$q.defer();return currentUserResource.getTours().then(function(storedTours){Utilities.forEach(storedTours,function(storedTour){!0===storedTour.completed&&Utilities.forEach(tours,function(tour){storedTour.alias===tour.alias&&(tour.completed=!0)}),!0===storedTour.disabled&&Utilities.forEach(tours,function(tour){storedTour.alias===tour.alias&&(tour.disabled=!0)})}),deferred.resolve(tours)}),deferred.promise}return{registerAllTours:function registerAllTours(){return tours=[],tourResource.getTours().then(function(tourFiles){Utilities.forEach(tourFiles,function(tourFile){Utilities.forEach(tourFile.tours,function(newTour){validateTour(newTour),function validateTourRegistration(tour){Utilities.forEach(tours,function(existingTour){if(existingTour.alias===tour.alias)throw"A tour with the alias "+tour.alias+" is already registered"})}(newTour),tours.push(newTour)})}),eventsService.emit("appState.tour.updatedTours",tours)})},startTour:function startTour(tour){validateTour(tour),eventsService.emit("appState.tour.start",tour),currentTour=tour},endTour:function endTour(tour){eventsService.emit("appState.tour.end",tour),currentTour=null},disableTour:function disableTour(tour){var deferred=$q.defer();return tour.disabled=!0,currentUserResource.saveTourStatus({alias:tour.alias,disabled:tour.disabled,completed:tour.completed}).then(function(){eventsService.emit("appState.tour.end",tour),currentTour=null,deferred.resolve(tour)}),deferred.promise},completeTour:function completeTour(tour){var deferred=$q.defer();return tour.completed=!0,currentUserResource.saveTourStatus({alias:tour.alias,disabled:tour.disabled,completed:tour.completed}).then(function(){eventsService.emit("appState.tour.complete",tour),currentTour=null,deferred.resolve(tour)}),deferred.promise},getCurrentTour:function getCurrentTour(){return currentTour},getGroupedTours:function getGroupedTours(){var deferred=$q.defer(),tours=getTours();return setTourStatuses(tours).then(function(){var groupedTours=[];tours.forEach(function(item){if(null===item.contentType||""===item.contentType){var groupExists=!1,newGroup={group:"",tours:[]};groupedTours.forEach(function(group){group.group===item.group&&(item.groupOrder&&(group.groupOrder=item.groupOrder),groupExists=!0,!1===item.hidden&&group.tours.push(item))}),groupExists||(newGroup.group=item.group,item.groupOrder&&(newGroup.groupOrder=item.groupOrder),!1===item.hidden&&(newGroup.tours.push(item),groupedTours.push(newGroup)))}}),deferred.resolve(groupedTours)}),deferred.promise},getTourByAlias:function getTourByAlias(tourAlias){var deferred=$q.defer(),tours=getTours();return setTourStatuses(tours).then(function(){var tour=_.findWhere(tours,{alias:tourAlias});deferred.resolve(tour)}),deferred.promise},getToursForDoctype:function getToursForDoctype(doctypeAlias){var deferred=$q.defer();return tourResource.getToursForDoctype(doctypeAlias).then(function(tours){deferred.resolve(tours)}),deferred.promise}}})}(),angular.module("umbraco.services").factory("treeService",treeService),function(){angular.module("umbraco.services").factory("udiService",function udiService(){return{create:function create(entityType){return this.build(entityType,String.CreateGuid())},build:function build(entityType,guid){return"umb://"+entityType+"/"+guid.replace(/-/g,"")},getKey:function getKey(udi){if(!Utilities.isString(udi))throw"udi is not a string";if(!udi.startsWith("umb://"))throw"udi does not start with umb://";var withoutScheme=udi.substr("umb://".length),withoutHost=withoutScheme.substr(withoutScheme.indexOf("/")+1).trim();if(32!==withoutHost.length)throw"udi is not 32 chars";return"".concat(withoutHost.substr(0,8),"-").concat(withoutHost.substr(8,4),"-").concat(withoutHost.substr(12,4),"-").concat(withoutHost.substr(16,4),"-").concat(withoutHost.substr(20))}}})}(),function(){angular.module("umbraco.services").factory("udiParser",function udiParser(){return{parse:function parse(input){if(!input||"string"!=typeof input||!input.startsWith("umb://"))return null;var lastIndexOfSlash=input.substring("umb://".length).lastIndexOf("/"),entityType=-1===lastIndexOfSlash?input.substring("umb://".length):input.substr("umb://".length,lastIndexOfSlash),value=-1===lastIndexOfSlash?null:input.substring("umb://".length+lastIndexOfSlash+1);return{entityType:entityType,value:value,toString:function toString(){return"umb://"+entityType+(null===value?"":"/"+value)}}}}})}(),function(){angular.module("umbraco.services").factory("umbDataFormatter",function umbDataFormatter(){function getContentProperties(tabs){var properties=[];return _.each(tabs,function(tab){_.each(tab.properties,function(prop){prop.alias.startsWith("_umb_")||prop.readonly||properties.push({id:prop.id,alias:prop.alias,value:prop.value})})}),properties}return{formatChangePasswordModel:function formatChangePasswordModel(model){if(!model)return null;for(var trimmed=_.omit(model,["confirm"]),allNull=!0,vals=_.values(trimmed),k=0;k<vals.length;k++)null!==vals[k]&&void 0!==vals[k]&&(allNull=!1);return allNull?null:trimmed},formatContentTypePostData:function formatContentTypePostData(displayModel,action){var saveModel=_.pick(displayModel,"compositeContentTypes","isContainer","allowAsRoot","allowedTemplates","allowedContentTypes","alias","description","thumbnail","name","id","icon","trashed","key","parentId","alias","path","allowCultureVariant","allowSegmentVariant","isElement");saveModel.allowedTemplates=_.map(displayModel.allowedTemplates,function(t){return t.alias}),saveModel.defaultTemplate=displayModel.defaultTemplate?displayModel.defaultTemplate.alias:null;var realGroups=_.reject(displayModel.groups,function(g){return"init"===g.tabState});return saveModel.groups=_.map(realGroups,function(g){var saveGroup=_.pick(g,"inherited","id","sortOrder","name","alias","type"),realProperties=_.reject(g.properties,function(p){return"init"===p.propertyState||!0===p.inherited}),saveProperties=_.map(realProperties,function(p){return _.pick(p,"id","alias","description","validation","label","sortOrder","dataTypeId","groupId","memberCanEdit","showOnMemberProfile","isSensitiveData","allowCultureVariant","allowSegmentVariant","labelOnTop")});return saveGroup.properties=saveProperties,!0===saveGroup.inherited&&0===saveProperties.length?null:saveGroup}),saveModel.groups=_.reject(saveModel.groups,function(g){return!g}),saveModel},formatDataTypePostData:function formatDataTypePostData(displayModel,preValues,action){for(var saveModel={parentId:displayModel.parentId,id:displayModel.id,name:displayModel.name,selectedEditor:displayModel.selectedEditor,action:action,preValues:[]},i=0;i<preValues.length;i++)saveModel.preValues.push({key:preValues[i].alias,value:preValues[i].value});return saveModel},formatDictionaryPostData:function formatDictionaryPostData(dictionary,nameIsDirty){for(var saveModel={parentId:dictionary.parentId,id:dictionary.id,name:dictionary.name,nameIsDirty:nameIsDirty,translations:[],key:dictionary.key},i=0;i<dictionary.translations.length;i++)saveModel.translations.push({isoCode:dictionary.translations[i].isoCode,languageId:dictionary.translations[i].languageId,translation:dictionary.translations[i].translation});return saveModel},formatUserPostData:function formatUserPostData(displayModel){for(var saveModel=_.pick(displayModel,"id","parentId","name","username","culture","email","startContentIds","startMediaIds","userGroups","message"),currGroups=saveModel.userGroups,formattedGroups=[],i=0;i<currGroups.length;i++)Utilities.isString(currGroups[i])?formattedGroups.push(currGroups[i]):formattedGroups.push(currGroups[i].alias);saveModel.userGroups=formattedGroups;for(var props=["startContentIds","startMediaIds"],m=0;m<props.length;m++){var startIds=saveModel[props[m]];if(startIds){for(var formattedIds=[],j=0;j<startIds.length;j++)formattedIds.push(Number(startIds[j].id));saveModel[props[m]]=formattedIds}}return saveModel},formatUserGroupPostData:function formatUserGroupPostData(displayModel,action){var saveModel=_.pick(displayModel,"id","alias","name","icon","sections","users","defaultPermissions","assignedPermissions");saveModel.startContentId=displayModel.contentStartNode,saveModel.startMediaId=displayModel.mediaStartNode,saveModel.action=action,saveModel.id||(saveModel.id=0);var currDefaultPermissions=saveModel.defaultPermissions,saveDefaultPermissions=[];_.each(currDefaultPermissions,function(value,key,list){_.each(value,function(element,index,list){element.checked&&saveDefaultPermissions.push(element.permissionCode)})}),saveModel.defaultPermissions=saveDefaultPermissions;var currAssignedPermissions=saveModel.assignedPermissions,saveAssignedPermissions={};_.each(currAssignedPermissions,function(nodePermissions,index){saveAssignedPermissions[nodePermissions.id]=[],_.each(nodePermissions.allowedPermissions,function(permission,index){permission.checked&&saveAssignedPermissions[nodePermissions.id].push(permission.permissionCode)})}),saveModel.assignedPermissions=saveAssignedPermissions;for(var currSections=saveModel.sections,formattedSections=[],i=0;i<currSections.length;i++)Utilities.isString(currSections[i])?formattedSections.push(currSections[i]):formattedSections.push(currSections[i].alias);saveModel.sections=formattedSections;for(var currUsers=saveModel.users,formattedUsers=[],j=0;j<currUsers.length;j++)Utilities.isNumber(currUsers[j])?formattedUsers.push(currUsers[j]):formattedUsers.push(currUsers[j].id);saveModel.users=formattedUsers;for(var props=["startContentId","startMediaId"],m=0;m<props.length;m++){var startId=saveModel[props[m]];startId&&(saveModel[props[m]]=startId.id)}return saveModel.parentId=-1,saveModel},formatMemberPostData:function formatMemberPostData(displayModel,action){var saveModel=this.formatMediaPostData(displayModel,action);saveModel.key=displayModel.key;var genericTab=_.find(displayModel.tabs,function(item){return 0===item.id}),propLogin=_.find(genericTab.properties,function(item){return"_umb_login"===item.alias}),propEmail=_.find(genericTab.properties,function(item){return"_umb_email"===item.alias}),propPass=_.find(genericTab.properties,function(item){return"_umb_password"===item.alias}),propGroups=_.find(genericTab.properties,function(item){return"_umb_membergroup"===item.alias});saveModel.email=propEmail.value.trim(),saveModel.username=propLogin.value.trim(),saveModel.password=this.formatChangePasswordModel(propPass.value);var selectedGroups=[];for(var n in propGroups.value)!0===propGroups.value[n]&&selectedGroups.push(n);return saveModel.memberGroups=selectedGroups,saveModel},formatMediaPostData:function formatMediaPostData(displayModel,action){return{id:displayModel.id,properties:getContentProperties(displayModel.tabs),name:displayModel.name,contentTypeAlias:displayModel.contentTypeAlias,parentId:displayModel.parentId,action:action}},formatContentPostData:function formatContentPostData(displayModel,action){var saveModel={id:displayModel.id,name:displayModel.name,contentTypeAlias:displayModel.contentTypeAlias,parentId:displayModel.parentId,action:action,variants:_.map(displayModel.variants,function(v){return{name:v.name||"",properties:getContentProperties(v.tabs),culture:v.language?v.language.culture:null,segment:v.segment,publish:v.publish,save:v.save,releaseDate:v.releaseDate,expireDate:v.expireDate}})},propExpireDate=displayModel.removeDate,propReleaseDate=displayModel.releaseDate,propTemplate=displayModel.template;return saveModel.expireDate=propExpireDate||null,saveModel.releaseDate=propReleaseDate||null,saveModel.templateAlias=propTemplate||null,saveModel},formatContentGetData:function formatContentGetData(displayModel){if(displayModel.variants&&displayModel.variants.length>1){var defaultVariants=_.filter(displayModel.variants,function(variant){var isDefaultLanguage=variant.language&&variant.language.isDefault,isDefaultSegment=null==variant.segment;return isDefaultLanguage||isDefaultSegment});defaultVariants.length>0&&_.each(defaultVariants,function(defaultVariant){var invariantProps=[];_.each(defaultVariant.tabs,function(tab,tabIndex){_.each(tab.properties,function(property,propIndex){property.culture&&property.segment||invariantProps.push({tabIndex:tabIndex,propIndex:propIndex,property:property})})});var otherVariants=_.filter(displayModel.variants,function(variant){return variant!==defaultVariant});_.each(otherVariants,function(variant){_.each(invariantProps,function(invProp){var tab=variant.tabs[invProp.tabIndex],prop=tab.properties[invProp.propIndex],inheritsCulture=prop.culture===invProp.property.culture&&null==prop.segment&&null==invProp.property.segment,inheritsSegment=prop.segment===invProp.property.segment&&!prop.culture;(inheritsCulture||inheritsSegment)&&(tab.properties[invProp.propIndex]=invProp.property)})})})}return displayModel},formatRelationTypePostData:function formatRelationTypePostData(relationType){return{id:relationType.id,name:relationType.name,alias:relationType.alias,key:relationType.key,isBidirectional:relationType.isBidirectional,parentObjectType:relationType.parentObjectType,childObjectType:relationType.childObjectType}}}})}(),angular.module("umbraco.services").factory("umbRequestHelper",umbRequestHelper),function(){angular.module("umbraco.services").factory("urlHelper",function urlHelper($window){var pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function decode(s){return decodeURIComponent(s.replace(pl," "))};return{parseUrl:function parseUrl(url){var urlObj=$window.URL?new $window.URL(url):function polyFillUrl(url){var parser=document.createElement("a");return parser.href=url,{protocol:parser.protocol,host:parser.host,hostname:parser.hostname,port:parser.port,pathname:parser.pathname,search:parser.search,hash:parser.hash}}(url);return urlObj.searchObject=this.getQueryStringParams(urlObj.search),urlObj},parseHashIntoUrl:function parseHashIntoUrl(url){var urlObj=this.parseUrl(url);if(!urlObj.hash)throw new"No hash found in url: "+url;if(!urlObj.hash.startsWith("#/"))throw new"The hash in url does not contain a path to parse: "+url;var fakeUrl="http://fakeurl.com"+urlObj.hash.trimStart("#");return this.parseUrl(fakeUrl)},getQueryStringParams:function getQueryStringParams(location){for(var match,query=location?location.substring(1):$window.location.search.substring(1),urlParams={};match=search.exec(query);)urlParams[decode(match[1])]=decode(match[2]);return urlParams}}})}(),angular.module("umbraco.services").factory("userService",function($rootScope,eventsService,$q,$location,$window,requestRetryQueue,authResource,emailMarketingResource,$timeout,angularHelper){var currentUser=null,lastUserId=null,lastServerTimeoutSet=null;function openLoginDialog(isTimedOut){var args={isTimedOut:isTimedOut};eventsService.emit("app.notAuthenticated",args)}function setCurrentUser(usr){if(!usr.remainingAuthSeconds)throw"The user object is invalid, the remainingAuthSeconds is required.";currentUser=usr,lastServerTimeoutSet=new Date,function countdownUserTimeout(){$timeout(function(){if(currentUser)if(currentUser.remainingAuthSeconds-=5,currentUser.remainingAuthSeconds>30){if(null!=lastServerTimeoutSet){var now=new Date,seconds=(now.getTime()-lastServerTimeoutSet.getTime())/1e3;seconds>30&&(lastServerTimeoutSet=null,angularHelper.safeApply($rootScope,function(){authResource.getRemainingTimeoutSeconds().then(function(result){setUserTimeoutInternal(result)})}))}countdownUserTimeout()}else!0!==Umbraco.Sys.ServerVariables.umbracoSettings.keepUserLoggedIn?angularHelper.safeApply($rootScope,function(){try{authResource.getRemainingTimeoutSeconds()}finally{userAuthExpired()}}):(null!=lastServerTimeoutSet&&(lastServerTimeoutSet=null,angularHelper.safeApply($rootScope,function(){authResource.getRemainingTimeoutSeconds().then(function(result){setUserTimeoutInternal(result)})})),countdownUserTimeout())},5e3,!1)}()}function setUserTimeoutInternal(newTimeout){var asNumber=parseFloat(newTimeout);!isNaN(asNumber)&&currentUser&&Utilities.isNumber(asNumber)&&(currentUser.remainingAuthSeconds=newTimeout,lastServerTimeoutSet=new Date)}function userAuthExpired(isLogout){currentUser&&void 0!==currentUser.id&&(lastUserId=currentUser.id),currentUser&&(currentUser.remainingAuthSeconds=0),lastServerTimeoutSet=null,currentUser=null,openLoginDialog(void 0===isLogout||!isLogout)}return requestRetryQueue.onItemAddedCallbacks.push(function(retryItem){requestRetryQueue.hasMore()&&userAuthExpired()}),{_showLoginDialog:function _showLoginDialog(){openLoginDialog()},_retryRequestQueue:function _retryRequestQueue(success){!function retryRequestQueue(success){success?requestRetryQueue.retryAll(currentUser.name):(requestRetryQueue.cancelAll(),$location.path("/"))}(success)},isAuthenticated:function isAuthenticated(){if(currentUser){var deferred=$q.defer();return deferred.resolve(!0),deferred.promise}return authResource.isAuthenticated()},authenticate:function authenticate(login,password){return authResource.performLogin(login,password).then(function(data){if(0===data.startContentIds.length&&0===data.startMediaIds.length){var result={errorMsg:"User has no start-nodes",user:data,authenticated:!1,lastUserId:lastUserId,loginType:"credentials"};throw eventsService.emit("app.notAuthenticated",result),result}return data},function(err){return $q.reject(err)}).then(this.setAuthenticationSuccessful)},setAuthenticationSuccessful:function setAuthenticationSuccessful(data){setCurrentUser(data);var result={user:data,authenticated:!0,lastUserId:lastUserId,loginType:"credentials"};return eventsService.emit("app.authenticated",result),result},logout:function logout(){return authResource.performLogout().then(function(data){if(userAuthExpired(),!data||!data.signOutRedirectUrl)return null;$window.location.replace(data.signOutRedirectUrl)})},refreshCurrentUser:function refreshCurrentUser(){var deferred=$q.defer();return authResource.getCurrentUser().then(function(data){setCurrentUser(data),deferred.resolve(currentUser)},function(err){deferred.reject(err)}),deferred.promise},getCurrentUser:function getCurrentUser(args){return currentUser?$q.when(currentUser):authResource.getCurrentUser().then(function(data){var result={user:data,authenticated:!0,lastUserId:lastUserId,loginType:"implicit"};return args&&args.broadcastEvent&&eventsService.emit("app.authenticated",result),setCurrentUser(data),$q.when(currentUser)},function(err){return $q.reject(err)})},setUserTimeout:function setUserTimeout(newTimeout){setUserTimeoutInternal(newTimeout)},addUserToEmailMarketing:function addUserToEmailMarketing(user){return emailMarketingResource.postAddUserToEmailMarketing(user)}}}),function(){angular.module("umbraco.services").factory("usersHelper",function usersHelperService(localizationService){var userStates=[{name:"All",key:"All"},{value:0,name:"Active",key:"Active",color:"success"},{value:1,name:"Disabled",key:"Disabled",color:"danger"},{value:2,name:"Locked out",key:"LockedOut",color:"danger"},{value:3,name:"Invited",key:"Invited",color:"warning"},{value:4,name:"Inactive",key:"Inactive",color:"warning"}];function getUserStateByKey(key){return userStates.find(function(userState){return userState.key===key})}return localizationService.localizeMany(userStates.map(function(userState){return"user_state"+userState.key})).then(function(data){var reg=/^\[[\S\s]*]$/g;data.forEach(function(value,index){reg.test(value)||(userStates[index].name=value)})}),{getUserStateFromValue:function getUserStateFromValue(value){return userStates.find(function(userState){return userState.value===value})},getUserStateByKey:getUserStateByKey,getUserStatesFilter:function getUserStatesFilter(userStatesObject){var userStatesFilter=[];for(var key in userStatesObject)if(hasOwnProperty.call(userStatesObject,key)){var userState=getUserStateByKey(key);userState&&(userState.count=userStatesObject[key],userStatesFilter.push(userState))}return userStatesFilter}}})}(),angular.module("umbraco.services").factory("versionHelper",versionHelper),angular.module("umbraco.services").factory("dateHelper",dateHelper),angular.module("umbraco.services").factory("packageHelper",packageHelper),angular.module("umbraco.services").factory("umbModelMapper",umbModelMapper),angular.module("umbraco.services").factory("umbSessionStorage",umbSessionStorage),angular.module("umbraco.services").factory("updateChecker",updateChecker),angular.module("umbraco.services").factory("umbPropEditorHelper",umbPropEditorHelper),function(){angular.module("umbraco.services").factory("validationMessageService",function validationMessageService($q,localizationService){return{getMandatoryMessage:function getMandatoryMessage(validation){return validation?validation.mandatoryMessage?$q.when(validation.mandatoryMessage):localizationService.localize("general_required").then(function(value){return $q.when(value)}):$q.when("")}}})}(),angular.module("umbraco.services").factory("windowResizeListener",windowResizeListener),angular.module("umbraco.services").factory("xmlhelper",xmlhelper),function(window){var isArray=function isArray(val){return Array.isArray(val)||val instanceof Array},extend=angular.extend,isUndefined=function isUndefined(val){return void 0===val},isString=function isString(val){return"string"==typeof val},isNumber=function isNumber(val){return"number"==typeof val},toJsonReplacer=function toJsonReplacer(key,value){var val=value;return"string"==typeof key&&"$"===key.charAt(0)&&"$"===key.charAt(1)?val=void 0:!function isWindow(obj){return obj&&obj.window===obj}(value)?value&&window.document===value?val="$DOCUMENT":function isScope(obj){return obj&&obj.$evalAsync&&obj.$watch}(value)&&(val="$SCOPE"):val="$WINDOW",val},_utilities={noop:function noop(){},copy:function copy(src,dst){return angular.copy(src,dst)},isArray:isArray,equals:function equals(a,b){return angular.equals(a,b)},extend:extend,isFunction:function isFunction(val){return"function"==typeof val},isUndefined:isUndefined,isDefined:function isDefined(val){return!isUndefined(val)},isString:isString,isNumber:isNumber,isObject:function isObject(val){return null!==val&&"object"===_typeof(val)},fromJson:function fromJson(val){return isString(val)?JSON.parse(val):val},toJson:function toJson(obj,pretty){if(!isUndefined(obj))return isNumber(pretty)||(pretty=pretty?2:null),JSON.stringify(obj,toJsonReplacer,pretty)},forEach:function forEach(obj,iterator){return obj&&isArray(obj)?obj.forEach(iterator):obj}};void 0===window.Utilities&&(window.Utilities=_utilities)}(window)}();